import{Ea as k,Hb as $,Ka as V,t as I}from"./chunk-O42HJH32.js";import{f as j,m as M}from"./chunk-U2ZBXU24.js";import{Aa as P,Ja as U,P as E,S as v,Tb as C,Ub as a,Xb as L,_ as N,ea as W,jb as B,kb as R,za as D}from"./chunk-JM5XIBFZ.js";function H(c){let e=v($,{host:!0,optional:!0});if(e)return{addControl:t=>{e.getInstance()?.addControl(t)},removeControl:t=>e.getInstance()?.removeControl(t),getInstance:()=>e.getInstance()};throw new Error(`No control host found. Please wrap the ${c} control component in a Map component.`)}var S="units",K=[1,2,5],w=25.4/.28,y=class extends V{constructor(e){e=e||{};let t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;let n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+k,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(S,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(S)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(S,e)}setDpi(e){this.dpi_=e}updateElement_(){let e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let t=e.center,n=e.projection,s=this.getUnits(),l=s=="degrees"?"degrees":"m",o=M(n,e.resolution,t,l),m=this.minWidth_*(this.dpi_||w)/w,h=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||w)/w:void 0,r=m*o,i="";if(s=="degrees"){let g=j.degrees;r*=g,r<g/60?(i="\u2033",o*=3600):r<g?(i="\u2032",o*=60):i="\xB0"}else if(s=="imperial")r<.9144?(i="in",o/=.0254):r<1609.344?(i="ft",o/=.3048):(i="mi",o/=1609.344);else if(s=="nautical")o/=1852,i="NM";else if(s=="metric")r<1e-6?(i="nm",o*=1e9):r<.001?(i="\u03BCm",o*=1e6):r<1?(i="mm",o*=1e3):r<1e3?i="m":(i="km",o/=1e3);else if(s=="us")r<.9144?(i="in",o*=39.37):r<1609.344?(i="ft",o/=.30480061):(i="mi",o/=1609.3472);else throw new Error("Invalid units");let f=3*Math.floor(Math.log(m*o)/Math.log(10)),u,d,p,x=0,b,T;for(;;){p=Math.floor(f/3);let g=Math.pow(10,p);if(u=K[(f%3+3)%3]*g,d=Math.round(u/o),isNaN(d)){this.element.style.display="none",this.renderedVisible_=!1;return}if(h!==void 0&&d>=h){u=x,d=b,p=T;break}else if(d>=m)break;x=u,b=d,T=p,++f}let _=this.scaleBar_?this.createScaleBar(d,u,i):u.toFixed(p<0?-p:0)+" "+i;this.renderedHTML_!=_&&(this.innerElement_.innerHTML=_,this.renderedHTML_=_),this.renderedWidth_!=d&&(this.innerElement_.style.width=d+"px",this.renderedWidth_=d),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){let s=this.getScaleForResolution(),l=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),o=this.scaleBarSteps_,m=e/o,h=[this.createMarker("absolute")];for(let i=0;i<o;++i){let f=i%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";h.push(`<div><div class="ol-scale-singlebar ${f}" style="width: ${m}px;"></div>`+this.createMarker("relative")+(i%2===0||o===2?this.createStepText(i,e,!1,t,n):"")+"</div>")}return h.push(this.createStepText(o,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+l+"</div>":"")+h.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,n,s,l){let m=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+l),h=e===0?-3:t/this.scaleBarSteps_*-1,r=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${h}px;text-align: ${e===0?"left":"center"};min-width: ${r}px;left: ${n?t+"px":"unset"};">`+m+"</div>"}getScaleForResolution(){let e=M(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||w,n=1e3/25.4;return e*n*t}render(e){let t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}},O=y;var q=["*"],F=class c{wolClassName=a();wolMinWidth=a();wolMaxWidth=a();wolRender=a();wolTarget=a();wolUnits=L();wolBar=a();wolSteps=a();wolText=a();wolDpi=a();wolProperties=a();wolChange=C();wolError=C();wolPropertyChange=C();instance;constructor(){let e=v(N),t=H("ScaleLine"),n={};U(()=>{let s=new O({className:this.wolClassName(),minWidth:this.wolMinWidth(),maxWidth:this.wolMaxWidth(),render:this.wolRender(),target:this.wolTarget(),units:this.wolUnits(),bar:this.wolBar(),steps:this.wolSteps(),text:this.wolText(),dpi:this.wolDpi()});this.wolProperties()&&s.setProperties(this.wolProperties()??{},!0),n.change=s.on("change",l=>this.wolChange.emit(l)),n["change:units"]=s.on("change:units",()=>this.wolUnits.set(s.getUnits())),n.error=s.on("error",l=>this.wolError.emit(l)),n.propertychange=s.on("propertychange",l=>this.wolPropertyChange.emit(l)),Promise.resolve().then(()=>{t.addControl(s)}),this.instance=s}),e.onDestroy(()=>{this.instance&&(I(Object.values(n)),t.removeControl(this.instance),this.instance=void 0)})}ngOnChanges(e){if(this.instance)for(let[t,n]of Object.entries(e))switch(t){case"wolDpi":this.instance.setDpi(n.currentValue);break;case"wolProperties":this.instance.setProperties(n.currentValue??{},!1);break;case"wolTarget":this.instance.setTarget(n.currentValue);break;case"wolUnits":this.instance.setUnits(n.currentValue);break}}getInstance(){return this.instance}static \u0275fac=function(t){return new(t||c)};static \u0275cmp=D({type:c,selectors:[["wol-scale-line-control"]],inputs:{wolClassName:[1,"wolClassName"],wolMinWidth:[1,"wolMinWidth"],wolMaxWidth:[1,"wolMaxWidth"],wolRender:[1,"wolRender"],wolTarget:[1,"wolTarget"],wolUnits:[1,"wolUnits"],wolBar:[1,"wolBar"],wolSteps:[1,"wolSteps"],wolText:[1,"wolText"],wolDpi:[1,"wolDpi"],wolProperties:[1,"wolProperties"]},outputs:{wolUnits:"wolUnitsChange",wolChange:"wolChange",wolError:"wolError",wolPropertyChange:"wolPropertyChange"},features:[W],ngContentSelectors:q,decls:1,vars:0,template:function(t,n){t&1&&(B(),R(0))},encapsulation:2,changeDetection:0})};var A=class c{static \u0275fac=function(t){return new(t||c)};static \u0275mod=P({type:c});static \u0275inj=E({})};export{F as a,A as b};
