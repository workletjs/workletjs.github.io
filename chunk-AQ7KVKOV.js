import{B as G,E as z,F as Q,G as X,aa as Y,f as K,h as W,i as _,l as k,o as $}from"./chunk-C5YTQK3D.js";import{f as B}from"./chunk-5N5AZK4V.js";import{Ba as j,ya as A,za as V}from"./chunk-DMJFVBB3.js";import{Aa as b,Ga as M,Ja as S,Mb as D,P as O,S as p,Tb as u,Ub as h,Vb as L,Xb as c,_ as E,ea as C,jb as T,kb as x,qb as F,rb as R,wa as N,za as I}from"./chunk-JM5XIBFZ.js";var s={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"},y=class extends k{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+G,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(s.ELEMENT,this.handleElementChanged),this.addChangeListener(s.MAP,this.handleMapChanged),this.addChangeListener(s.OFFSET,this.handleOffsetChanged),this.addChangeListener(s.POSITION,this.handlePositionChanged),this.addChangeListener(s.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(s.ELEMENT)}getId(){return this.id}getMap(){return this.get(s.MAP)||null}getOffset(){return this.get(s.OFFSET)}getPosition(){return this.get(s.POSITION)}getPositioning(){return this.get(s.POSITIONING)}handleElementChanged(){X(this.element);let e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){this.mapPostrenderListenerKey&&(this.element?.remove(),W(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);let e=this.getMap();if(e){this.mapPostrenderListenerKey=K(e,$.POSTRENDER,this.render,this),this.updatePixelPosition();let n=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?n.insertBefore(this.element,n.childNodes[0]||null):n.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(s.ELEMENT,e)}setMap(e){this.set(s.MAP,e)}setOffset(e){this.set(s.OFFSET,e)}setPosition(e){this.set(s.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){let n=this.getMap();if(!n||!n.getTargetElement()||!this.get(s.POSITION))return;let o=this.getRect(n.getTargetElement(),n.getSize()),i=this.getElement(),t=this.getRect(i,[z(i),Q(i)]);e=e||{};let r=e.margin===void 0?20:e.margin;if(!B(o,t)){let g=t[0]-o[0],d=o[2]-t[2],m=t[1]-o[1],f=o[3]-t[3],l=[0,0];if(g<0?l[0]=g-r:d<0&&(l[0]=Math.abs(d)+r),m<0?l[1]=m-r:f<0&&(l[1]=Math.abs(f)+r),l[0]!==0||l[1]!==0){let J=n.getView().getCenterInternal(),w=n.getPixelFromCoordinateInternal(J);if(!w)return;let U=[w[0]+l[0],w[1]+l[1]],v=e.animation||{};n.getView().animateInternal({center:n.getCoordinateFromPixelInternal(U),duration:v.duration,easing:v.easing})}}}getRect(e,n){let o=e.getBoundingClientRect(),i=o.left+window.pageXOffset,t=o.top+window.pageYOffset;return[i,t,i+n[0],t+n[1]]}setPositioning(e){this.set(s.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){let e=this.getMap(),n=this.getPosition();if(!e||!e.isRendered()||!n){this.setVisible(!1);return}let o=e.getPixelFromCoordinate(n),i=e.getSize();this.updateRenderedPosition(o,i)}updateRenderedPosition(e,n){let o=this.element.style,i=this.getOffset(),t=this.getPositioning();this.setVisible(!0);let r=`${e[0]+i[0]}px`,g=`${e[1]+i[1]}px`,d="0%",m="0%";t=="bottom-right"||t=="center-right"||t=="top-right"?d="-100%":(t=="bottom-center"||t=="center-center"||t=="top-center")&&(d="-50%"),t=="bottom-left"||t=="bottom-center"||t=="bottom-right"?m="-100%":(t=="center-left"||t=="center-center"||t=="center-right")&&(m="-50%");let f=`translate(${d}, ${m}) translate(${r}, ${g})`;this.rendered.transform_!=f&&(this.rendered.transform_=f,o.transform=f)}getOptions(){return this.options}},q=y;var ee=["content"],te=["*"];function ne(a,e){a&1&&x(0)}var P=class a{wolId=h();wolElement=c();wolOffset=c();wolPosition=c();wolPositioning=c();wolStopEvent=h();wolInsertFirst=h();wolAutoPan=h();wolClassName=h();wolProperties=h();wolChange=u();wolError=u();wolPropertyChange=u();instance;overlayContent=L.required("content");overlayPortal;overlayPortalOutlet;constructor(){let e=p(E),n=p(N),o=p(Y,{host:!0}),i={};if(!o)throw new Error("Overlay component must be used within a Map component.");S(()=>{let t=new q({id:this.wolId(),element:this.wolElement()??document.createElement("div"),offset:this.wolOffset(),position:this.wolPosition(),positioning:this.wolPositioning(),stopEvent:this.wolStopEvent(),insertFirst:this.wolInsertFirst(),autoPan:this.wolAutoPan(),className:this.wolClassName()});this.wolProperties()&&t.setProperties(this.wolProperties()??{},!0),i.change=t.on("change",r=>this.wolChange.emit(r)),i["change:element"]=t.on("change:element",()=>this.wolElement.set(t.getElement())),i["change:offset"]=t.on("change:offset",()=>this.wolOffset.set(t.getOffset())),i["change:position"]=t.on("change:position",()=>this.wolPosition.set(t.getPosition())),i["change:positioning"]=t.on("change:positioning",()=>this.wolPositioning.set(t.getPositioning())),i.error=t.on("error",r=>this.wolError.emit(r)),i.propertychange=t.on("propertychange",r=>this.wolPropertyChange.emit(r)),Promise.resolve().then(()=>{o.getInstance()?.addOverlay(t)}),this.instance=t,this.overlayPortal=new A(this.overlayContent(),n),this.attachOverlayPortal()}),e.onDestroy(()=>{this.overlayPortalOutlet?.dispose(),this.instance&&(_(Object.values(i)),o.getInstance()?.removeOverlay(this.instance),this.instance=void 0)})}ngOnChanges(e){if(this.instance)for(let[n,o]of Object.entries(e))switch(n){case"wolElement":this.instance.setElement(o.currentValue),this.attachOverlayPortal();break;case"wolOffset":this.instance.setOffset(o.currentValue);break;case"wolPosition":this.instance.setPosition(o.currentValue);break;case"wolPositioning":this.instance.setPositioning(o.currentValue);break;case"wolProperties":this.instance.setProperties(o.currentValue??{});break}}getInstance(){return this.instance}attachOverlayPortal(){let e=this.instance?.getElement();this.overlayPortalOutlet?.dispose(),this.overlayPortalOutlet=void 0,e&&this.overlayPortal&&(this.overlayPortalOutlet=new V(e),this.overlayPortalOutlet?.attachTemplatePortal(this.overlayPortal))}static \u0275fac=function(n){return new(n||a)};static \u0275cmp=I({type:a,selectors:[["wol-overlay"]],viewQuery:function(n,o){n&1&&F(o.overlayContent,ee,5),n&2&&R()},inputs:{wolId:[1,"wolId"],wolElement:[1,"wolElement"],wolOffset:[1,"wolOffset"],wolPosition:[1,"wolPosition"],wolPositioning:[1,"wolPositioning"],wolStopEvent:[1,"wolStopEvent"],wolInsertFirst:[1,"wolInsertFirst"],wolAutoPan:[1,"wolAutoPan"],wolClassName:[1,"wolClassName"],wolProperties:[1,"wolProperties"]},outputs:{wolElement:"wolElementChange",wolOffset:"wolOffsetChange",wolPosition:"wolPositionChange",wolPositioning:"wolPositioningChange",wolChange:"wolChange",wolError:"wolError",wolPropertyChange:"wolPropertyChange"},exportAs:["wolOverlay"],features:[C],ngContentSelectors:te,decls:2,vars:0,consts:[["content",""]],template:function(n,o){n&1&&(T(),M(0,ne,1,0,"ng-template",null,0,D))},dependencies:[j],encapsulation:2,changeDetection:0})};var H=class a{static \u0275fac=function(n){return new(n||a)};static \u0275mod=b({type:a});static \u0275inj=O({imports:[P]})};export{P as a,H as b};
