import{$ as me,D as dt,I as K,J as V,K as Pe,La as St,M as F,N as ft,O as U,P as pt,Q as q,R as Le,S as De,T as mt,U as gt,V as Tt,W as Et,X as m,a as j,b as Qe,c as et,e as rt,fa as ge,ha as Me,i as he,ia as Ue,j as de,k as M,ka as _t,la as Te,m as ot,ma as Rt,p as O,q as nt,qa as xt,ra as yt,s as X,sa as Ne,t as lt,ua as H,v as ct,w as ut,x as Ae,xa as wt,y as ht,ya as bt,z as pe,za as Ct}from"./chunk-QKVTYPUH.js";import{D as fe,a as tt}from"./chunk-QQYK7P6A.js";import{K as st,M as Y,R as at,n as it,r as Ie}from"./chunk-RDGT5TKL.js";import{Ja as le,S as N,Tb as P,Ub as L,Xb as w,_ as ie,ea as se,jb as ce,kb as ue,za as ae}from"./chunk-JM5XIBFZ.js";import{a as oe,b as ne}from"./chunk-TWZW5B45.js";var rr=["*"],Ee=class o{wolClassName=L();wolOpacity=w();wolVisible=w();wolExtent=w();wolZIndex=w();wolMinResolution=w();wolMaxResolution=w();wolMinZoom=w();wolMaxZoom=w();wolPreload=w();wolSource=w();wolMap=L();wolBackground=L();wolUseInterimTilesOnError=w();wolProperties=L();wolCacheSize=L();wolChange=P();wolError=P();wolPostRender=P();wolPreRender=P();wolPropertyChange=P();wolSourceReady=P();instance;constructor(){let e=N(ie),t=ge("TileLayer"),r={};le(()=>{let n=new Ct({className:this.wolClassName(),opacity:this.wolOpacity(),visible:this.wolVisible(),extent:this.wolExtent(),zIndex:this.wolZIndex(),minResolution:this.wolMinResolution(),maxResolution:this.wolMaxResolution(),minZoom:this.wolMinZoom(),maxZoom:this.wolMaxZoom(),preload:this.wolPreload(),source:this.wolSource(),map:this.wolMap(),background:this.wolBackground(),useInterimTilesOnError:this.wolUseInterimTilesOnError(),properties:this.wolProperties(),cacheSize:this.wolCacheSize()});r.change=n.on("change",i=>this.wolChange.emit(i)),r["change:extent"]=n.on("change:extent",()=>this.wolExtent.set(n.getExtent())),r["change:maxResolution"]=n.on("change:maxResolution",()=>this.wolMaxResolution.set(n.getMaxResolution())),r["change:maxZoom"]=n.on("change:maxZoom",()=>this.wolMaxZoom.set(n.getMaxZoom())),r["change:minResolution"]=n.on("change:minResolution",()=>this.wolMinResolution.set(n.getMinResolution())),r["change:minZoom"]=n.on("change:minZoom",()=>this.wolMinZoom.set(n.getMinZoom())),r["change:opacity"]=n.on("change:opacity",()=>this.wolOpacity.set(n.getOpacity())),r["change:preload"]=n.on("change:preload",()=>this.wolPreload.set(n.getPreload())),r["change:source"]=n.on("change:source",()=>this.wolSource.set(n.getSource()??void 0)),r["change:useInterimTilesOnError"]=n.on("change:useInterimTilesOnError",()=>this.wolUseInterimTilesOnError.set(n.getUseInterimTilesOnError())),r["change:visible"]=n.on("change:visible",()=>this.wolVisible.set(n.getVisible())),r["change:zIndex"]=n.on("change:zIndex",()=>this.wolZIndex.set(n.getZIndex())),r.error=n.on("error",i=>this.wolError.emit(i)),r.postrender=n.on("postrender",i=>this.wolPostRender.emit(i)),r.prerender=n.on("prerender",i=>this.wolPreRender.emit(i)),r.propertychange=n.on("propertychange",i=>this.wolPropertyChange.emit(i)),r.sourceready=n.on("sourceready",i=>this.wolSourceReady.emit(i)),Promise.resolve().then(()=>{t.addLayer(n)}),this.instance=n}),e.onDestroy(()=>{this.instance&&(he(Object.values(r)),t.removeLayer(this.instance),this.instance=void 0)})}ngOnChanges(e){if(this.instance)for(let[t,r]of Object.entries(e))switch(t){case"wolExtent":this.instance.setExtent(r.currentValue);break;case"wolMap":this.instance.setMap(r.currentValue??null);break;case"wolMaxResolution":this.instance.setMaxResolution(r.currentValue);break;case"wolMaxZoom":this.instance.setMaxZoom(r.currentValue);break;case"wolMinResolution":this.instance.setMinResolution(r.currentValue);break;case"wolMinZoom":this.instance.setMinZoom(r.currentValue);break;case"wolOpacity":this.instance.setOpacity(r.currentValue);break;case"wolPreload":this.instance.setPreload(r.currentValue);break;case"wolProperties":this.instance.setProperties(r.currentValue);break;case"wolSource":this.instance.setSource(r.currentValue);break;case"wolUseInterimTilesOnError":this.instance.setUseInterimTilesOnError(r.currentValue);break;case"wolVisible":this.instance.setVisible(r.currentValue);break;case"wolZIndex":this.instance.setZIndex(r.currentValue);break}}getInstance(){return this.instance}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=ae({type:o,selectors:[["wol-tile-layer"]],inputs:{wolClassName:[1,"wolClassName"],wolOpacity:[1,"wolOpacity"],wolVisible:[1,"wolVisible"],wolExtent:[1,"wolExtent"],wolZIndex:[1,"wolZIndex"],wolMinResolution:[1,"wolMinResolution"],wolMaxResolution:[1,"wolMaxResolution"],wolMinZoom:[1,"wolMinZoom"],wolMaxZoom:[1,"wolMaxZoom"],wolPreload:[1,"wolPreload"],wolSource:[1,"wolSource"],wolMap:[1,"wolMap"],wolBackground:[1,"wolBackground"],wolUseInterimTilesOnError:[1,"wolUseInterimTilesOnError"],wolProperties:[1,"wolProperties"],wolCacheSize:[1,"wolCacheSize"]},outputs:{wolOpacity:"wolOpacityChange",wolVisible:"wolVisibleChange",wolExtent:"wolExtentChange",wolZIndex:"wolZIndexChange",wolMinResolution:"wolMinResolutionChange",wolMaxResolution:"wolMaxResolutionChange",wolMinZoom:"wolMinZoomChange",wolMaxZoom:"wolMaxZoomChange",wolPreload:"wolPreloadChange",wolSource:"wolSourceChange",wolUseInterimTilesOnError:"wolUseInterimTilesOnErrorChange",wolChange:"wolChange",wolError:"wolError",wolPostRender:"wolPostRender",wolPreRender:"wolPreRender",wolPropertyChange:"wolPropertyChange",wolSourceReady:"wolSourceReady"},features:[se],ngContentSelectors:rr,decls:1,vars:0,template:function(t,r){t&1&&(ce(),ue(0))},encapsulation:2,changeDetection:0})};function B(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function _e(o,e){return o[0]=e[0],o[1]=e[1],o[4]=e[2],o[5]=e[3],o[12]=e[4],o[13]=e[5],o}function Ur(o,e,t,r,n,i,s){s=s??B();let a=1/(o-e),u=1/(t-r),l=1/(n-i);return s[0]=-2*a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*u,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*l,s[11]=0,s[12]=(o+e)*a,s[13]=(r+t)*u,s[14]=(i+n)*l,s[15]=1,s}function Nr(o,e,t,r,n){return n=n??B(),n[0]=o[0]*e,n[1]=o[1]*e,n[2]=o[2]*e,n[3]=o[3]*e,n[4]=o[4]*t,n[5]=o[5]*t,n[6]=o[6]*t,n[7]=o[7]*t,n[8]=o[8]*r,n[9]=o[9]*r,n[10]=o[10]*r,n[11]=o[11]*r,n[12]=o[12],n[13]=o[13],n[14]=o[14],n[15]=o[15],n}function Or(o,e,t,r,n){n=n??B();let i,s,a,u,l,h,c,f,d,g,b,C;return o===n?(n[12]=o[0]*e+o[4]*t+o[8]*r+o[12],n[13]=o[1]*e+o[5]*t+o[9]*r+o[13],n[14]=o[2]*e+o[6]*t+o[10]*r+o[14],n[15]=o[3]*e+o[7]*t+o[11]*r+o[15]):(i=o[0],s=o[1],a=o[2],u=o[3],l=o[4],h=o[5],c=o[6],f=o[7],d=o[8],g=o[9],b=o[10],C=o[11],n[0]=i,n[1]=s,n[2]=a,n[3]=u,n[4]=l,n[5]=h,n[6]=c,n[7]=f,n[8]=d,n[9]=g,n[10]=b,n[11]=C,n[12]=i*e+l*t+d*r+o[12],n[13]=s*e+h*t+g*r+o[13],n[14]=a*e+c*t+b*r+o[14],n[15]=u*e+f*t+C*r+o[15]),n}function Fr(o,e,t,r){return r=r??B(),r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=o,r[13]=e,r[14]=t,r[15]=1,r}var J=34962,Q=34963,It=35040,W=35044,At=35048,Pt=5121,Lt=5123,Dt=5125,Oe=5126,vt=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Mt(o,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!ot},e);let t=vt.length;for(let r=0;r<t;++r)try{let n=o.getContext(vt[r],e);if(n)return n}catch{}return null}var or={STATIC_DRAW:W,STREAM_DRAW:It,DYNAMIC_DRAW:At},Fe=class{constructor(e,t){this.array_=null,this.type_=e,nt(e===J||e===Q,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:or.STATIC_DRAW}ofSize(e){return this.array_=new(Re(this.type_))(e),this}fromArray(e){return this.array_=Re(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(Re(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}setArray(e){let t=Re(this.type_);if(!(e instanceof t))throw new Error(`Expected ${t}`);this.array_=e}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}};function Re(o){switch(o){case J:return Float32Array;case Q:return Uint32Array;default:return Float32Array}}var xe=Fe;var ee={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"};var nr=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,ir=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`,Be=class{constructor(e){this.gl_=e.webGlContext;let t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();let r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||nr),t.compileShader(r);let n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e.fragmentShader||ir),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();let i=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(s=>{this.uniforms_.push({value:e.uniforms[s],location:t.getUniformLocation(this.renderTargetProgram_,s)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(e){let t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;let n=0,i=t.RGBA,s=0,a=t.RGBA,u=t.UNSIGNED_BYTE,l=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,n,i,r[0],r[1],s,a,u,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,r[0],r[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,r,n){let i=this.getGL(),s=e.size;if(i.bindFramebuffer(i.FRAMEBUFFER,t?t.getFrameBuffer():null),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.renderTargetTexture_),!t){let u=M(i.canvas);if(!e.renderTargets[u]){let l=i.getContextAttributes();l&&l.preserveDrawingBuffer&&(i.clearColor(0,0,0,0),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)),e.renderTargets[u]=!0}}i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA),i.viewport(0,0,i.drawingBufferWidth,i.drawingBufferHeight),i.bindBuffer(i.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),i.useProgram(this.renderTargetProgram_),i.enableVertexAttribArray(this.renderTargetAttribLocation_),i.vertexAttribPointer(this.renderTargetAttribLocation_,2,i.FLOAT,!1,0,0),i.uniform2f(this.renderTargetUniformLocation_,s[0],s[1]),i.uniform1i(this.renderTargetTextureLocation_,0);let a=e.layerStatesArray[e.layerIndex].opacity;i.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),r&&r(i,e),i.drawArrays(i.TRIANGLES,0,6),n&&n(i,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){let t=this.getGL(),r,n=1;this.uniforms_.forEach(function(i){if(r=typeof i.value=="function"?i.value(e):i.value,r instanceof HTMLCanvasElement||r instanceof ImageData)i.texture||(i.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${n}`]),t.bindTexture(t.TEXTURE_2D,i.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,r.width,r.height,0,t.UNSIGNED_BYTE,new Uint8Array(r.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.uniform1i(i.location,n++);else if(Array.isArray(r))switch(r.length){case 2:t.uniform2f(i.location,r[0],r[1]);return;case 3:t.uniform3f(i.location,r[0],r[1],r[2]);return;case 4:t.uniform4f(i.location,r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(i.location,r)})}},Ge=Be;var G={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},k={UNSIGNED_BYTE:Pt,UNSIGNED_SHORT:Lt,UNSIGNED_INT:Dt,FLOAT:Oe},ye={};function Ut(o){return"shared/"+o}var Nt=0;function sr(){let o="unique/"+Nt;return Nt+=1,o}function ar(o){let e=ye[o];if(!e){let t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:Mt(t)},ye[o]=e}return e.users+=1,e.context}function lr(o){let e=ye[o];if(!e||(e.users-=1,e.users>0))return;let t=e.context,r=t.getExtension("WEBGL_lose_context");r&&r.loseContext();let n=t.canvas;n.width=1,n.height=1,delete ye[o]}var $e=class extends Qe{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Ut(e.canvasCacheKey):sr(),this.gl_=ar(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;let t=this.gl_.canvas;t.addEventListener(ee.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(ee.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=X(),this.offsetScaleMatrix_=X(),this.tmpMat4_=B(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(r=>new Ge({webGlContext:this.gl_,scaleRatio:r.scaleRatio,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,uniforms:r.uniforms})):[new Ge({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now(),this.maxAttributeCount_=this.gl_.getParameter(this.gl_.MAX_VERTEX_ATTRIBS)}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(let t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Ut(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];let t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){let t=this.gl_,r=M(e),n=this.bufferCache_[r];if(!n){let i=t.createBuffer();n={buffer:e,webGlBuffer:i},this.bufferCache_[r]=n}t.bindBuffer(e.getType(),n.webGlBuffer)}flushBufferData(e){let t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){let t=M(e);delete this.bufferCache_[t]}disposeInternal(){let e=this.gl_.canvas;e.removeEventListener(ee.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(ee.RESTORED,this.boundHandleWebGLContextRestored_),lr(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,r){let n=this.gl_,i=this.getCanvas(),s=e.size,a=e.pixelRatio;(i.width!==s[0]*a||i.height!==s[1]*a)&&(i.width=s[0]*a,i.height=s[1]*a,i.style.width=s[0]+"px",i.style.height=s[1]+"px");for(let u=this.postProcessPasses_.length-1;u>=0;u--)this.postProcessPasses_[u].init(e);n.bindTexture(n.TEXTURE_2D,null),n.clearColor(0,0,0,0),n.depthRange(0,1),n.clearDepth(1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,t?n.ZERO:n.ONE_MINUS_SRC_ALPHA),r?(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL)):n.disable(n.DEPTH_TEST)}bindFrameBuffer(e,t){let r=this.getGL();r.bindFramebuffer(r.FRAMEBUFFER,e),t&&r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)}bindInitialFrameBuffer(){let e=this.getGL(),t=this.postProcessPasses_[0].getFrameBuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);let r=this.postProcessPasses_[0].getRenderTargetTexture();e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0)}bindTexture(e,t,r){let n=this.gl_;n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.uniform1i(this.getUniformLocation(r),t)}bindAttribute(e,t,r){let n=this.getGL();this.bindBuffer(e);let i=this.getAttributeLocation(t);n.enableVertexAttribArray(i),n.vertexAttribPointer(i,r,n.FLOAT,!1,0,0)}prepareDrawToRenderTarget(e,t,r,n){let i=this.gl_,s=t.getSize();i.bindFramebuffer(i.FRAMEBUFFER,t.getFramebuffer()),i.bindRenderbuffer(i.RENDERBUFFER,t.getDepthbuffer()),i.viewport(0,0,s[0],s[1]),i.bindTexture(i.TEXTURE_2D,t.getTexture()),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,r?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}drawElements(e,t){let r=this.gl_;this.getExtension("OES_element_index_uint");let n=r.UNSIGNED_INT,i=4,s=t-e,a=e*i;r.drawElements(r.TRIANGLES,s,n,a)}finalizeDraw(e,t,r){for(let n=0,i=this.postProcessPasses_.length;n<i;n++)n===i-1?this.postProcessPasses_[n].apply(e,null,t,r):this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){let t=e.size,r=e.viewState.rotation,n=e.pixelRatio;this.setUniformFloatValue(G.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(G.ZOOM,e.viewState.zoom),this.setUniformFloatValue(G.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(G.PIXEL_RATIO,n),this.setUniformFloatVec2(G.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(G.ROTATION,r)}applyHitDetectionUniform(e){let t=this.getUniformLocation(G.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(G.PIXEL_RATIO,.5)}applyUniforms(e){let t=this.gl_,r,n=0;this.uniforms_.forEach(i=>{if(r=typeof i.value=="function"?i.value(e):i.value,r instanceof HTMLCanvasElement||r instanceof HTMLImageElement||r instanceof ImageData||r instanceof WebGLTexture){r instanceof WebGLTexture&&!i.texture?(i.prevValue=void 0,i.texture=r):i.texture||(i.prevValue=void 0,i.texture=t.createTexture()),this.bindTexture(i.texture,n,i.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);let s=!(r instanceof HTMLImageElement)||r.complete;!(r instanceof WebGLTexture)&&s&&i.prevValue!==r&&(i.prevValue=r,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)),n++}else if(Array.isArray(r)&&r.length===6)this.setUniformMatrixValue(i.name,_e(this.tmpMat4_,r));else if(Array.isArray(r)&&r.length<=4)switch(r.length){case 2:t.uniform2f(this.getUniformLocation(i.name),r[0],r[1]);return;case 3:t.uniform3f(this.getUniformLocation(i.name),r[0],r[1],r[2]);return;case 4:t.uniform4f(this.getUniformLocation(i.name),r[0],r[1],r[2],r[3]);return;default:return}else typeof r=="number"&&t.uniform1f(this.getUniformLocation(i.name),r)})}useProgram(e,t){this.disableAllAttributes_(),this.gl_.useProgram(e),this.currentProgram_=e,t&&(this.applyFrameState(t),this.applyUniforms(t))}compileShader(e,t){let r=this.gl_,n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n}getProgram(e,t){let r=this.gl_,n=this.compileShader(e,r.FRAGMENT_SHADER),i=this.compileShader(t,r.VERTEX_SHADER),s=r.createProgram();if(r.attachShader(s,n),r.attachShader(s,i),r.linkProgram(s),!r.getShaderParameter(n,r.COMPILE_STATUS)){let a=`Fragment shader compilation failed: ${r.getShaderInfoLog(n)}`;throw new Error(a)}if(r.deleteShader(n),!r.getShaderParameter(i,r.COMPILE_STATUS)){let a=`Vertex shader compilation failed: ${r.getShaderInfoLog(i)}`;throw new Error(a)}if(r.deleteShader(i),!r.getProgramParameter(s,r.LINK_STATUS)){let a=`GL program linking failed: ${r.getProgramInfoLog(s)}`;throw new Error(a)}return s}getUniformLocation(e){let t=M(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){let t=M(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){let r=e.size,n=e.viewState.rotation,i=e.viewState.resolution,s=e.viewState.center;return pe(t,0,0,2/(i*r[0]),2/(i*r[1]),-n,-s[0],-s[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}disableAllAttributes_(){for(let e=0;e<this.maxAttributeCount_;e++)this.gl_.disableVertexAttribArray(e)}enableAttributeArray_(e,t,r,n,i){let s=this.getAttributeLocation(e);s<0||(this.gl_.enableVertexAttribArray(s),this.gl_.vertexAttribPointer(s,t,r,!1,n,i))}enableAttributes(e){let t=cr(e),r=0;for(let n=0;n<e.length;n++){let i=e[n];this.enableAttributeArray_(i.name,i.size,i.type||Oe,t,r),r+=i.size*Ot(i.type)}}handleWebGLContextLost(e){tt(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,r,n){let i=this.gl_;r=r||i.createTexture();let s=n?i.NEAREST:i.LINEAR;i.bindTexture(i.TEXTURE_2D,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,s),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE);let a=0,u=i.RGBA,l=0,h=i.RGBA,c=i.UNSIGNED_BYTE;return t instanceof Uint8Array?i.texImage2D(i.TEXTURE_2D,a,u,e[0],e[1],l,h,c,t):t?i.texImage2D(i.TEXTURE_2D,a,u,h,c,t):i.texImage2D(i.TEXTURE_2D,a,u,e[0],e[1],l,h,c,null),r}};function cr(o){let e=0;for(let t=0;t<o.length;t++){let r=o[t];e+=r.size*Ot(r.type)}return e}function Ot(o){switch(o){case k.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case k.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case k.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case k.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}var Ft=$e;var Xe=class extends rt{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=e.gutter||0,this.helper=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(j.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===O.LOADED,this.loaded)this.uploadTile();else{if(e instanceof Te){let t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(j.CHANGE,this.handleTileChange_)}}uploadTile(){de()}setReady(){this.ready=!0,this.dispatchEvent(j.CHANGE)}handleTileChange_(){this.tile.getState()===O.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(e){this.helper=e,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(j.CHANGE,this.handleTileChange_)}},Bt=Xe;function $t(o,e,t){let r=t?o.LINEAR:o.NEAREST;o.bindTexture(o.TEXTURE_2D,e),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,r),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,r)}function ur(o,e,t,r){$t(o,e,r),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,t)}function Gt(o,e,t,r,n,i){let s=o.getGL(),a,u;t instanceof Float32Array?(a=s.FLOAT,o.getExtension("OES_texture_float"),u=o.getExtension("OES_texture_float_linear")!==null):(a=s.UNSIGNED_BYTE,u=!0),$t(s,e,i&&u);let l=t.byteLength/r[1],h=1;l%8===0?h=8:l%4===0?h=4:l%2===0&&(h=2);let c;switch(n){case 1:{c=s.LUMINANCE;break}case 2:{c=s.LUMINANCE_ALPHA;break}case 3:{c=s.RGB;break}case 4:{c=s.RGBA;break}default:throw new Error(`Unsupported number of bands: ${n}`)}let f=s.getParameter(s.UNPACK_ALIGNMENT);s.pixelStorei(s.UNPACK_ALIGNMENT,h),s.texImage2D(s.TEXTURE_2D,0,c,r[0],r[1],0,c,a,t),s.pixelStorei(s.UNPACK_ALIGNMENT,f)}var z=null;function hr(){z=dt(1,1,void 0,{willReadFrequently:!0})}var Ve=class extends Bt{constructor(e){super(e),this.textures=[],this.renderSize_=F(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;let t=new xe(J,W);t.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(t),this.coords=t,this.setTile(e.tile)}setHelper(e){let t=this.helper?.getGL();if(t){this.helper.deleteBuffer(this.coords);for(let r=0;r<this.textures.length;++r)t.deleteTexture(this.textures[r])}super.setHelper(e),e&&e.flushBufferData(this.coords)}uploadTile(){let e=this.helper,t=e.getGL(),r=this.tile;this.textures.length=0;let n;r instanceof Te||r instanceof xt?n=r.getImage():n=r.getData();let i=Me(n);if(i){let T=t.createTexture();this.textures.push(T),this.bandCount=4,ur(t,T,i,r.interpolate),this.setReady();return}n=Ue(n);let s=r.getSize(),a=[s[0]+2*this.gutter,s[1]+2*this.gutter],u=n instanceof Float32Array,l=a[0]*a[1],h=u?Float32Array:Uint8Array,c=h.BYTES_PER_ELEMENT,f=n.byteLength/a[1];this.bandCount=Math.floor(f/c/a[0]);let d=Math.ceil(this.bandCount/4);if(d===1){let T=t.createTexture();this.textures.push(T),Gt(e,T,n,a,this.bandCount,r.interpolate),this.setReady();return}let g=new Array(d);for(let T=0;T<d;++T){let E=t.createTexture();this.textures.push(E);let y=T<d-1?4:(this.bandCount-1)%4+1;g[T]=new h(l*y)}let b=0,C=0,A=a[0]*this.bandCount;for(let T=0;T<a[1];++T){for(let E=0;E<A;++E){let y=n[C+E],R=Math.floor(b/this.bandCount),x=E%this.bandCount,v=Math.floor(x/4),D=g[v],I=D.length/l,S=x%4;D[R*I+S]=y,++b}C+=f/c}for(let T=0;T<d;++T){let E=this.textures[T],y=g[T],R=y.length/l;Gt(e,E,y,a,R,r.interpolate)}this.setReady()}getImagePixelData_(e,t,r){let n=this.gutter,i=this.renderSize_[0],s=this.renderSize_[1];z||hr(),z.clearRect(0,0,1,1);let a=e.width,u=e.height,l=a-2*n,h=u-2*n,c=n+Math.floor(l*(t/i)),f=n+Math.floor(h*(r/s)),d;try{z.drawImage(e,c,f,1,1,0,0,1,1),d=z.getImageData(0,0,1,1).data}catch{return z=null,null}return d}getArrayPixelData_(e,t,r,n){let i=this.gutter,s=this.renderSize_[0],a=this.renderSize_[1],u=t[0],l=t[1],h=u+2*i,c=l+2*i,f=i+Math.floor(u*(r/s)),d=i+Math.floor(l*(n/a));if(e instanceof DataView){let b=e.byteLength/(h*c),C=b*(d*h+f),A=e.buffer.slice(C,C+b);return new DataView(A)}let g=this.bandCount*(d*h+f);return e.slice(g,g+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof _t){let r=this.tile.getData(),n=Ue(r);if(n){let i=this.tile.getSize();return this.getArrayPixelData_(n,i,e,t)}return this.getImagePixelData_(Me(r),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}},Xt=Ve;var He=class o extends wt{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=X(),this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},e.addChangeListener(K.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){let r=this.getLayer();if(r.hasListener(V.PRECOMPOSE)){let n=new me(V.PRECOMPOSE,void 0,t,e);r.dispatchEvent(n)}}dispatchPostComposeEvent(e,t){let r=this.getLayer();if(r.hasListener(V.POSTCOMPOSE)){let n=new me(V.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(n)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,r=-1,n;for(let s=0,a=e.layerStatesArray.length;s<a;s++){let u=e.layerStatesArray[s].layer,l=u.getRenderer();if(!(l instanceof o)){t=!0;continue}let h=u.getClassName();if((t||h!==n)&&(r+=1,t=!1),n=h,l===this)break}let i="map/"+e.mapId+"/group/"+r;(!this.helper||!this.helper.canvasCacheKeyMatches(i)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new Ft({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:i}),n&&(this.helper.getCanvas().className=n),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}clearCache(){}disposeInternal(){this.clearCache(),this.removeHelper(),this.getLayer()?.removeChangeListener(K.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(e,t,r){let n=this.getLayer();if(n.hasListener(e)){pe(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);let i=new me(e,this.inversePixelTransform_,r,t);n.dispatchEvent(i)}}preRender(e,t){this.dispatchRenderEvent_(V.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(V.POSTRENDER,e,t)}},Vt=He;var kt={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function Ht(o){return 1/(o+2)}function dr(){return{tileIds:new Set,representationsByZ:{}}}function Zt(o,e){return o.tileIds.has(M(e))}function Wt(o,e,t){let r=o.representationsByZ;t in r||(r[t]=new Set),r[t].add(e),o.tileIds.add(M(e.tile))}function Ze(o,e){let t=o.layerStatesArray[o.layerIndex];t.extent&&(e=Y(e,fe(t.extent,o.viewState.projection)));let r=t.layer.getRenderSource();if(!r.getWrapX()){let n=r.getTileGridForProjection(o.viewState.projection).getExtent();n&&(e=Y(e,n))}return e}function we(o,e){return`${M(o)},${o.getKey()},${o.getRevision()},${H(e)}`}var We=class extends Vt{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=X(),this.tempMat4=B(),this.tempTileRange_=new Rt(0,0,0,0),this.tempTileCoord_=Ne(0,0,0),this.tempSize_=[0,0];let r=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new yt(r),this.frameState=null,this.renderedProjection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}prepareFrameInternal(e){this.renderedProjection_?e.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=e.viewState.projection):this.renderedProjection_=e.viewState.projection;let r=this.getLayer().getRenderSource();return!r||at(Ze(e,e.extent))?!1:r.getState()==="ready"}createTileRepresentation(e){return de()}enqueueTiles(e,t,r,n,i){let s=e.viewState,a=this.getLayer(),u=a.getRenderSource(),l=u.getTileGridForProjection(s.projection),h=u.getGutterForProjection(s.projection),c=M(u);c in e.wantedTiles||(e.wantedTiles[c]={});let f=e.wantedTiles[c],d=this.tileRepresentationCache,g=a.getMapInternal(),b=Math.max(r-i,l.getMinZoom(),l.getZForResolution(Math.min(a.getMaxResolution(),g?g.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):l.getResolution(0)),u.zDirection)),C=s.rotation,A=C?st(s.center,s.resolution,C,e.size):void 0;for(let T=r;T>=b;--T){let E=l.getTileRangeForExtentAndZ(t,T,this.tempTileRange_),y=l.getResolution(T);for(let R=E.minX;R<=E.maxX;++R)for(let x=E.minY;x<=E.maxY;++x){if(C&&!l.tileCoordIntersectsViewport([T,R,x],A))continue;let v=Ne(T,R,x,this.tempTileCoord_),D=we(u,v),I,S;if(d.containsKey(D)&&(I=d.get(D),S=I.tile),(!I||I.tile.key!==u.getKey())&&(S=u.getTile(T,R,x,e.pixelRatio,s.projection),!S)||Zt(n,S))continue;I?I.setTile(S):(I=this.createTileRepresentation({tile:S,grid:l,helper:this.helper,gutter:h}),d.set(D,I)),Wt(n,I,T);let $=S.getKey();f[$]=!0,S.getState()===O.IDLE&&(e.tileQueue.isKeyQueued($)||e.tileQueue.enqueue([S,c,l.getTileCoordCenter(v),y]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,r,n,i,s,a,u,l,h,c){}renderTileMask(e,t,r,n){}drawTile_(e,t,r,n,i,s,a){if(!t.ready)return;let l=t.tile.tileCoord,h=H(l),c=h in s?s[h]:1,f=a.getResolution(r),d=F(a.getTileSize(r),this.tempSize_),g=a.getOrigin(r),b=a.getTileCoordExtent(l),C=c<1?-1:Ht(r);c<1&&(e.animate=!0);let A=e.viewState,T=A.center[0],E=A.center[1],y=d[0]+2*n,R=d[1]+2*n,x=y/R,v=(T-g[0])/(d[0]*f),D=(g[1]-E)/(d[1]*f),I=A.resolution/f,S=l[1],$=l[2];lt(this.tileTransform_),Ae(this.tileTransform_,2/(e.size[0]*I/y),-2/(e.size[1]*I/y)),ut(this.tileTransform_,A.rotation),Ae(this.tileTransform_,1,1/x),ht(this.tileTransform_,(d[0]*(S-v)-n)/y,(d[1]*($-D)-n)/R),this.renderTile(t,this.tileTransform_,e,i,f,d,g,b,C,n,c)}renderFrame(e){this.frameState=e,this.renderComplete=!0;let t=this.helper.getGL();this.preRender(t,e);let r=e.viewState,n=this.getLayer(),i=n.getRenderSource(),s=i.getTileGridForProjection(r.projection),a=i.getGutterForProjection(r.projection),u=Ze(e,e.extent),l=s.getZForResolution(r.resolution,i.zDirection),h=dr(),c=n.getPreload();if(e.nextExtent){let E=s.getZForResolution(r.nextResolution,i.zDirection),y=Ze(e,e.nextExtent);this.enqueueTiles(e,y,E,h,c)}this.enqueueTiles(e,u,l,h,0),c>0&&setTimeout(()=>{this.enqueueTiles(e,u,l-1,h,c-1)},0);let f={},d=!1,g=h.representationsByZ;if(l in g){let E=M(this),y=e.time;for(let R of g[l]){let x=R.tile;if(x.getState()===O.EMPTY)continue;let v=x.tileCoord;if(R.ready){let S=x.getAlpha(E,y);if(S===1){x.endTransition(E);continue}d=!0;let $=H(v);f[$]=S}if(this.renderComplete=!1,this.findAltTiles_(s,v,l+1,h))continue;let I=s.getMinZoom();for(let S=l-1;S>=I&&!this.findAltTiles_(s,v,S,h);--S);}}let b=Object.keys(g).map(Number).sort(et);if(this.beforeTilesMaskRender(e))for(let E=0,y=b.length;E<y;++E){let R=b[E];for(let x of g[R]){let v=x.tile.tileCoord;if(H(v)in f)continue;let I=s.getTileCoordExtent(v);this.renderTileMask(x,R,I,Ht(R))}}this.beforeTilesRender(e,d);for(let E=0,y=b.length;E<y;++E){let R=b[E];for(let x of g[R]){let v=x.tile.tileCoord;H(v)in f||this.drawTile_(e,x,R,a,u,f,s)}}if(l in g)for(let E of g[l]){let y=E.tile.tileCoord;H(y)in f&&this.drawTile_(e,E,l,a,u,f,s)}this.beforeFinalize(e),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);let A=this.helper.getCanvas(),T=this.tileRepresentationCache;for(;T.canExpireCache();)T.pop().dispose();return this.postRender(t,e),A}beforeFinalize(e){}findAltTiles_(e,t,r,n){let i=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!i)return!1;let s=!0,a=this.tileRepresentationCache,u=this.getLayer().getRenderSource();for(let l=i.minX;l<=i.maxX;++l)for(let h=i.minY;h<=i.maxY;++h){let c=we(u,[r,l,h]),f=!1;if(a.containsKey(c)){let d=a.get(c);d.ready&&!Zt(n,d.tile)&&(Wt(n,d,r),f=!0)}f||(s=!1)}return s}clearCache(){super.clearCache();let e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(e=>e.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}},zt=We;var p=ne(oe({},kt),{TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"}),te={TEXTURE_COORD:"a_textureCoord"},fr=[{name:te.TEXTURE_COORD,size:2,type:k.FLOAT}],ke=class extends zt{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new xe(Q,W),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){let t=this.helper.getGL();for(let r of this.paletteTextures_)r.delete(t)}if(this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);let t=this.helper.getGL();for(let r of this.paletteTextures_)r.getTexture(t)}}afterHelperCreated(){super.afterHelperCreated();let e=this.helper.getGL();for(let t of this.paletteTextures_)t.getTexture(e);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){let e=this.helper.getGL();for(let t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new Xt(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,r,n,i,s,a,u,l,h,c){let f=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(fr);let d=0;for(;d<e.textures.length;){let x=`${p.TILE_TEXTURE_ARRAY}[${d}]`;this.helper.bindTexture(e.textures[d],d,x),++d}for(let x=0;x<this.paletteTextures_.length;++x){let v=this.paletteTextures_[x],D=v.getTexture(f);this.helper.bindTexture(D,d,v.name),++d}let g=r.viewState,b=s[0]+2*h,C=s[1]+2*h,T=e.tile.tileCoord,E=T[1],y=T[2];this.helper.setUniformMatrixValue(p.TILE_TRANSFORM,_e(this.tempMat4,t)),this.helper.setUniformFloatValue(p.TRANSITION_ALPHA,c),this.helper.setUniformFloatValue(p.DEPTH,l);let R=n;h>0&&(R=u,Y(R,n,R)),this.helper.setUniformFloatVec4(p.RENDER_EXTENT,R),this.helper.setUniformFloatValue(p.RESOLUTION,g.resolution),this.helper.setUniformFloatValue(p.ZOOM,g.zoom),this.helper.setUniformFloatValue(p.TEXTURE_PIXEL_WIDTH,b),this.helper.setUniformFloatValue(p.TEXTURE_PIXEL_HEIGHT,C),this.helper.setUniformFloatValue(p.TEXTURE_RESOLUTION,i),this.helper.setUniformFloatValue(p.TEXTURE_ORIGIN_X,a[0]+E*s[0]*i-h*i),this.helper.setUniformFloatValue(p.TEXTURE_ORIGIN_Y,a[1]-y*s[1]*i+h*i),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;let r=this.frameState;if(!r)return null;let n=this.getLayer(),i=ct(r.pixelToCoordinateTransform,e.slice()),s=r.viewState,a=n.getExtent();if(a&&!Ie(fe(a,s.projection),i))return null;let u=n.getSources(it([i]),s.resolution),l,h,c;for(l=u.length-1;l>=0;--l)if(h=u[l],h.getState()==="ready"){if(c=h.getTileGridForProjection(s.projection),h.getWrapX())break;let d=c.getExtent();if(!d||Ie(d,i))break}if(l<0)return null;let f=this.tileRepresentationCache;for(let d=c.getZForResolution(s.resolution);d>=c.getMinZoom();--d){let g=c.getTileCoordForCoordAndZ(i,d),b=we(h,g);if(!f.containsKey(b))continue;let C=f.get(b);if(C.tile.getState()===O.EMPTY)return null;if(!C.loaded)continue;let T=c.getOrigin(d),E=F(c.getTileSize(d)),y=c.getResolution(d),R=(i[0]-T[0])/y-g[1]*E[0],x=(T[1]-i[1])/y-g[2]*E[1];return C.getPixelData(R,x)}return null}disposeInternal(){let e=this.helper;if(e){let t=e.getGL();for(let r of this.paletteTextures_)r.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}},jt=ke;var ze=class{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){let t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}},Yt=ze;function pr(o,e){return`operator_${o}_${Object.keys(e.functions).length}`}function re(o){let e=o.toString();return e.includes(".")?e:e+".0"}function Ke(o){if(o.length<2||o.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${o.length}(${o.map(re).join(", ")})`}function mr(o){let e=Pe(o),t=e.length>3?e[3]:1;return Ke([e[0]/255,e[1]/255,e[2]/255,t])}function gr(o){let e=F(o);return Ke(e)}var je={},Tr=0;function be(o){return o in je||(je[o]=Tr++),je[o]}function Er(o){return re(be(o))}function Ce(o){return"u_var_"+o}function Kt(){return{variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}var Ye="getBandValue",qe="u_paletteTextures",_r="featureId",Rr="geometryType",xr=-9999999;function qt(o,e,t,r){let n=Et(o,e,t);return Je(n,e,r)}function _(o){return(e,t,r)=>{let n=t.args.length,i=new Array(n);for(let s=0;s<n;++s)i[s]=Je(t.args[s],r,e);return o(i,e)}}var yr={[m.Get]:(o,e)=>{let r=e.args[0].value;return r in o.properties||(o.properties[r]={name:r,type:e.type}),"a_prop_"+r},[m.Id]:o=>(o.featureId=!0,"a_"+_r),[m.GeometryType]:o=>(o.geometryType=!0,"a_"+Rr),[m.LineMetric]:()=>"currentLineMetric",[m.Var]:(o,e)=>{let r=e.args[0].value;return r in o.variables||(o.variables[r]={name:r,type:e.type}),Ce(r)},[m.Has]:(o,e)=>{let r=e.args[0].value;return r in o.properties||(o.properties[r]={name:r,type:e.type}),`(a_prop_${r} != ${re(xr)})`},[m.Resolution]:()=>"u_resolution",[m.Zoom]:()=>"u_zoom",[m.Time]:()=>"u_time",[m.Any]:_(o=>`(${o.join(" || ")})`),[m.All]:_(o=>`(${o.join(" && ")})`),[m.Not]:_(([o])=>`(!${o})`),[m.Equal]:_(([o,e])=>`(${o} == ${e})`),[m.NotEqual]:_(([o,e])=>`(${o} != ${e})`),[m.GreaterThan]:_(([o,e])=>`(${o} > ${e})`),[m.GreaterThanOrEqualTo]:_(([o,e])=>`(${o} >= ${e})`),[m.LessThan]:_(([o,e])=>`(${o} < ${e})`),[m.LessThanOrEqualTo]:_(([o,e])=>`(${o} <= ${e})`),[m.Multiply]:_(o=>`(${o.join(" * ")})`),[m.Divide]:_(([o,e])=>`(${o} / ${e})`),[m.Add]:_(o=>`(${o.join(" + ")})`),[m.Subtract]:_(([o,e])=>`(${o} - ${e})`),[m.Clamp]:_(([o,e,t])=>`clamp(${o}, ${e}, ${t})`),[m.Mod]:_(([o,e])=>`mod(${o}, ${e})`),[m.Pow]:_(([o,e])=>`pow(${o}, ${e})`),[m.Abs]:_(([o])=>`abs(${o})`),[m.Floor]:_(([o])=>`floor(${o})`),[m.Ceil]:_(([o])=>`ceil(${o})`),[m.Round]:_(([o])=>`floor(${o} + 0.5)`),[m.Sin]:_(([o])=>`sin(${o})`),[m.Cos]:_(([o])=>`cos(${o})`),[m.Atan]:_(([o,e])=>e!==void 0?`atan(${o}, ${e})`:`atan(${o})`),[m.Sqrt]:_(([o])=>`sqrt(${o})`),[m.Match]:_(o=>{let e=o[0],t=o[o.length-1],r=null;for(let n=o.length-3;n>=1;n-=2){let i=o[n],s=o[n+1];r=`(${e} == ${i} ? ${s} : ${r||t})`}return r}),[m.Between]:_(([o,e,t])=>`(${o} >= ${e} && ${o} <= ${t})`),[m.Interpolate]:_(([o,e,...t])=>{let r="";for(let n=0;n<t.length-2;n+=2){let i=t[n],s=r||t[n+1],a=t[n+2],u=t[n+3],l;o===re(1)?l=`(${e} - ${i}) / (${a} - ${i})`:l=`(pow(${o}, (${e} - ${i})) - 1.0) / (pow(${o}, (${a} - ${i})) - 1.0)`,r=`mix(${s}, ${u}, clamp(${l}, 0.0, 1.0))`}return r}),[m.Case]:_(o=>{let e=o[o.length-1],t=null;for(let r=o.length-3;r>=0;r-=2){let n=o[r],i=o[r+1];t=`(${n} ? ${i} : ${t||e})`}return t}),[m.In]:_(([o,...e],t)=>{let r=pr("in",t),n=[];for(let i=0;i<e.length;i+=1)n.push(`  if (inputValue == ${e[i]}) { return true; }`);return t.functions[r]=`bool ${r}(float inputValue) {
${n.join(`
`)}
  return false;
}`,`${r}(${o})`}),[m.Array]:_(o=>`vec${o.length}(${o.join(", ")})`),[m.Color]:_(o=>{if(o.length===1)return`vec4(vec3(${o[0]} / 255.0), 1.0)`;if(o.length===2)return`vec4(vec3(${o[0]} / 255.0), ${o[1]})`;let e=o.slice(0,3).map(r=>`${r} / 255.0`);if(o.length===3)return`vec4(${e.join(", ")}, 1.0)`;let t=o[3];return`vec4(${e.join(", ")}, ${t})`}),[m.Band]:_(([o,e,t],r)=>{if(!(Ye in r.functions)){let n="",i=r.bandCount||1;for(let s=0;s<i;s++){let a=Math.floor(s/4),u=s%4;s===i-1&&u===1&&(u=3);let l=`${p.TILE_TEXTURE_ARRAY}[${a}]`;n+=`  if (band == ${s+1}.0) {
    return texture2D(${l}, v_textureCoord + vec2(dx, dy))[${u}];
  }
`}r.functions[Ye]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${p.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${p.TEXTURE_PIXEL_HEIGHT};
${n}
}`}return`${Ye}(${o}, ${e??"0.0"}, ${t??"0.0"})`}),[m.Palette]:(o,e)=>{let[t,...r]=e.args,n=r.length,i=new Uint8Array(n*4);for(let l=0;l<r.length;l++){let h=r[l].value,c=Pe(h),f=l*4;i[f]=c[0],i[f+1]=c[1],i[f+2]=c[2],i[f+3]=c[3]*255}o.paletteTextures||(o.paletteTextures=[]);let s=`${qe}[${o.paletteTextures.length}]`,a=new Yt(s,i);o.paletteTextures.push(a);let u=Je(t,U,o);return`texture2D(${s}, vec2((${u} + 0.5) / ${n}.0, 0.5))`}};function Je(o,e,t){if(o instanceof gt){let r=yr[o.operator];if(r===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(o.operator)}`);return r(t,o,e)}if((o.type&U)>0)return re(o.value);if((o.type&ft)>0)return o.value.toString();if((o.type&pt)>0)return Er(o.value.toString());if((o.type&q)>0)return mr(o.value);if((o.type&Le)>0)return Ke(o.value);if((o.type&De)>0)return gr(o.value);throw new Error(`Unexpected expression ${o.value} (expected type ${mt(e)})`)}function Z(o,e,t){let r=Tt();return qt(e,t,r,o)}function Jt(o,e){let t=`
    attribute vec2 ${te.TEXTURE_COORD};
    uniform mat4 ${p.TILE_TRANSFORM};
    uniform float ${p.TEXTURE_PIXEL_WIDTH};
    uniform float ${p.TEXTURE_PIXEL_HEIGHT};
    uniform float ${p.TEXTURE_RESOLUTION};
    uniform float ${p.TEXTURE_ORIGIN_X};
    uniform float ${p.TEXTURE_ORIGIN_Y};
    uniform float ${p.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${te.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${p.TEXTURE_ORIGIN_X} + ${p.TEXTURE_RESOLUTION} * ${p.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${p.TEXTURE_ORIGIN_Y} - ${p.TEXTURE_RESOLUTION} * ${p.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${p.TILE_TRANSFORM} * vec4(${te.TEXTURE_COORD}, ${p.DEPTH}, 1.0);
    }
  `,r=ne(oe({},Kt()),{bandCount:e}),n=[];if(o.color!==void 0){let c=Z(r,o.color,q);n.push(`color = ${c};`)}if(o.contrast!==void 0){let c=Z(r,o.contrast,U);n.push(`color.rgb = clamp((${c} + 1.0) * color.rgb - (${c} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(o.exposure!==void 0){let c=Z(r,o.exposure,U);n.push(`color.rgb = clamp((${c} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(o.saturation!==void 0){let c=Z(r,o.saturation,U);n.push(`
      float saturation = ${c} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(o.gamma!==void 0){let c=Z(r,o.gamma,U);n.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${c}));`)}if(o.brightness!==void 0){let c=Z(r,o.brightness,U);n.push(`color.rgb = clamp(color.rgb + ${c}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}let i={},s=Object.keys(r.variables).length;if(s>1&&!o.variables)throw new Error(`Missing variables in style (expected ${r.variables})`);for(let c=0;c<s;++c){let f=r.variables[Object.keys(r.variables)[c]];if(!(f.name in o.variables))throw new Error(`Missing '${f.name}' in style variables`);let d=Ce(f.name);i[d]=function(){let g=o.variables[f.name];return typeof g=="string"&&(g=be(g)),g!==void 0?g:-9999999}}let a=Object.keys(i).map(function(c){return`uniform float ${c};`}),u=Math.ceil(e/4);a.push(`uniform sampler2D ${p.TILE_TEXTURE_ARRAY}[${u}];`),r.paletteTextures&&a.push(`uniform sampler2D ${qe}[${r.paletteTextures.length}];`);let l=Object.keys(r.functions).map(function(c){return r.functions[c]}),h=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${p.RENDER_EXTENT};
    uniform float ${p.TRANSITION_ALPHA};
    uniform float ${p.TEXTURE_PIXEL_WIDTH};
    uniform float ${p.TEXTURE_PIXEL_HEIGHT};
    uniform float ${p.RESOLUTION};
    uniform float ${p.ZOOM};

    ${a.join(`
`)}

    ${l.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${p.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${p.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${p.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${p.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${p.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${n.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${p.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:h,uniforms:i,paletteTextures:r.paletteTextures}}var Se=class extends bt{constructor(e){e=e?Object.assign({},e):{};let t=e.style||{};delete e.style,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(K.SOURCE,this.handleSourceUpdate_)}getSources(e,t){let r=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:r?[r]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){let e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();let e=this.getSource();if(e)if(e.getState()==="loading"){let t=()=>{e.getState()==="ready"&&(e.removeEventListener("change",t),this.setStyle(this.style_))};e.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){let e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){let e=Jt(this.style_,this.getSourceBandCount_());return new jt(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.getCacheSize(),paletteTextures:e.paletteTextures})}renderSources(e,t){let r=this.getRenderer(),n;for(let i=0,s=t.length;i<s;++i)this.renderedSource_=t[i],r.prepareFrame(e)&&(n=r.renderFrame(e));return n}render(e,t){this.rendered=!0;let r=e.viewState,n=this.getSources(e.extent,r.resolution),i=!0;for(let a=0,u=n.length;a<u;++a){let l=n[a],h=l.getState();if(h=="loading"){let c=()=>{l.getState()=="ready"&&(l.removeEventListener("change",c),this.changed())};l.addEventListener("change",c)}i=i&&h=="ready"}let s=this.renderSources(e,n);if(this.getRenderer().renderComplete&&i)return this.renderedResolution_=r.resolution,s;if(this.renderedResolution_>.5*r.resolution){let a=this.getSources(e.extent,this.renderedResolution_).filter(u=>!n.includes(u));if(a.length>0)return this.renderSources(e,a)}return s}setStyle(e){if(this.styleVariables_=e.variables||{},this.style_=e,this.hasRenderer()){let t=Jt(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}};Se.prototype.dispose;var Qt=Se;var wr=["*"],ve=class o{wolStyle=L();wolVariables=L();wolClassName=L();wolOpacity=w();wolVisible=w();wolExtent=w();wolZIndex=w();wolMinResolution=w();wolMaxResolution=w();wolMinZoom=w();wolMaxZoom=w();wolPreload=w();wolSource=w();wolSources=L();wolMap=L();wolUseInterimTilesOnError=w();wolCacheSize=L();wolProperties=L();wolChange=P();wolError=P();wolPostRender=P();wolPreRender=P();wolPropertyChange=P();wolSourceReady=P();instance;constructor(){let e=N(ie),t=ge("WebGLTileLayer"),r={};le(()=>{let n=new Qt({style:this.wolStyle(),className:this.wolClassName(),opacity:this.wolOpacity(),visible:this.wolVisible(),extent:this.wolExtent(),zIndex:this.wolZIndex(),minResolution:this.wolMinResolution(),maxResolution:this.wolMaxResolution(),minZoom:this.wolMinZoom(),maxZoom:this.wolMaxZoom(),preload:this.wolPreload(),source:this.wolSource(),sources:this.wolSources(),map:this.wolMap(),useInterimTilesOnError:this.wolUseInterimTilesOnError(),cacheSize:this.wolCacheSize(),properties:this.wolProperties()});this.wolVariables()&&n.updateStyleVariables(this.wolVariables()??{}),r.change=n.on("change",i=>this.wolChange.emit(i)),r["change:extent"]=n.on("change:extent",()=>this.wolExtent.set(n.getExtent())),r["change:maxResolution"]=n.on("change:maxResolution",()=>this.wolMaxResolution.set(n.getMaxResolution())),r["change:maxZoom"]=n.on("change:maxZoom",()=>this.wolMaxZoom.set(n.getMaxZoom())),r["change:minResolution"]=n.on("change:minResolution",()=>this.wolMinResolution.set(n.getMinResolution())),r["change:minZoom"]=n.on("change:minZoom",()=>this.wolMinZoom.set(n.getMinZoom())),r["change:opacity"]=n.on("change:opacity",()=>this.wolOpacity.set(n.getOpacity())),r["change:preload"]=n.on("change:preload",()=>this.wolPreload.set(n.getPreload())),r["change:source"]=n.on("change:source",()=>this.wolSource.set(n.getSource()??void 0)),r["change:useInterimTilesOnError"]=n.on("change:useInterimTilesOnError",()=>this.wolUseInterimTilesOnError.set(n.getUseInterimTilesOnError())),r["change:visible"]=n.on("change:visible",()=>this.wolVisible.set(n.getVisible())),r["change:zIndex"]=n.on("change:zIndex",()=>this.wolZIndex.set(n.getZIndex())),r.error=n.on("error",i=>this.wolError.emit(i)),r.postrender=n.on("postrender",i=>this.wolPostRender.emit(i)),r.prerender=n.on("prerender",i=>this.wolPreRender.emit(i)),r.propertychange=n.on("propertychange",i=>this.wolPropertyChange.emit(i)),r.sourceready=n.on("sourceready",i=>this.wolSourceReady.emit(i)),Promise.resolve().then(()=>{t.addLayer(n)}),this.instance=n}),e.onDestroy(()=>{this.instance&&(he(Object.values(r)),t.removeLayer(this.instance),this.instance=void 0)})}ngOnChanges(e){if(this.instance)for(let[t,r]of Object.entries(e))switch(t){case"wolExtent":this.instance.setExtent(r.currentValue);break;case"wolMap":this.instance.setMap(r.currentValue);break;case"wolMaxResolution":this.instance.setMaxResolution(r.currentValue);break;case"wolMaxZoom":this.instance.setMaxZoom(r.currentValue);break;case"wolMinResolution":this.instance.setMinResolution(r.currentValue);break;case"wolMinZoom":this.instance.setMinZoom(r.currentValue);break;case"wolOpacity":this.instance.setOpacity(r.currentValue);break;case"wolPreload":this.instance.setPreload(r.currentValue);break;case"wolProperties":this.instance.setProperties(r.currentValue);break;case"wolSource":this.instance.setSource(r.currentValue);break;case"wolUseInterimTilesOnError":this.instance.setUseInterimTilesOnError(r.currentValue);break;case"wolVisible":this.instance.setVisible(r.currentValue);break;case"wolZIndex":this.instance.setZIndex(r.currentValue);break;case"wolVariables":this.instance.updateStyleVariables(r.currentValue??{});break}}getInstance(){return this.instance}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=ae({type:o,selectors:[["wol-webgl-tile-layer"]],inputs:{wolStyle:[1,"wolStyle"],wolVariables:[1,"wolVariables"],wolClassName:[1,"wolClassName"],wolOpacity:[1,"wolOpacity"],wolVisible:[1,"wolVisible"],wolExtent:[1,"wolExtent"],wolZIndex:[1,"wolZIndex"],wolMinResolution:[1,"wolMinResolution"],wolMaxResolution:[1,"wolMaxResolution"],wolMinZoom:[1,"wolMinZoom"],wolMaxZoom:[1,"wolMaxZoom"],wolPreload:[1,"wolPreload"],wolSource:[1,"wolSource"],wolSources:[1,"wolSources"],wolMap:[1,"wolMap"],wolUseInterimTilesOnError:[1,"wolUseInterimTilesOnError"],wolCacheSize:[1,"wolCacheSize"],wolProperties:[1,"wolProperties"]},outputs:{wolOpacity:"wolOpacityChange",wolVisible:"wolVisibleChange",wolExtent:"wolExtentChange",wolZIndex:"wolZIndexChange",wolMinResolution:"wolMinResolutionChange",wolMaxResolution:"wolMaxResolutionChange",wolMinZoom:"wolMinZoomChange",wolMaxZoom:"wolMaxZoomChange",wolPreload:"wolPreloadChange",wolSource:"wolSourceChange",wolUseInterimTilesOnError:"wolUseInterimTilesOnErrorChange",wolChange:"wolChange",wolError:"wolError",wolPostRender:"wolPostRender",wolPreRender:"wolPreRender",wolPropertyChange:"wolPropertyChange",wolSourceReady:"wolSourceReady"},features:[se],ngContentSelectors:wr,decls:1,vars:0,template:function(t,r){t&1&&(ce(),ue(0))},encapsulation:2,changeDetection:0})};function Mn(o){let e={host:!0,optional:!0},t=N(St,e),r=N(ve,e),n=N(Ee,e);if(t)return{setSource:i=>(t.addSource(i),()=>{t.removeSource(i)}),getInstance:()=>t.getInstance()};if(r)return{setSource:i=>(r.getInstance()?.setSource(i),()=>{r.getInstance()?.setSource(null)}),getInstance:()=>r.getInstance()};if(n)return{setSource:i=>(n.getInstance()?.setSource(i),()=>{n.getInstance()?.setSource(null)}),getInstance:()=>n.getInstance()};throw new Error(`No TileSource host found. Please wrap the ${o} component in a RasterSource, WebGLTileLayer or TileLayer component.`)}var Nn={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"};export{Ee as a,Ur as b,Nr as c,Or as d,Fr as e,ve as f,Mn as g,Nn as h};
