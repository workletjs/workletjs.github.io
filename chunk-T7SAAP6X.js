import{H as R,M as O,Q as G,hb as g,kb as P,oc as S}from"./chunk-6YFIEOLQ.js";import{E as I}from"./chunk-X3B7ZQOC.js";import{B as C,C as N,F as b,G as j,H,f as _,g as M}from"./chunk-O23OEJHM.js";var w=class extends P{constructor(t,c,r,i,e){let n=e!==void 0?g.IDLE:g.LOADED;super(t,c,r,n),this.loader_=e!==void 0?e:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(t){t?(this.error_=t,this.state=g.ERROR):this.state=g.LOADED,this.changed()}load(){this.state==g.IDLE&&(this.state=g.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}},q=w;var A=class extends S{constructor(t){super(t),this.image=null}getImage(){return this.image?this.image.getImage():null}prepareFrame(t){let c=t.layerStatesArray[t.layerIndex],r=t.pixelRatio,i=t.viewState,e=i.resolution,n=this.getLayer().getSource(),o=t.viewHints,s=t.extent;if(c.extent!==void 0&&(s=N(s,I(c.extent,i.projection))),!o[R.ANIMATING]&&!o[R.INTERACTING]&&!H(s))if(n){let h=i.projection,a=n.getImage(s,e,r,h);a&&(this.loadImage(a)?this.image=a:a.getState()===g.EMPTY&&(this.image=null))}else this.image=null;return!!this.image}getData(t){let c=this.frameState;if(!c)return null;let r=this.getLayer(),i=O(c.pixelToCoordinateTransform,t.slice()),e=r.getExtent();if(e&&!_(e,i))return null;let n=this.image.getExtent(),o=this.image.getImage(),s=b(n),h=Math.floor(o.width*((i[0]-n[0])/s));if(h<0||h>=o.width)return null;let a=C(n),m=Math.floor(o.height*((n[3]-i[1])/a));return m<0||m>=o.height?null:this.getImageData(o,h,m)}renderFrame(t,c){let r=this.image,i=r.getExtent(),e=r.getResolution(),[n,o]=Array.isArray(e)?e:[e,e],s=r.getPixelRatio(),h=t.layerStatesArray[t.layerIndex],a=t.pixelRatio,m=t.viewState,v=m.center,L=m.resolution,W=a*n/(L*s),Y=a*o/(L*s);this.prepareContainer(t,c);let F=this.context.canvas.width,U=this.context.canvas.height,l=this.getRenderContext(t),f=!1,y=!0;if(h.extent){let u=I(h.extent,m.projection);y=j(u,t.extent),f=y&&!M(u,t.extent),f&&this.clipUnrotated(l,t,u)}let p=r.getImage(),x=G(this.tempTransform,F/2,U/2,W,Y,0,s*(i[0]-v[0])/n,s*(v[1]-i[3])/o);this.renderedResolution=o*a/s;let D=p.width*x[0],T=p.height*x[3];if(this.getLayer().getSource().getInterpolate()||(l.imageSmoothingEnabled=!1),this.preRender(l,t),y&&D>=.5&&T>=.5){let u=x[4],X=x[5],E=h.opacity;E!==1&&(l.save(),l.globalAlpha=E),l.drawImage(p,0,0,+p.width,+p.height,u,X,D,T),E!==1&&l.restore()}return this.postRender(this.context,t),f&&l.restore(),l.imageSmoothingEnabled=!0,this.container}},tt=A;function it(d){return Array.isArray(d)?Math.min(...d):d}export{q as a,tt as b,it as c};
