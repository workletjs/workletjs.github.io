import{a as O,c as de,d as he}from"./chunk-A7WD67KO.js";import{b as oe}from"./chunk-NXYYSKB5.js";import{a as N,b as ae,c as ce}from"./chunk-ENVA6ECF.js";import{a as U}from"./chunk-MHHSODTU.js";import{B as A,D as P,Na as k,a as b,cb as ee,db as j,fb as te,hb as ie,i as K,kc as se,mb as re,nb as ne,q as z,w as R,wa as L,z as x}from"./chunk-ML66Q7BB.js";import{B as E,C as _,D as Z,E as $,z as C}from"./chunk-7JDMKNL2.js";import{da as B,ha as p,ka as V,la as v,ma as Q,o as m,p as J,z as G}from"./chunk-247T7M3Z.js";var ge=0,M=1,le=[0,0,0,0],S=[],q={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function W(f,e,t){let i;switch(e){case"LineString":i=f;break;case"MultiLineString":case"Polygon":i=f[t[0]];break;case"MultiPolygon":i=f[t[1]][t[0]];break;default:}return i}var w=class extends z{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}},H=class extends ne{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:re,this.defaultDeleteCondition_=function(i){return ee(i)&&ie(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:j,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new ae,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new oe({source:new ce({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:pe(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new A(this.source_.getFeatures()),this.source_.addEventListener(N.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(N.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(R.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(R.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;e?e===!0?t=j:t=e:t=te,this.traceCondition_=t}addFeature_(e){let t=e.getGeometry();if(t){let n=this.SEGMENT_WRITERS_[t.getType()];n&&n(e,t)}let i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(b.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new A;let i=this.featuresBeingModified_.getArray();for(let n=0,r=t.length;n<r;++n){let s=t[n].feature;s&&!i.includes(s)&&this.featuresBeingModified_.push(s)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new w(q.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(b.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){let t=this.rBush_,i=[];t.forEach(function(n){e===n.feature&&i.push(n)});for(let n=i.length-1;n>=0;--n){let r=i[n];for(let s=this.dragSegments_.length-1;s>=0;--s)this.dragSegments_[s][0]===r&&this.dragSegments_.splice(s,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){let t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){let i=t.getCoordinates(),n={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),n)}writeMultiPointGeometry_(e,t){let i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){let s=i[n],o={feature:e,geometry:t,depth:[n],index:n,segment:[s,s]};this.rBush_.insert(t.getExtent(),o)}}writeLineStringGeometry_(e,t){let i=t.getCoordinates();for(let n=0,r=i.length-1;n<r;++n){let s=i.slice(n,n+2),o={feature:e,geometry:t,index:n,segment:s};this.rBush_.insert(m(s),o)}}writeMultiLineStringGeometry_(e,t){let i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){let s=i[n];for(let o=0,a=s.length-1;o<a;++o){let c=s.slice(o,o+2),d={feature:e,geometry:t,depth:[n],index:o,segment:c};this.rBush_.insert(m(c),d)}}}writePolygonGeometry_(e,t){let i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){let s=i[n];for(let o=0,a=s.length-1;o<a;++o){let c=s.slice(o,o+2),d={feature:e,geometry:t,depth:[n],index:o,segment:c};this.rBush_.insert(m(c),d)}}}writeMultiPolygonGeometry_(e,t){let i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){let s=i[n];for(let o=0,a=s.length;o<a;++o){let c=s[o];for(let d=0,h=c.length-1;d<h;++d){let l=c.slice(d,d+2),g={feature:e,geometry:t,depth:[o,n],index:d,segment:l};this.rBush_.insert(m(l),g)}}}}writeCircleGeometry_(e,t){let i=t.getCenter(),n={feature:e,geometry:t,index:ge,segment:[i,i]},r={feature:e,geometry:t,index:M,segment:[i,i]},s=[n,r];n.featureSegments=s,r.featureSegments=s,this.rBush_.insert(G(i),n);let o=t,a=C();if(a&&this.getMap()){let c=this.getMap().getView().getProjection();o=o.clone().transform(a,c),o=k(o).transform(c,a)}this.rBush_.insert(o.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){let i=t.getGeometriesArray();for(let n=0;n<i.length;++n){let r=i[n],s=this.SEGMENT_WRITERS_[r.getType()];s(e,r)}}createOrUpdateVertexFeature_(e,t,i,n){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(e):(r=new U(new L(e)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",t),r.set("geometries",i),r.set("existing",n),r}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==P.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=P.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==P.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;let i=this.getMap().getView().getProjection(),n=[],r=this.vertexFeature_.getGeometry().getCoordinates(),s=m([r]),o=this.rBush_.getInExtent(s),a={};o.sort(_e);for(let c=0,d=o.length;c<d;++c){let h=o[c],l=h.segment,g=x(h.geometry),u=h.depth;if(u&&(g+="-"+u.join("-")),a[g]||(a[g]=new Array(2)),h.geometry.getType()==="Circle"&&h.index===M){let y=fe(e,h,i);p(y,r)&&!a[g][0]&&(this.dragSegments_.push([h,0]),a[g][0]=h);continue}if(p(l[0],r)&&!a[g][0]){this.dragSegments_.push([h,0]),a[g][0]=h;continue}if(p(l[1],r)&&!a[g][1]){if(a[g][0]&&a[g][0].index===0){let y=h.geometry.getCoordinates();switch(h.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":y=y[u[1]];case"Polygon":if(h.index!==y[u[0]].length-2)continue;break;default:}}this.dragSegments_.push([h,1]),a[g][1]=h;continue}x(l)in this.vertexSegments_&&!a[g][0]&&!a[g][1]&&n.push(h)}return n}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){let t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){let r=e.map.getPixelFromCoordinate(t.startCoord);if(v(r,e.pixel)<this.pixelTolerance_)return}let i=de(e.coordinate,t,e.map,this.pixelTolerance_);if(t.targetIndex===-1&&Math.sqrt(i.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(t.targetIndex!==i.index){if(t.targetIndex!==-1){let s=t.targets[t.targetIndex];this.removeTracedCoordinates_(s.startIndex,s.endIndex)}else for(let s of this.traceSegments_){let o=s[0],a=o.geometry,c=s[1],d=a.getCoordinates();W(d,a.getType(),o.depth).splice(o.index+c,1),a.setCoordinates(d),c===0&&(o.index-=1)}let r=t.targets[i.index];this.addTracedCoordinates_(r,r.startIndex,i.endIndex)}else{let r=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(r,i.endIndex)}t.targetIndex=i.index;let n=t.targets[t.targetIndex];n.endIndex=i.endIndex}getTraceCandidates_(e){let t=this.getMap(),i=this.pixelTolerance_,n=t.getCoordinateFromPixel([e.pixel[0]-i,e.pixel[1]+i]),r=t.getCoordinateFromPixel([e.pixel[0]+i,e.pixel[1]-i]),s=m([n,r]);return this.traceSource_.getFeaturesInExtent(s)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}let t=this.getTraceCandidates_(e);if(t.length===0)return;let i=he(e.coordinate,t);i.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:i,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){let i=e.startIndex<=e.endIndex,n=e.startIndex<=t;i===n?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){let n=Math.ceil(e),r=Math.floor(t);r===t&&(r-=1),i=r-n+1}else{let n=Math.floor(e),r=Math.ceil(t);r===t&&(r+=1),i=n-r+1}if(i>0)for(let n of this.traceSegments_){let r=n[0],s=r.geometry,o=n[1],a=n[0].index+1;o===1&&(a-=i);let c=s.getCoordinates();W(c,s.getType(),r.depth).splice(a,i),s.setCoordinates(c),o===1&&(r.index-=i)}}addTracedCoordinates_(e,t,i){if(t===i)return;let n=[];if(t<i){let r=Math.ceil(t),s=Math.floor(i);s===i&&(s-=1);for(let o=r;o<=s;++o)n.push(O(e.coordinates,o))}else{let r=Math.floor(t),s=Math.ceil(i);s===i&&(s+=1);for(let o=r;o>=s;--o)n.push(O(e.coordinates,o))}if(n.length)for(let r of this.traceSegments_){let s=r[0],o=s.geometry,a=r[1],c=s.index+1;a===0&&n.reverse();let d=o.getCoordinates();W(d,o.getType(),s.depth).splice(c,0,...n),o.setCoordinates(d),a===1&&(s.index+=n.length)}}updateGeometry_(e,t){let i=t[0],n=i.depth,r,s=i.segment,o=i.geometry,a=t[1];for(;e.length<o.getStride();)e.push(s[a][e.length]);switch(o.getType()){case"Point":r=e,s[0]=e,s[1]=e;break;case"MultiPoint":r=o.getCoordinates(),r[i.index]=e,s[0]=e,s[1]=e;break;case"LineString":r=o.getCoordinates(),r[i.index+a]=e,s[a]=e;break;case"MultiLineString":r=o.getCoordinates(),r[n[0]][i.index+a]=e,s[a]=e;break;case"Polygon":r=o.getCoordinates(),r[n[0]][i.index+a]=e,s[a]=e;break;case"MultiPolygon":r=o.getCoordinates(),r[n[1]][n[0]][i.index+a]=e,s[a]=e;break;case"Circle":let c=o;if(s[0]=e,s[1]=e,i.index===ge)this.changingFeature_=!0,c.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0;let d=this.getMap().getView().getProjection(),h=v(_(c.getCenter(),d),_(e,d)),l=C();if(l){let g=c.clone().transform(l,d);g.setRadius(h),h=g.transform(d,l).getRadius()}c.setRadius(h),this.changingFeature_=!1}break;default:}r&&this.setGeometryCoordinates_(o,r)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([s])=>s));let t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],n=[],r=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(r){this.traceSegments_=[];for(let s of this.dragSegments_){let o=s[0];v(B(r,o.segment),r)/e.map.getView().getResolution()<1&&this.traceSegments_.push(s)}}for(let s=0,o=this.dragSegments_.length;s<o;++s){let a=this.dragSegments_[s],c=a[0],d=c.feature;i.includes(d)||i.push(d);let h=c.geometry;n.includes(h)||n.push(h),this.updateGeometry_(t,a)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,i,n,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;let t=e.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(t);if(i?.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,i),this.vertexFeature_)){let n=this.vertexFeature_.getGeometry().getCoordinates();for(let r=i.length-1;r>=0;--r)this.insertVertex_(i[r],n);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){let i=this.dragSegments_[t][0],n=i.geometry;if(n.getType()==="Circle"){let r=n,s=r.getCenter(),o=i.featureSegments[0],a=i.featureSegments[1];o.segment[0]=s,o.segment[1]=s,a.segment[0]=s,a.segment[1]=s,this.rBush_.update(G(s),o);let c=r,d=C();if(d){let h=e.map.getView().getProjection();c=c.clone().transform(d,h),c=k(c).transform(h,d)}this.rBush_.update(c.getExtent(),a)}else this.rBush_.update(m(i.segment),i)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new w(q.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){let t=this.getMap(),i=t.getPixelFromCoordinate(e),n=t.getView().getProjection(),r=function(a,c){return ue(e,a,n)-ue(e,c,n)},s,o;if(this.hitDetection_){let a=typeof this.hitDetection_=="object"?c=>c===this.hitDetection_:void 0;t.forEachFeatureAtPixel(i,(c,d,h)=>{h&&h.getType()==="Point"&&(h=new L(E(h.getCoordinates(),n)));let l=h||c.getGeometry();if(l&&l.getType()==="Point"&&c instanceof U&&this.features_.getArray().includes(c)){o=l;let g=c.getGeometry().getFlatCoordinates().slice(0,2);s=[{feature:c,geometry:o,segment:[g,g]}]}return!0},{layerFilter:a})}if(!s){let a=$(G(e,le),n),c=t.getView().getResolution()*this.pixelTolerance_,d=Z(J(a,c,le),n);s=this.rBush_.getInExtent(d)}if(s&&s.length>0){let a=s.sort(r)[0],c=a.segment,d=fe(e,a,n),h=t.getPixelFromCoordinate(d),l=v(i,h);if(o||l<=this.pixelTolerance_){let g={};if(g[x(c)]=!0,this.snapToPointer_||(this.delta_[0]=d[0]-e[0],this.delta_[1]=d[1]-e[1]),a.geometry.getType()==="Circle"&&a.index===M)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(d,[a.feature],[a.geometry],this.snappedToVertex_);else{let u=t.getPixelFromCoordinate(c[0]),y=t.getPixelFromCoordinate(c[1]),F=V(h,u),Y=V(h,y);if(l=Math.sqrt(Math.min(F,Y)),this.snappedToVertex_=l<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(d=F>Y?c[1]:c[0]),this.createOrUpdateVertexFeature_(d,[a.feature],[a.geometry],this.snappedToVertex_);let I={};I[x(a.geometry)]=!0;for(let D=1,me=s.length;D<me;++D){let T=s[D].segment;if(p(c[0],T[0])&&p(c[1],T[1])||p(c[0],T[1])&&p(c[1],T[0])){let X=x(s[D].geometry);X in I||(I[X]=!0,g[x(T)]=!0)}else break}}this.vertexSegments_=g;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){let i=e.segment,n=e.feature,r=e.geometry,s=e.depth,o=e.index,a;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":a=r.getCoordinates(),a[s[0]].splice(o+1,0,t);break;case"Polygon":a=r.getCoordinates(),a[s[0]].splice(o+1,0,t);break;case"MultiPolygon":a=r.getCoordinates(),a[s[1]][s[0]].splice(o+1,0,t);break;case"LineString":a=r.getCoordinates(),a.splice(o+1,0,t);break;default:return!1}this.setGeometryCoordinates_(r,a);let c=this.rBush_;c.remove(e),this.updateSegmentIndices_(r,o,s,1);let d={segment:[i[0],t],feature:n,geometry:r,depth:s,index:o};c.insert(m(d.segment),d),this.dragSegments_.push([d,1]);let h={segment:[t,i[1]],feature:n,geometry:r,depth:s,index:o+1};return c.insert(m(h.segment),h),this.dragSegments_.push([h,0]),!0}updatePointer_(e){return e&&this.findInsertVerticesAndUpdateDragSegments_(e),this.vertexFeature_?.getGeometry().getCoordinates()}getPoint(){let e=this.vertexFeature_?.getGeometry().getCoordinates();return e?E(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;let e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(m([e])).some(({segment:i})=>p(i[0],e)||p(i[1],e))}removePoint(e){if(e&&(e=_(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=P.POINTERDRAG){let t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([n])=>n));let i=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new w(q.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,i}return!1}removeVertex_(){let e=this.dragSegments_,t={},i=!1,n,r,s,o,a,c,d,h,l,g,u;for(a=e.length-1;a>=0;--a)s=e[a],g=s[0],u=x(g.feature),g.depth&&(u+="-"+g.depth.join("-")),u in t||(t[u]={}),s[1]===0?(t[u].right=g,t[u].index=g.index):s[1]==1&&(t[u].left=g,t[u].index=g.index+1);for(u in t){switch(l=t[u].right,d=t[u].left,c=t[u].index,h=c-1,d!==void 0?g=d:g=l,h<0&&(h=0),o=g.geometry,r=o.getCoordinates(),n=r,i=!1,o.getType()){case"MultiLineString":r[g.depth[0]].length>2&&(r[g.depth[0]].splice(c,1),i=!0);break;case"LineString":r.length>2&&(r.splice(c,1),i=!0);break;case"MultiPolygon":n=n[g.depth[1]];case"Polygon":n=n[g.depth[0]],n.length>4&&(c==n.length-1&&(c=0),n.splice(c,1),i=!0,c===0&&(n.pop(),n.push(n[0]),h=n.length-1));break;default:}if(i){this.setGeometryCoordinates_(o,r);let y=[];if(d!==void 0&&(this.rBush_.remove(d),y.push(d.segment[0])),l!==void 0&&(this.rBush_.remove(l),y.push(l.segment[1])),d!==void 0&&l!==void 0){let F={depth:g.depth,feature:g.feature,geometry:g.geometry,index:h,segment:y};this.rBush_.insert(m(F.segment),F)}this.updateSegmentIndices_(o,c,g.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;let e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(m([e])).some(({segment:i})=>!(p(i[0],e)||p(i[1],e)))}insertPoint(e){let t=e?_(e,this.getMap().getView().getProjection()):this.vertexFeature_?.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((n,r)=>n||this.insertVertex_(r,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,n){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(i===void 0||r.depth===void 0||K(r.depth,i))&&r.index>t&&(r.index+=n)})}};function _e(f,e){return f.index-e.index}function ue(f,e,t){let i=e.geometry;if(i.getType()==="Circle"){let r=i;if(e.index===M){let s=C();s&&(r=r.clone().transform(s,t));let o=V(r.getCenter(),_(f,t)),a=Math.sqrt(o)-r.getRadius();return a*a}}let n=_(f,t);return S[0]=_(e.segment[0],t),S[1]=_(e.segment[1],t),Q(n,S)}function fe(f,e,t){let i=e.geometry;if(i.getType()==="Circle"&&e.index===M){let r=i,s=C();return s&&(r=r.clone().transform(s,t)),E(r.getClosestPoint(_(f,t)),t)}let n=_(f,t);return S[0]=_(e.segment[0],t),S[1]=_(e.segment[1],t),E(B(n,S),t)}function pe(){let f=se();return function(e,t){return f.Point}}var je=H;export{je as a};
