import{a}from"./chunk-PBQ7LJTU.js";import{e as L}from"./chunk-6BYOJ3FH.js";import{Pb as A}from"./chunk-ML66Q7BB.js";import{m as E}from"./chunk-7JDMKNL2.js";import{M as R,O as T,S as I,aa as S,j as d,k as f}from"./chunk-247T7M3Z.js";var M="1.3.0",P=[101,101];function F(e,n,r,i,c){c.WIDTH=r[0],c.HEIGHT=r[1];let t=i.getAxisOrientation(),s=S(c.VERSION,"1.3")>=0;c[s?"CRS":"SRS"]=i.getCode();let g=s&&t.startsWith("ne")?[n[1],n[0],n[3],n[2]]:n;return c.BBOX=g.join(","),a(e,c)}function b(e,n,r,i,c,t,s){t=Object.assign({REQUEST:"GetMap"},t);let g=n/r,o=[d(I(e)/g,4),d(T(e)/g,4)];if(r!=1)switch(s){case"geoserver":let u=90*r+.5|0;"FORMAT_OPTIONS"in t?t.FORMAT_OPTIONS+=";dpi:"+u:t.FORMAT_OPTIONS="dpi:"+u;break;case"mapserver":t.MAP_RESOLUTION=90*r;break;case"carmentaserver":case"qgis":t.DPI=90*r;break;default:throw new Error("Unknown `serverType` configured")}return F(c,e,o,i,t)}function N(e,n){return Object.assign({REQUEST:n,SERVICE:"WMS",VERSION:M,FORMAT:"image/png",STYLES:"",TRANSPARENT:"TRUE"},e)}function _(e){let n=e.hidpi===void 0?!0:e.hidpi,r=E(e.projection||"EPSG:3857"),i=e.ratio||1.5,c=e.load||A,t=e.crossOrigin??null;return(s,g,o)=>{s=L(s,g,o,i),o!=1&&(!n||e.serverType===void 0)&&(o=1);let m=b(s,g,o,r,e.url,N(e.params,"GetMap"),e.serverType),u=new Image;return u.crossOrigin=t,c(u,m).then(U=>({image:U,extent:s,pixelRatio:o}))}}function v(e,n,r){if(e.url===void 0)return;let i=E(e.projection||"EPSG:3857"),c=R(n,r,0,P),t={QUERY_LAYERS:e.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(t,N(e.params,"GetFeatureInfo"),e.params);let s=f((n[0]-c[0])/r,4),g=f((c[3]-n[1])/r,4),o=S(t.VERSION,"1.3")>=0;return t[o?"I":"X"]=s,t[o?"J":"Y"]=g,F(e.url,c,P,i,t)}function Y(e,n){if(e.url===void 0)return;let r={SERVICE:"WMS",VERSION:M,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(n!==void 0){let i=E(e.projection||"EPSG:3857").getMetersPerUnit()||1,c=28e-5;r.SCALE=n*i/c}if(Object.assign(r,e.params),e.params!==void 0&&r.LAYER===void 0){let i=r.LAYERS;if(!(!Array.isArray(i)||i.length!==1))return;r.LAYER=i}return a(e.url,r)}export{M as a,b,N as c,_ as d,v as e,Y as f};
