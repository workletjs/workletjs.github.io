import{b as B}from"./chunk-7HHBZXLC.js";import{a as U,b as $}from"./chunk-6BYOJ3FH.js";import{h as i,i as O,j as k,m as X,o as W,p as j,q as G,u as w}from"./chunk-B56AARNY.js";import{Bb as p,Db as V,tb as L,v as C,xc as I}from"./chunk-ML66Q7BB.js";import{Aa as S,S as m,Sb as c,Tb as u,Wb as s,_ as R,fa as x,kb as M,lb as v,ra as T}from"./chunk-DTKK3HU7.js";import{a as Z,b as D}from"./chunk-TWZW5B45.js";var Y=["*"],_=class a{wolClassName=u();wolOpacity=s();wolVisible=s();wolExtent=s();wolZIndex=s();wolMinResolution=s();wolMaxResolution=s();wolMinZoom=s();wolMaxZoom=s();wolPreload=s();wolSource=s();wolMap=u();wolBackground=u();wolUseInterimTilesOnError=s();wolProperties=u();wolCacheSize=u();wolChange=c();wolError=c();wolPostRender=c();wolPreRender=c();wolPropertyChange=c();wolSourceReady=c();instance;constructor(){let n=m(R),t=I("TileLayer"),e={};T(()=>{let o=new $({className:this.wolClassName(),opacity:this.wolOpacity(),visible:this.wolVisible(),extent:this.wolExtent(),zIndex:this.wolZIndex(),minResolution:this.wolMinResolution(),maxResolution:this.wolMaxResolution(),minZoom:this.wolMinZoom(),maxZoom:this.wolMaxZoom(),preload:this.wolPreload(),source:this.wolSource(),map:this.wolMap(),background:this.wolBackground(),useInterimTilesOnError:this.wolUseInterimTilesOnError(),properties:this.wolProperties(),cacheSize:this.wolCacheSize()});e.change=o.on("change",r=>this.wolChange.emit(r)),e["change:extent"]=o.on("change:extent",()=>this.wolExtent.set(o.getExtent())),e["change:maxResolution"]=o.on("change:maxResolution",()=>this.wolMaxResolution.set(o.getMaxResolution())),e["change:maxZoom"]=o.on("change:maxZoom",()=>this.wolMaxZoom.set(o.getMaxZoom())),e["change:minResolution"]=o.on("change:minResolution",()=>this.wolMinResolution.set(o.getMinResolution())),e["change:minZoom"]=o.on("change:minZoom",()=>this.wolMinZoom.set(o.getMinZoom())),e["change:opacity"]=o.on("change:opacity",()=>this.wolOpacity.set(o.getOpacity())),e["change:preload"]=o.on("change:preload",()=>this.wolPreload.set(o.getPreload())),e["change:source"]=o.on("change:source",()=>this.wolSource.set(o.getSource()??void 0)),e["change:useInterimTilesOnError"]=o.on("change:useInterimTilesOnError",()=>this.wolUseInterimTilesOnError.set(o.getUseInterimTilesOnError())),e["change:visible"]=o.on("change:visible",()=>this.wolVisible.set(o.getVisible())),e["change:zIndex"]=o.on("change:zIndex",()=>this.wolZIndex.set(o.getZIndex())),e.error=o.on("error",r=>this.wolError.emit(r)),e.postrender=o.on("postrender",r=>this.wolPostRender.emit(r)),e.prerender=o.on("prerender",r=>this.wolPreRender.emit(r)),e.propertychange=o.on("propertychange",r=>this.wolPropertyChange.emit(r)),e.sourceready=o.on("sourceready",r=>this.wolSourceReady.emit(r)),Promise.resolve().then(()=>{t.addLayer(o)}),this.instance=o}),n.onDestroy(()=>{this.instance&&(C(Object.values(e)),t.removeLayer(this.instance),this.instance=void 0)})}ngOnChanges(n){if(this.instance)for(let[t,e]of Object.entries(n))switch(t){case"wolExtent":this.instance.setExtent(e.currentValue);break;case"wolMap":this.instance.setMap(e.currentValue??null);break;case"wolMaxResolution":this.instance.setMaxResolution(e.currentValue);break;case"wolMaxZoom":this.instance.setMaxZoom(e.currentValue);break;case"wolMinResolution":this.instance.setMinResolution(e.currentValue);break;case"wolMinZoom":this.instance.setMinZoom(e.currentValue);break;case"wolOpacity":this.instance.setOpacity(e.currentValue);break;case"wolPreload":this.instance.setPreload(e.currentValue);break;case"wolProperties":this.instance.setProperties(e.currentValue);break;case"wolSource":this.instance.setSource(e.currentValue);break;case"wolUseInterimTilesOnError":this.instance.setUseInterimTilesOnError(e.currentValue);break;case"wolVisible":this.instance.setVisible(e.currentValue);break;case"wolZIndex":this.instance.setZIndex(e.currentValue);break}}getInstance(){return this.instance}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=S({type:a,selectors:[["wol-tile-layer"]],inputs:{wolClassName:[1,"wolClassName"],wolOpacity:[1,"wolOpacity"],wolVisible:[1,"wolVisible"],wolExtent:[1,"wolExtent"],wolZIndex:[1,"wolZIndex"],wolMinResolution:[1,"wolMinResolution"],wolMaxResolution:[1,"wolMaxResolution"],wolMinZoom:[1,"wolMinZoom"],wolMaxZoom:[1,"wolMaxZoom"],wolPreload:[1,"wolPreload"],wolSource:[1,"wolSource"],wolMap:[1,"wolMap"],wolBackground:[1,"wolBackground"],wolUseInterimTilesOnError:[1,"wolUseInterimTilesOnError"],wolProperties:[1,"wolProperties"],wolCacheSize:[1,"wolCacheSize"]},outputs:{wolOpacity:"wolOpacityChange",wolVisible:"wolVisibleChange",wolExtent:"wolExtentChange",wolZIndex:"wolZIndexChange",wolMinResolution:"wolMinResolutionChange",wolMaxResolution:"wolMaxResolutionChange",wolMinZoom:"wolMinZoomChange",wolMaxZoom:"wolMaxZoomChange",wolPreload:"wolPreloadChange",wolSource:"wolSourceChange",wolUseInterimTilesOnError:"wolUseInterimTilesOnErrorChange",wolChange:"wolChange",wolError:"wolError",wolPostRender:"wolPostRender",wolPreRender:"wolPreRender",wolPropertyChange:"wolPropertyChange",wolSourceReady:"wolSourceReady"},features:[x],ngContentSelectors:Y,decls:1,vars:0,template:function(t,e){t&1&&(M(),v(0))},encapsulation:2,changeDetection:0})};function z(a,n){let t=`
    attribute vec2 ${O.TEXTURE_COORD};
    uniform mat4 ${i.TILE_TRANSFORM};
    uniform float ${i.TEXTURE_PIXEL_WIDTH};
    uniform float ${i.TEXTURE_PIXEL_HEIGHT};
    uniform float ${i.TEXTURE_RESOLUTION};
    uniform float ${i.TEXTURE_ORIGIN_X};
    uniform float ${i.TEXTURE_ORIGIN_Y};
    uniform float ${i.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${O.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${i.TEXTURE_ORIGIN_X} + ${i.TEXTURE_RESOLUTION} * ${i.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${i.TEXTURE_ORIGIN_Y} - ${i.TEXTURE_RESOLUTION} * ${i.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${i.TILE_TRANSFORM} * vec4(${O.TEXTURE_COORD}, ${i.DEPTH}, 1.0);
    }
  `,e=D(Z({},j()),{bandCount:n}),o=[];if(a.color!==void 0){let l=w(e,a.color,V);o.push(`color = ${l};`)}if(a.contrast!==void 0){let l=w(e,a.contrast,p);o.push(`color.rgb = clamp((${l} + 1.0) * color.rgb - (${l} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(a.exposure!==void 0){let l=w(e,a.exposure,p);o.push(`color.rgb = clamp((${l} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(a.saturation!==void 0){let l=w(e,a.saturation,p);o.push(`
      float saturation = ${l} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(a.gamma!==void 0){let l=w(e,a.gamma,p);o.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${l}));`)}if(a.brightness!==void 0){let l=w(e,a.brightness,p);o.push(`color.rgb = clamp(color.rgb + ${l}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}let r={},h=Object.keys(e.variables).length;if(h>1&&!a.variables)throw new Error(`Missing variables in style (expected ${e.variables})`);for(let l=0;l<h;++l){let E=e.variables[Object.keys(e.variables)[l]];if(!(E.name in a.variables))throw new Error(`Missing '${E.name}' in style variables`);let A=W(E.name);r[A]=function(){let y=a.variables[E.name];return typeof y=="string"&&(y=X(y)),y!==void 0?y:-9999999}}let d=Object.keys(r).map(function(l){return`uniform float ${l};`}),f=Math.ceil(n/4);d.push(`uniform sampler2D ${i.TILE_TEXTURE_ARRAY}[${f}];`),e.paletteTextures&&d.push(`uniform sampler2D ${G}[${e.paletteTextures.length}];`);let g=Object.keys(e.functions).map(function(l){return e.functions[l]}),b=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${i.RENDER_EXTENT};
    uniform float ${i.TRANSITION_ALPHA};
    uniform float ${i.TEXTURE_PIXEL_WIDTH};
    uniform float ${i.TEXTURE_PIXEL_HEIGHT};
    uniform float ${i.RESOLUTION};
    uniform float ${i.ZOOM};

    ${d.join(`
`)}

    ${g.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${i.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${i.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${i.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${i.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${i.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${o.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${i.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:b,uniforms:r,paletteTextures:e.paletteTextures}}var N=class extends U{constructor(n){n=n?Object.assign({},n):{};let t=n.style||{};delete n.style,super(n),this.sources_=n.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(L.SOURCE,this.handleSourceUpdate_)}getSources(n,t){let e=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(n,t):this.sources_:e?[e]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){let n=this.getRenderSource();return n?n.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();let n=this.getSource();if(n)if(n.getState()==="loading"){let t=()=>{n.getState()==="ready"&&(n.removeEventListener("change",t),this.setStyle(this.style_))};n.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){let n=Number.MAX_SAFE_INTEGER,t=this.getSources([-n,-n,n,n],n);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){let n=z(this.style_,this.getSourceBandCount_());return new k(this,{vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms,cacheSize:this.getCacheSize(),paletteTextures:n.paletteTextures})}renderSources(n,t){let e=this.getRenderer(),o;for(let r=0,h=t.length;r<h;++r)this.renderedSource_=t[r],e.prepareFrame(n)&&(o=e.renderFrame(n));return o}render(n,t){this.rendered=!0;let e=n.viewState,o=this.getSources(n.extent,e.resolution),r=!0;for(let d=0,f=o.length;d<f;++d){let g=o[d],b=g.getState();if(b=="loading"){let l=()=>{g.getState()=="ready"&&(g.removeEventListener("change",l),this.changed())};g.addEventListener("change",l)}r=r&&b=="ready"}let h=this.renderSources(n,o);if(this.getRenderer().renderComplete&&r)return this.renderedResolution_=e.resolution,h;if(this.renderedResolution_>.5*e.resolution){let d=this.getSources(n.extent,this.renderedResolution_).filter(f=>!o.includes(f));if(d.length>0)return this.renderSources(n,d)}return h}setStyle(n){if(this.styleVariables_=n.variables||{},this.style_=n,this.hasRenderer()){let t=z(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}}updateStyleVariables(n){Object.assign(this.styleVariables_,n),this.changed()}};N.prototype.dispose;var H=N;var q=["*"],P=class a{wolStyle=u();wolVariables=u();wolClassName=u();wolOpacity=s();wolVisible=s();wolExtent=s();wolZIndex=s();wolMinResolution=s();wolMaxResolution=s();wolMinZoom=s();wolMaxZoom=s();wolPreload=s();wolSource=s();wolSources=u();wolMap=u();wolUseInterimTilesOnError=s();wolCacheSize=u();wolProperties=u();wolChange=c();wolError=c();wolPostRender=c();wolPreRender=c();wolPropertyChange=c();wolSourceReady=c();instance;constructor(){let n=m(R),t=I("WebGLTileLayer"),e={};T(()=>{let o=new H({style:this.wolStyle(),className:this.wolClassName(),opacity:this.wolOpacity(),visible:this.wolVisible(),extent:this.wolExtent(),zIndex:this.wolZIndex(),minResolution:this.wolMinResolution(),maxResolution:this.wolMaxResolution(),minZoom:this.wolMinZoom(),maxZoom:this.wolMaxZoom(),preload:this.wolPreload(),source:this.wolSource(),sources:this.wolSources(),map:this.wolMap(),useInterimTilesOnError:this.wolUseInterimTilesOnError(),cacheSize:this.wolCacheSize(),properties:this.wolProperties()});this.wolVariables()&&o.updateStyleVariables(this.wolVariables()??{}),e.change=o.on("change",r=>this.wolChange.emit(r)),e["change:extent"]=o.on("change:extent",()=>this.wolExtent.set(o.getExtent())),e["change:maxResolution"]=o.on("change:maxResolution",()=>this.wolMaxResolution.set(o.getMaxResolution())),e["change:maxZoom"]=o.on("change:maxZoom",()=>this.wolMaxZoom.set(o.getMaxZoom())),e["change:minResolution"]=o.on("change:minResolution",()=>this.wolMinResolution.set(o.getMinResolution())),e["change:minZoom"]=o.on("change:minZoom",()=>this.wolMinZoom.set(o.getMinZoom())),e["change:opacity"]=o.on("change:opacity",()=>this.wolOpacity.set(o.getOpacity())),e["change:preload"]=o.on("change:preload",()=>this.wolPreload.set(o.getPreload())),e["change:source"]=o.on("change:source",()=>this.wolSource.set(o.getSource()??void 0)),e["change:useInterimTilesOnError"]=o.on("change:useInterimTilesOnError",()=>this.wolUseInterimTilesOnError.set(o.getUseInterimTilesOnError())),e["change:visible"]=o.on("change:visible",()=>this.wolVisible.set(o.getVisible())),e["change:zIndex"]=o.on("change:zIndex",()=>this.wolZIndex.set(o.getZIndex())),e.error=o.on("error",r=>this.wolError.emit(r)),e.postrender=o.on("postrender",r=>this.wolPostRender.emit(r)),e.prerender=o.on("prerender",r=>this.wolPreRender.emit(r)),e.propertychange=o.on("propertychange",r=>this.wolPropertyChange.emit(r)),e.sourceready=o.on("sourceready",r=>this.wolSourceReady.emit(r)),Promise.resolve().then(()=>{t.addLayer(o)}),this.instance=o}),n.onDestroy(()=>{this.instance&&(C(Object.values(e)),t.removeLayer(this.instance),this.instance=void 0)})}ngOnChanges(n){if(this.instance)for(let[t,e]of Object.entries(n))switch(t){case"wolExtent":this.instance.setExtent(e.currentValue);break;case"wolMap":this.instance.setMap(e.currentValue);break;case"wolMaxResolution":this.instance.setMaxResolution(e.currentValue);break;case"wolMaxZoom":this.instance.setMaxZoom(e.currentValue);break;case"wolMinResolution":this.instance.setMinResolution(e.currentValue);break;case"wolMinZoom":this.instance.setMinZoom(e.currentValue);break;case"wolOpacity":this.instance.setOpacity(e.currentValue);break;case"wolPreload":this.instance.setPreload(e.currentValue);break;case"wolProperties":this.instance.setProperties(e.currentValue);break;case"wolSource":this.instance.setSource(e.currentValue);break;case"wolUseInterimTilesOnError":this.instance.setUseInterimTilesOnError(e.currentValue);break;case"wolVisible":this.instance.setVisible(e.currentValue);break;case"wolZIndex":this.instance.setZIndex(e.currentValue);break;case"wolVariables":this.instance.updateStyleVariables(e.currentValue??{});break}}getInstance(){return this.instance}static \u0275fac=function(t){return new(t||a)};static \u0275cmp=S({type:a,selectors:[["wol-webgl-tile-layer"]],inputs:{wolStyle:[1,"wolStyle"],wolVariables:[1,"wolVariables"],wolClassName:[1,"wolClassName"],wolOpacity:[1,"wolOpacity"],wolVisible:[1,"wolVisible"],wolExtent:[1,"wolExtent"],wolZIndex:[1,"wolZIndex"],wolMinResolution:[1,"wolMinResolution"],wolMaxResolution:[1,"wolMaxResolution"],wolMinZoom:[1,"wolMinZoom"],wolMaxZoom:[1,"wolMaxZoom"],wolPreload:[1,"wolPreload"],wolSource:[1,"wolSource"],wolSources:[1,"wolSources"],wolMap:[1,"wolMap"],wolUseInterimTilesOnError:[1,"wolUseInterimTilesOnError"],wolCacheSize:[1,"wolCacheSize"],wolProperties:[1,"wolProperties"]},outputs:{wolOpacity:"wolOpacityChange",wolVisible:"wolVisibleChange",wolExtent:"wolExtentChange",wolZIndex:"wolZIndexChange",wolMinResolution:"wolMinResolutionChange",wolMaxResolution:"wolMaxResolutionChange",wolMinZoom:"wolMinZoomChange",wolMaxZoom:"wolMaxZoomChange",wolPreload:"wolPreloadChange",wolSource:"wolSourceChange",wolUseInterimTilesOnError:"wolUseInterimTilesOnErrorChange",wolChange:"wolChange",wolError:"wolError",wolPostRender:"wolPostRender",wolPreRender:"wolPreRender",wolPropertyChange:"wolPropertyChange",wolSourceReady:"wolSourceReady"},features:[x],ngContentSelectors:q,decls:1,vars:0,template:function(t,e){t&1&&(M(),v(0))},encapsulation:2,changeDetection:0})};function Ze(a){let n={host:!0,optional:!0},t=m(B,n),e=m(P,n),o=m(_,n);if(t)return{setSource:r=>(t.addSource(r),()=>{t.removeSource(r)}),getInstance:()=>t.getInstance()};if(e)return{setSource:r=>(e.getInstance()?.setSource(r),()=>{e.getInstance()?.setSource(null)}),getInstance:()=>e.getInstance()};if(o)return{setSource:r=>(o.getInstance()?.setSource(r),()=>{o.getInstance()?.setSource(null)}),getInstance:()=>o.getInstance()};throw new Error(`No TileSource host found. Please wrap the ${a} component in a RasterSource, WebGLTileLayer or TileLayer component.`)}export{_ as a,P as b,Ze as c};
