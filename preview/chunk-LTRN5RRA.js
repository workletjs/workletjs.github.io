import{Qa as V,Wa as I,tc as O,v as k}from"./chunk-MT2Y2FGN.js";import{d as j,n as S}from"./chunk-L76X3E7P.js";import{Aa as P,Ba as U,P as E,S as N,Sb as v,Tb as a,Wb as R,_ as W,fa as D,kb as B,lb as L,ra as T}from"./chunk-DTKK3HU7.js";var y="units",A=[1,2,5],w=25.4/.28,C=class extends I{constructor(e){e=e||{};let t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;let n=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=n+"-inner",this.element.className=n+" "+V,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(y,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(y)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(y,e)}setDpi(e){this.dpi_=e}updateElement_(){let e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}let t=e.center,n=e.projection,o=this.getUnits(),l=o=="degrees"?"degrees":"m",s=S(n,e.resolution,t,l),h=this.minWidth_*(this.dpi_||w)/w,c=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||w)/w:void 0,r=h*s,i="";if(o=="degrees"){let g=j.degrees;r*=g,r<g/60?(i="\u2033",s*=3600):r<g?(i="\u2032",s*=60):i="\xB0"}else if(o=="imperial")r<.9144?(i="in",s/=.0254):r<1609.344?(i="ft",s/=.3048):(i="mi",s/=1609.344);else if(o=="nautical")s/=1852,i="NM";else if(o=="metric")r<1e-6?(i="nm",s*=1e9):r<.001?(i="\u03BCm",s*=1e6):r<1?(i="mm",s*=1e3):r<1e3?i="m":(i="km",s/=1e3);else if(o=="us")r<.9144?(i="in",s*=39.37):r<1609.344?(i="ft",s/=.30480061):(i="mi",s/=1609.3472);else throw new Error("Invalid units");let f=3*Math.floor(Math.log(h*s)/Math.log(10)),u,d,p,M=0,b,x;for(;;){p=Math.floor(f/3);let g=Math.pow(10,p);if(u=A[(f%3+3)%3]*g,d=Math.round(u/s),isNaN(d)){this.element.style.display="none",this.renderedVisible_=!1;return}if(c!==void 0&&d>=c){u=M,d=b,p=x;break}else if(d>=h)break;M=u,b=d,x=p,++f}let _=this.scaleBar_?this.createScaleBar(d,u,i):u.toFixed(p<0?-p:0)+" "+i;this.renderedHTML_!=_&&(this.innerElement_.innerHTML=_,this.renderedHTML_=_),this.renderedWidth_!=d&&(this.innerElement_.style.width=d+"px",this.renderedWidth_=d),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,n){let o=this.getScaleForResolution(),l=o<1?Math.round(1/o).toLocaleString()+" : 1":"1 : "+Math.round(o).toLocaleString(),s=this.scaleBarSteps_,h=e/s,c=[this.createMarker("absolute")];for(let i=0;i<s;++i){let f=i%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";c.push(`<div><div class="ol-scale-singlebar ${f}" style="width: ${h}px;"></div>`+this.createMarker("relative")+(i%2===0||s===2?this.createStepText(i,e,!1,t,n):"")+"</div>")}return c.push(this.createStepText(s,e,!0,t,n)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+l+"</div>":"")+c.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,n,o,l){let h=(e===0?0:Math.round(o/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+l),c=e===0?-3:t/this.scaleBarSteps_*-1,r=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${c}px;text-align: ${e===0?"left":"center"};min-width: ${r}px;left: ${n?t+"px":"unset"};">`+h+"</div>"}getScaleForResolution(){let e=S(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||w,n=1e3/25.4;return e*n*t}render(e){let t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}},$=C;var G=["*"],F=class m{wolClassName=a();wolMinWidth=a();wolMaxWidth=a();wolRender=a();wolTarget=a();wolUnits=R();wolBar=a();wolSteps=a();wolText=a();wolDpi=a();wolProperties=a();wolChange=v();wolError=v();wolPropertyChange=v();instance;constructor(){let e=N(W),t=O("ScaleLine"),n={};T(()=>{let o=new $({className:this.wolClassName(),minWidth:this.wolMinWidth(),maxWidth:this.wolMaxWidth(),render:this.wolRender(),target:this.wolTarget(),units:this.wolUnits(),bar:this.wolBar(),steps:this.wolSteps(),text:this.wolText(),dpi:this.wolDpi()});this.wolProperties()&&o.setProperties(this.wolProperties()??{},!0),n.change=o.on("change",l=>this.wolChange.emit(l)),n["change:units"]=o.on("change:units",()=>this.wolUnits.set(o.getUnits())),n.error=o.on("error",l=>this.wolError.emit(l)),n.propertychange=o.on("propertychange",l=>this.wolPropertyChange.emit(l)),Promise.resolve().then(()=>{t.addControl(o)}),this.instance=o}),e.onDestroy(()=>{this.instance&&(k(Object.values(n)),t.removeControl(this.instance),this.instance=void 0)})}ngOnChanges(e){if(this.instance)for(let[t,n]of Object.entries(e))switch(t){case"wolDpi":this.instance.setDpi(n.currentValue);break;case"wolProperties":this.instance.setProperties(n.currentValue??{},!1);break;case"wolTarget":this.instance.setTarget(n.currentValue);break;case"wolUnits":this.instance.setUnits(n.currentValue);break}}getInstance(){return this.instance}static \u0275fac=function(t){return new(t||m)};static \u0275cmp=P({type:m,selectors:[["wol-scale-line-control"]],inputs:{wolClassName:[1,"wolClassName"],wolMinWidth:[1,"wolMinWidth"],wolMaxWidth:[1,"wolMaxWidth"],wolRender:[1,"wolRender"],wolTarget:[1,"wolTarget"],wolUnits:[1,"wolUnits"],wolBar:[1,"wolBar"],wolSteps:[1,"wolSteps"],wolText:[1,"wolText"],wolDpi:[1,"wolDpi"],wolProperties:[1,"wolProperties"]},outputs:{wolUnits:"wolUnitsChange",wolChange:"wolChange",wolError:"wolError",wolPropertyChange:"wolPropertyChange"},features:[D],ngContentSelectors:G,decls:1,vars:0,template:function(t,n){t&1&&(B(),L(0))},encapsulation:2,changeDetection:0})};var H=class m{static \u0275fac=function(t){return new(t||m)};static \u0275mod=U({type:m});static \u0275inj=E({})};export{F as a,H as b};
