import{a as Ft,b as _t}from"./chunk-KBLC5AHP.js";import{a as Mt,b as bt,d as Ct,e as Vt,f as Pt}from"./chunk-3NA6AZ5F.js";import{c as Tt,d as Rt,e as Et,f as St,h as Fe,i as vt,k as _e,m as Dt,n as ge,o as It,p as Lt,q as kt}from"./chunk-FWXMKCRU.js";import{d as Ot,f as Me}from"./chunk-2SJZEXU3.js";import{d as ht}from"./chunk-CYCQQ522.js";import{a as rt,b as $,c as st,d as at,f as ct,h as dt,i as ut}from"./chunk-GIQSQ2QL.js";import{a as ft,b as J,g as gt,h as mt,i as he,k as fe,m as pt,n as wt,p as xt,q as yt}from"./chunk-DWZJEK5H.js";import{A as le,E as $e,F as Je,Oc as lt,V as Qe,Vc as ue,W as A,X as Re,Y as ae,Z as Ee,_ as et,_a as ot,a as W,aa as q,ba as ce,d as qe,da as Se,ha as de,mb as it,nb as nt,ta as tt,v as se,w as R,z as L,za as U}from"./chunk-IV3CZHWS.js";import{e as He,h as Ke,m as Xe,u as O,w as Ye,y as z}from"./chunk-L76X3E7P.js";import{C as j,D as ze,G,b as Ae,c as Z,g as Ue,o as je,pa as We}from"./chunk-WEL5MCWD.js";import{Aa as oe,S as B,Sb as v,Tb as b,Wb as M,_ as ee,ca as Ze,fa as te,kb as ie,lb as ne,ra as re}from"./chunk-DTKK3HU7.js";import{a as Ge,b as Be}from"./chunk-TWZW5B45.js";var Nt=23283064365386963e-26,qt=12,Gt=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),be=0,me=1,Q=2,pe=5,we=class{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,r=this.length){for(;this.pos<r;){let o=this.readVarint(),i=o>>3,s=this.pos;this.type=o&7,e(i,t,this),this.pos===s&&this.skip(o)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){let e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){let e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readSFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readFloat(){let e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){let e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){let t=this.buf,r,o;return o=t[this.pos++],r=o&127,o<128||(o=t[this.pos++],r|=(o&127)<<7,o<128)||(o=t[this.pos++],r|=(o&127)<<14,o<128)||(o=t[this.pos++],r|=(o&127)<<21,o<128)?r:(o=t[this.pos],r|=(o&15)<<28,$t(r,e,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){let e=this.readVarint();return e%2===1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){let e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=qt&&Gt?Gt.decode(this.buf.subarray(t,e)):dr(this.buf,t,e)}readBytes(){let e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){let r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===Q?this.readVarint()+this.pos:this.pos+1}skip(e){let t=e&7;if(t===be)for(;this.buf[this.pos++]>127;);else if(t===Q)this.pos=this.readVarint()+this.pos;else if(t===pe)this.pos+=4;else if(t===me)this.pos+=8;else throw new Error(`Unimplemented type: ${t}`)}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){let r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Nt),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Nt),!0),this.pos+=8}writeVarint(e){if(e=+e||0,e>268435455||e<0){Jt(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))}writeSVarint(e){this.writeVarint(e<0?-e*2-1:e*2)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(e.length*4),this.pos++;let t=this.pos;this.pos=ur(this.buf,e,this.pos);let r=this.pos-t;r>=128&&Bt(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){let t=e.length;this.writeVarint(t),this.realloc(t);for(let r=0;r<t;r++)this.buf[this.pos++]=e[r]}writeRawMessage(e,t){this.pos++;let r=this.pos;e(t,this);let o=this.pos-r;o>=128&&Bt(r,o,this),this.pos=r-1,this.writeVarint(o),this.pos+=o}writeMessage(e,t,r){this.writeTag(e,Q),this.writeRawMessage(t,r)}writePackedVarint(e,t){t.length&&this.writeMessage(e,tr,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,rr,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,nr,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,or,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,ir,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,sr,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,lr,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,ar,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,cr,t)}writeBytesField(e,t){this.writeTag(e,Q),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,pe),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,pe),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,me),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,me),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,be),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,be),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,Q),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,pe),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,me),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function $t(n,e,t){let r=t.buf,o,i;if(i=r[t.pos++],o=(i&112)>>4,i<128||(i=r[t.pos++],o|=(i&127)<<3,i<128)||(i=r[t.pos++],o|=(i&127)<<10,i<128)||(i=r[t.pos++],o|=(i&127)<<17,i<128)||(i=r[t.pos++],o|=(i&127)<<24,i<128)||(i=r[t.pos++],o|=(i&1)<<31,i<128))return H(n,o,e);throw new Error("Expected varint not more than 10 bytes")}function H(n,e,t){return t?e*4294967296+(n>>>0):(e>>>0)*4294967296+(n>>>0)}function Jt(n,e){let t,r;if(n>=0?(t=n%4294967296|0,r=n/4294967296|0):(t=~(-n%4294967296),r=~(-n/4294967296),t^4294967295?t=t+1|0:(t=0,r=r+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Qt(t,r,e),er(r,e)}function Qt(n,e,t){t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos++]=n&127|128,n>>>=7,t.buf[t.pos]=n&127}function er(n,e){let t=(n&7)<<4;e.buf[e.pos++]|=t|((n>>>=3)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127|((n>>>=7)?128:0),n&&(e.buf[e.pos++]=n&127)))))}function Bt(n,e,t){let r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(r);for(let o=t.pos-1;o>=n;o--)t.buf[o+r]=t.buf[o]}function tr(n,e){for(let t=0;t<n.length;t++)e.writeVarint(n[t])}function rr(n,e){for(let t=0;t<n.length;t++)e.writeSVarint(n[t])}function or(n,e){for(let t=0;t<n.length;t++)e.writeFloat(n[t])}function ir(n,e){for(let t=0;t<n.length;t++)e.writeDouble(n[t])}function nr(n,e){for(let t=0;t<n.length;t++)e.writeBoolean(n[t])}function sr(n,e){for(let t=0;t<n.length;t++)e.writeFixed32(n[t])}function lr(n,e){for(let t=0;t<n.length;t++)e.writeSFixed32(n[t])}function ar(n,e){for(let t=0;t<n.length;t++)e.writeFixed64(n[t])}function cr(n,e){for(let t=0;t<n.length;t++)e.writeSFixed64(n[t])}function dr(n,e,t){let r="",o=e;for(;o<t;){let i=n[o],s=null,d=i>239?4:i>223?3:i>191?2:1;if(o+d>t)break;let l,a,c;d===1?i<128&&(s=i):d===2?(l=n[o+1],(l&192)===128&&(s=(i&31)<<6|l&63,s<=127&&(s=null))):d===3?(l=n[o+1],a=n[o+2],(l&192)===128&&(a&192)===128&&(s=(i&15)<<12|(l&63)<<6|a&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):d===4&&(l=n[o+1],a=n[o+2],c=n[o+3],(l&192)===128&&(a&192)===128&&(c&192)===128&&(s=(i&15)<<18|(l&63)<<12|(a&63)<<6|c&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,d=1):s>65535&&(s-=65536,r+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),r+=String.fromCharCode(s),o+=d}return r}function ur(n,e,t){for(let r=0,o,i;r<e.length;r++){if(o=e.charCodeAt(r),o>55295&&o<57344)if(i)if(o<56320){n[t++]=239,n[t++]=191,n[t++]=189,i=o;continue}else o=i-55296<<10|o-56320|65536,i=null;else{o>56319||r+1===e.length?(n[t++]=239,n[t++]=191,n[t++]=189):i=o;continue}else i&&(n[t++]=239,n[t++]=191,n[t++]=189,i=null);o<128?n[t++]=o:(o<2048?n[t++]=o>>6|192:(o<65536?n[t++]=o>>12|224:(n[t++]=o>>18|240,n[t++]=o>>12&63|128),n[t++]=o>>6&63|128),n[t++]=o&63|128)}return t}var Ce=class extends Ft{constructor(e){super(),e=e||{},this.dataProjection=new He({code:"",units:"tile-pixels"}),this.featureClass=e.featureClass?e.featureClass:Fe,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,r,o){e.pos=t.geometry;let i=e.readVarint()+e.pos,s=1,d=0,l=0,a=0,c=0,u=0;for(;e.pos<i;){if(!d){let h=e.readVarint();s=h&7,d=h>>3}if(d--,s===1||s===2)l+=e.readSVarint(),a+=e.readSVarint(),s===1&&c>u&&(o.push(c),u=c),r.push(l,a),c+=2;else if(s===7)c>u&&(r.push(r[u],r[u+1]),c+=2);else throw new Error("Invalid command found in the PBF")}c>u&&(o.push(c),u=c)}createFeature_(e,t,r){let o=t.type;if(o===0)return null;let i,s=t.properties,d;this.idProperty_?(d=s[this.idProperty_],delete s[this.idProperty_]):d=t.id,s[this.layerName_]=t.layer.name;let l=[],a=[];this.readRawGeometry_(e,t,l,a);let c=pr(o,a.length);if(this.featureClass===Fe)i=new this.featureClass(c,l,a,2,s,d),i.transform(r.dataProjection);else{let u;if(c=="Polygon"){let f=it(l,a);u=f.length>1?new St(l,"XY",f):new nt(l,"XY",a)}else u=c==="Point"?new ot(l,"XY"):c==="LineString"?new Tt(l,"XY"):c==="MultiPoint"?new Et(l,"XY"):c==="MultiLineString"?new Rt(l,"XY",a):null;let h=this.featureClass;i=new h,this.geometryName_&&i.setGeometryName(this.geometryName_);let p=_t(u,!1,r);i.setGeometry(p),d!==void 0&&i.setId(d),i.setProperties(s,!0)}return i}getType(){return"arraybuffer"}readFeatures(e,t){let r=this.layers_;t=this.adaptOptions(t);let o=Xe(t.dataProjection);o.setWorldExtent(t.extent),t.dataProjection=o;let i=new we(e),s=i.readFields(hr,{}),d=[];for(let l in s){if(r&&!r.includes(l))continue;let a=s[l],c=a?[0,0,a.extent,a.extent]:null;o.setExtent(c);for(let u=0,h=a.length;u<h;++u){let p=mr(i,a,u),f=this.createFeature_(i,p,t);f!==null&&d.push(f)}}return d}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}};function hr(n,e,t){if(n===3){let r={keys:[],values:[],features:[]},o=t.readVarint()+t.pos;t.readFields(fr,r,o),r.length=r.features.length,r.length&&(e[r.name]=r)}}function fr(n,e,t){if(n===15)e.version=t.readVarint();else if(n===1)e.name=t.readString();else if(n===5)e.extent=t.readVarint();else if(n===2)e.features.push(t.pos);else if(n===3)e.keys.push(t.readString());else if(n===4){let r=null,o=t.readVarint()+t.pos;for(;t.pos<o;)n=t.readVarint()>>3,r=n===1?t.readString():n===2?t.readFloat():n===3?t.readDouble():n===4?t.readVarint64():n===5?t.readVarint():n===6?t.readSVarint():n===7?t.readBoolean():null;e.values.push(r)}}function gr(n,e,t){if(n==1)e.id=t.readVarint();else if(n==2){let r=t.readVarint()+t.pos;for(;t.pos<r;){let o=e.layer.keys[t.readVarint()],i=e.layer.values[t.readVarint()];e.properties[o]=i}}else n==3?e.type=t.readVarint():n==4&&(e.geometry=t.pos)}function mr(n,e,t){n.pos=e.features[t];let r=n.readVarint()+n.pos,o={layer:e,type:0,properties:{}};return n.readFields(gr,o,r),o}function pr(n,e){let t;return n===1?t=e===1?"Point":"MultiPoint":n===2?t=e===1?"LineString":"MultiLineString":n===3&&(t="Polygon"),t}var Nr=Ce;var Ve=class extends wt{constructor(e,t){super(e),this.batch_=new bt,this.styleRenderer_=t,this.buffers=null,this.maskVertices=new fe(gt,he),this.setTile(e.tile)}generateMaskBuffer_(){let e=this.tile.getSourceTiles()[0].extent;this.maskVertices.fromArray([e[0],e[1],e[2],e[1],e[2],e[3],e[0],e[3]]),this.helper.flushBufferData(this.maskVertices)}uploadTile(){this.generateMaskBuffer_(),this.batch_.clear();let e=this.tile.getSourceTiles(),t=e.reduce((s,d)=>s.concat(d.getFeatures()),[]);this.batch_.addFeatures(t);let r=e[0].extent[0],o=e[0].extent[1],i=ce(A(),-r,-o);this.styleRenderer_.generateBuffers(this.batch_,i).then(s=>{this.buffers=s,this.setReady()})}disposeInternal(){if(this.buffers){let e=t=>{for(let r of t)r&&this.helper.deleteBuffer(r)};this.buffers.pointBuffers&&e(this.buffers.pointBuffers),this.buffers.lineStringBuffers&&e(this.buffers.lineStringBuffers),this.buffers.polygonBuffers&&e(this.buffers.polygonBuffers)}super.disposeInternal()}},Zt=Ve;var C=Be(Ge({},xt),{TILE_MASK_TEXTURE:"u_depthMask",TILE_ZOOM_LEVEL:"u_tileZoomLevel"}),wr={POSITION:"a_position"},Pe=class extends yt{constructor(e,t){super(e,{cacheSize:t.cacheSize,uniforms:{[C.PATTERN_ORIGIN]:[0,0],[C.TILE_MASK_TEXTURE]:()=>this.tileMaskTarget_.getTexture()}}),this.hitDetectionEnabled_=!t.disableHitDetection,this.style_=null,this.styleVariables_=t.variables||{},this.styleRenderer_=null,this.currentFrameStateTransform_=A(),this.tmpTransform_=A(),this.tmpMat4_=ft(),this.tileMaskTarget_=null,this.tileMaskIndices_=new fe(mt,he),this.tileMaskIndices_.fromArray([0,1,3,1,2,3]),this.tileMaskAttributes_=[{name:wr.POSITION,size:2,type:pt.FLOAT}],this.tileMaskProgram_,this.applyOptions_(t)}reset(e){super.reset(e),this.applyOptions_(e),this.helper&&(this.createRenderers_(),this.initTileMask_())}applyOptions_(e){this.style_=e.style}createRenderers_(){function e(r){let o=r.getFragmentDiscardExpression(),i=`texture2D(${C.TILE_MASK_TEXTURE}, gl_FragCoord.xy / u_pixelRatio / u_viewportSizePx).r * 50. > ${C.TILE_ZOOM_LEVEL} + 0.5`;r.setFragmentDiscardExpression(o!=="false"?`(${o}) || (${i})`:i),r.addUniform(C.TILE_MASK_TEXTURE,"sampler2D"),r.addUniform(C.TILE_ZOOM_LEVEL,"float")}let t=Vt(this.style_,this.styleVariables_);for(let r of t)e(r.builder);this.styleRenderer_=new Ct(t,this.styleVariables_,this.helper,this.hitDetectionEnabled_)}initTileMask_(){this.tileMaskTarget_=new Pt(this.helper);let e=new Mt().setFillColorExpression(`vec4(${C.TILE_ZOOM_LEVEL} / 50., 0., 0., 1.)`).addUniform(C.TILE_ZOOM_LEVEL,"float");this.tileMaskProgram_=this.helper.getProgram(e.getFillFragmentShader(),e.getFillVertexShader()),this.helper.flushBufferData(this.tileMaskIndices_)}afterHelperCreated(){this.createRenderers_(),this.initTileMask_()}createTileRepresentation(e){let t=new Zt(e,this.styleRenderer_),r=()=>{t.ready&&(this.getLayer().changed(),t.removeEventListener(W.CHANGE,r))};return t.addEventListener(W.CHANGE,r),t}beforeTilesRender(e,t){super.beforeTilesRender(e,!0),this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_)}beforeTilesMaskRender(e){this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_);let t=e.pixelRatio,r=e.size;return this.tileMaskTarget_.setSize([r[0]*t,r[1]*t]),this.helper.prepareDrawToRenderTarget(e,this.tileMaskTarget_,!0,!0),this.helper.useProgram(this.tileMaskProgram_,e),Ee(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(C.PROJECTION_MATRIX,J(this.tmpMat4_,this.tmpTransform_)),Se(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(C.SCREEN_TO_WORLD_MATRIX,J(this.tmpMat4_,this.tmpTransform_)),!0}renderTileMask(e,t,r,o){if(!e.ready)return;this.helper.setUniformFloatValue(C.DEPTH,o),this.helper.setUniformFloatValue(C.TILE_ZOOM_LEVEL,t),this.helper.setUniformFloatVec4(C.RENDER_EXTENT,r),this.helper.setUniformFloatValue(C.GLOBAL_ALPHA,1),this.helper.bindBuffer(e.maskVertices),this.helper.bindBuffer(this.tileMaskIndices_),this.helper.enableAttributes(this.tileMaskAttributes_);let i=this.tileMaskIndices_.getSize();this.helper.drawElements(0,i)}applyUniforms_(e,t,r,o,i){Ee(this.tmpTransform_,this.currentFrameStateTransform_),ae(this.tmpTransform_,r),this.helper.setUniformMatrixValue(C.PROJECTION_MATRIX,J(this.tmpMat4_,this.tmpTransform_)),Se(this.tmpTransform_,this.currentFrameStateTransform_),this.helper.setUniformMatrixValue(C.SCREEN_TO_WORLD_MATRIX,J(this.tmpMat4_,this.tmpTransform_)),this.helper.setUniformFloatValue(C.GLOBAL_ALPHA,e),this.helper.setUniformFloatValue(C.DEPTH,i),this.helper.setUniformFloatValue(C.TILE_ZOOM_LEVEL,o),this.helper.setUniformFloatVec4(C.RENDER_EXTENT,t)}renderTile(e,t,r,o,i,s,d,l,a,c,u){let h=j(l,o,l),p=e.tile.getTileCoord()[0],f=e.buffers;f&&this.styleRenderer_.render(f,r,()=>{this.applyUniforms_(u,h,f.invertVerticesTransform,p,a)})}renderDeclutter(e){}disposeInternal(){super.disposeInternal()}},At=Pe;var ve=class extends st{constructor(e){let t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.style_=e.style,this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){return new At(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_,cacheSize:this.getCacheSize()})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}setStyle(e){this.style_=e,this.clearRenderer(),this.changed()}},Ut=ve;var Tr=["*"],xe=class n{wolClassName=b();wolOpacity=M();wolVisible=M();wolExtent=M();wolZIndex=M();wolMinResolution=M();wolMaxResolution=M();wolMinZoom=M();wolMaxZoom=M();wolSource=M();wolStyle=b.required();wolVariables=b();wolBackground=b();wolDisableHitDetection=b();wolProperties=b();wolChange=v();wolError=v();wolPostRender=v();wolPreRender=v();wolPropertyChange=v();wolSourceReady=v();instance=Ze(null);constructor(){let e=B(ee),t=ue("WebGLVectorTileLayer"),r={};re(()=>{let o=new Ut({className:this.wolClassName(),opacity:this.wolOpacity(),visible:this.wolVisible(),extent:this.wolExtent(),zIndex:this.wolZIndex(),minResolution:this.wolMinResolution(),maxResolution:this.wolMaxResolution(),minZoom:this.wolMinZoom(),maxZoom:this.wolMaxZoom(),source:this.wolSource(),style:this.wolStyle(),variables:this.wolVariables(),background:this.wolBackground(),disableHitDetection:this.wolDisableHitDetection(),properties:this.wolProperties()});r.change=o.on("change",i=>this.wolChange.emit(i)),r["change:extent"]=o.on("change:extent",()=>this.wolExtent.set(o.getExtent())),r["change:maxResolution"]=o.on("change:maxResolution",()=>this.wolMaxResolution.set(o.getMaxResolution())),r["change:minResolution"]=o.on("change:minResolution",()=>this.wolMinResolution.set(o.getMinResolution())),r["change:maxZoom"]=o.on("change:maxZoom",()=>this.wolMaxZoom.set(o.getMaxZoom())),r["change:minZoom"]=o.on("change:minZoom",()=>this.wolMinZoom.set(o.getMinZoom())),r["change:opacity"]=o.on("change:opacity",()=>this.wolOpacity.set(o.getOpacity())),r["change:source"]=o.on("change:source",()=>this.wolSource.set(o.getSource()??void 0)),r["change:visible"]=o.on("change:visible",()=>this.wolVisible.set(o.getVisible())),r["change:zIndex"]=o.on("change:zIndex",()=>this.wolZIndex.set(o.getZIndex()??0)),r.error=o.on("error",i=>this.wolError.emit(i)),r.postrender=o.on("postrender",i=>this.wolPostRender.emit(i)),r.prerender=o.on("prerender",i=>this.wolPreRender.emit(i)),r.propertychange=o.on("propertychange",i=>this.wolPropertyChange.emit(i)),r.sourceready=o.on("sourceready",i=>this.wolSourceReady.emit(i)),Promise.resolve().then(()=>{t.addLayer(o)}),this.instance.set(o)}),e.onDestroy(()=>{let o=this.instance();se(Object.values(r)),o&&(t.removeLayer(o),o.dispose(),this.instance.set(null))})}ngOnChanges(e){let t=this.instance();if(t)for(let[r,o]of Object.entries(e))switch(r){case"wolExtent":t.setExtent(o.currentValue);break;case"wolMaxResolution":t.setMaxResolution(o.currentValue);break;case"wolMinResolution":t.setMinResolution(o.currentValue);break;case"wolMaxZoom":t.setMaxZoom(o.currentValue);break;case"wolMinZoom":t.setMinZoom(o.currentValue);break;case"wolOpacity":t.setOpacity(o.currentValue);break;case"wolProperties":t.setProperties(o.currentValue);break;case"wolSource":t.setSource(o.currentValue);break;case"wolStyle":t.setStyle(o.currentValue);break;case"wolVariables":t.updateStyleVariables(o.currentValue);break;case"wolVisible":t.setVisible(o.currentValue);break;case"wolZIndex":t.setZIndex(o.currentValue);break}}getInstance(){return this.instance()??void 0}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=oe({type:n,selectors:[["wol-webgl-vector-tile-layer"]],inputs:{wolClassName:[1,"wolClassName"],wolOpacity:[1,"wolOpacity"],wolVisible:[1,"wolVisible"],wolExtent:[1,"wolExtent"],wolZIndex:[1,"wolZIndex"],wolMinResolution:[1,"wolMinResolution"],wolMaxResolution:[1,"wolMaxResolution"],wolMinZoom:[1,"wolMinZoom"],wolMaxZoom:[1,"wolMaxZoom"],wolSource:[1,"wolSource"],wolStyle:[1,"wolStyle"],wolVariables:[1,"wolVariables"],wolBackground:[1,"wolBackground"],wolDisableHitDetection:[1,"wolDisableHitDetection"],wolProperties:[1,"wolProperties"]},outputs:{wolOpacity:"wolOpacityChange",wolVisible:"wolVisibleChange",wolExtent:"wolExtentChange",wolZIndex:"wolZIndexChange",wolMinResolution:"wolMinResolutionChange",wolMaxResolution:"wolMaxResolutionChange",wolMinZoom:"wolMinZoomChange",wolMaxZoom:"wolMaxZoomChange",wolSource:"wolSourceChange",wolChange:"wolChange",wolError:"wolError",wolPostRender:"wolPostRender",wolPreRender:"wolPreRender",wolPropertyChange:"wolPropertyChange",wolSourceReady:"wolSourceReady"},exportAs:["wolWebGLVectorTileLayer"],features:[te],ngContentSelectors:Tr,decls:1,vars:0,template:function(t,r){t&1&&(ie(),ne(0))},encapsulation:2,changeDetection:0})};var Rr={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},jt={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},De=class extends rt{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=A(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(e,t,r,o,i,s,d,l){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,r,o,i,s,d,l)}getTile(e,t,r,o){let i=this.getOrCreateTile(e,t,r,o);if(!i)return null;let s=o.viewState,d=s.resolution,l=o.viewHints,a=this.getLayer().getSource(),c=a.getTileGridForProjection(s.projection),u=!(l[U.ANIMATING]||l[U.INTERACTING]),h=c.getZForResolution(d,a.zDirection)===e;return u&&h?i.wantedResolution=d:i.wantedResolution||(i.wantedResolution=c.getResolution(e)),i}prepareFrame(e){let t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){let o=this.getLayer(),i=o.getRevision(),s=o.getRenderOrder()||null,d=e.wantedResolution,l=e.getReplayState(o);if(!l.dirty&&l.renderedResolution===d&&l.renderedRevision==i&&l.renderedRenderOrder==s)return;let a=o.getSource(),c=!!o.getDeclutter(),u=a.getTileGrid(),p=a.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),f=a.getSourceTiles(t,r,e),m=L(o);delete e.hitDetectionImageData[m],e.executorGroups[m]=[],l.dirty=!1;for(let g=0,T=f.length;g<T;++g){let x=f[g];if(x.getState()!=R.LOADED)continue;let w=a.getProjection(),E=x.tileCoord,y=u.getTileCoordExtent(E);r&&w&&!O(r,w)&&(y=z(y,w,r,32));let F=j(p,y),S=Z(F,o.getRenderBuffer()*d,this.tempExtent),I=je(y,F)?null:S,k=new vt(0,F,d,t),K=Ot(d,t),P=function(_,Te){let N,Ne=_.getStyleFunction()||o.getStyleFunction();if(Ne&&(N=Ne(_,d)),N){let Yt=this.renderFeature(_,K,N,k,c,Te);l.dirty=l.dirty||Yt}},V=x.getFeatures();s&&s!==l.renderedRenderOrder&&V.sort(s);for(let _=0,Te=V.length;_<Te;++_){let N=V[_];r&&x.projection&&!O(r,x.projection)&&(N=N.clone(),N.getGeometry().applyTransform(Ye(x.projection,r))),(!I||G(I,N.getGeometry().getExtent()))&&P.call(this,N,_)}let X=k.finish(),D=o.getRenderMode()!=="vector"&&c&&f.length===1?null:F,Y=new Dt(D,d,t,a.getOverlaps(),X,o.getRenderBuffer(),!0);e.executorGroups[m].push(Y)}l.renderedRevision=i,l.renderedRenderOrder=s,l.renderedResolution=d}forEachFeatureAtCoordinate(e,t,r,o,i){let s=t.viewState.resolution,d=t.viewState.rotation;r=r??0;let l=this.getLayer(),c=l.getSource().getTileGridForProjection(t.viewState.projection),u=Ae([e]);Z(u,s*r,u);let h={},p=function(w,E,y){let F=w.getId();F===void 0&&(F=L(w));let S=h[F];if(S){if(S!==!0&&y<S.distanceSq){if(y===0)return h[F]=!0,i.splice(i.lastIndexOf(S),1),o(w,l,E);S.geometry=E,S.distanceSq=y}}else{if(y===0)return h[F]=!0,o(w,l,E);i.push(h[F]={feature:w,layer:l,geometry:E,distanceSq:y,callback:o})}},f=this.renderedTiles,m=L(l),g=l.getDeclutter(),T=g?t.declutter?.[g]?.all().map(w=>w.value):null,x;e:for(let w=0,E=f.length;w<E;++w){let y=f[w],F=c.getTileCoordExtent(y.wrappedTileCoord);if(!G(F,u))continue;let S=y.executorGroups[m];for(let I=0,k=S.length;I<k;++I)if(x=S[I].forEachFeatureAtCoordinate(e,s,d,r,p,T),x)break e}return x}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((t,r)=>{let o=this.getLayer(),i=o.getSource(),s=this.renderedProjection,d=s.getExtent(),l=this.renderedResolution,a=i.getTileGridForProjection(s),c=et(this.renderedPixelToCoordinateTransform_,e.slice()),u=a.getTileCoordForCoordAndResolution(c,l).toString(),h=this.renderedTiles.find(w=>w.tileCoord.toString()===u&&w.getState()===R.LOADED);if(!h||h.loadingSourceTiles>0){t([]);return}i.getWrapX()&&s.canWrapX()&&!Ue(d,a.getTileCoordExtent(h.tileCoord))&&We(c,s);let p=L(o),f=a.getTileCoordExtent(h.wrappedTileCoord),m=ze(f),g=[(c[0]-m[0])/l,(m[1]-c[1])/l],T=h.getSourceTiles().reduce((w,E)=>w.concat(E.getFeatures()),[]),x=h.hitDetectionImageData[p];if(!x){let w=de(a.getTileSize(a.getZForResolution(l,i.zDirection))),E=this.renderedRotation_,y=[this.getRenderTransform(a.getTileCoordCenter(h.wrappedTileCoord),l,0,ge,w[0]*ge,w[1]*ge,0)];x=It(w,y,T,o.getStyleFunction(),a.getTileCoordExtent(h.wrappedTileCoord),h.getReplayState(o).renderedResolution,E),h.hitDetectionImageData[p]=x}t(Lt(g,T,x))})}getFeaturesInExtent(e){let t=[],r=this.getTileCache();if(r.getCount()===0)return t;let i=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),s=i.getZForResolution(this.renderedResolution),d={};return r.forEach(l=>{if(l.tileCoord[0]!==s||l.getState()!==R.LOADED)return;let a=l.getSourceTiles();for(let c=0,u=a.length;c<u;++c){let h=a[c],p=h.getKey();if(p in d)continue;d[p]=!0;let f=h.tileCoord;if(G(e,i.getTileCoordExtent(f))){let m=h.getFeatures();if(m)for(let g=0,T=m.length;g<T;++g){let x=m[g],w=x.getGeometry();G(e,w.getExtent())&&t.push(x)}}}}),t}handleFontsChanged(){let e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){let r=this.context,o=r.globalAlpha;r.globalAlpha=t.opacity;let i=e.viewHints,s=!(i[U.ANIMATING]||i[U.INTERACTING]),d=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),a=l?e.declutter?.[l]:void 0,c=L(this.getLayer()),u=this.renderedTiles;for(let h=0,p=u.length;h<p;++h){let f=u[h],m=f.executorGroups[c];if(m)for(let g=m.length-1;g>=0;--g)m[g].execute(this.context,d,this.getTileRenderTransform(f,e),e.viewState.rotation,s,_e,a)}r.globalAlpha=o}renderDeferredInternal(e){let t=this.renderedTiles,r=L(this.getLayer()),o=t.reduce((l,a,c)=>(a.executorGroups[r].forEach(u=>l.push({executorGroup:u,index:c})),l),[]),i=o.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),s={};for(let l=0,a=o.length;l<a;++l){let c=o[l].executorGroup.getDeferredZIndexContexts();for(let u in c)s[u]=!0}Object.keys(s).map(Number).sort(qe).forEach(l=>{i.forEach((a,c)=>{a[l]&&(a[l].forEach(u=>{let{executorGroup:h,index:p}=o[c],f=h.getRenderedContext(),m=f.globalAlpha;f.globalAlpha=this.renderedOpacity_;let g=this.tileClipContexts_[p];g&&g.draw(f),u.draw(f),g&&f.restore(),f.globalAlpha=m,u.clear()}),a[l].length=0)})})}getTileRenderTransform(e,t){let r=t.pixelRatio,o=t.viewState,i=o.center,s=o.resolution,d=o.rotation,l=t.size,a=Math.round(l[0]*r),c=Math.round(l[1]*r),h=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),p=e.tileCoord,f=h.getTileCoordExtent(e.wrappedTileCoord),m=h.getTileCoordExtent(p,this.tempExtent)[0]-f[0];return ae(q(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(i,s,d,r,a,c,m))}postRender(e,t){let r=t.viewHints,o=!(r[U.ANIMATING]||r[U.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;let i=this.getLayer(),s=i.getRenderMode(),d=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;let l=i.getDeclutter(),a=l?jt[s].filter(y=>!_e.includes(y)):jt[s],c=t.viewState,u=c.rotation,h=i.getSource(),f=h.getTileGridForProjection(c.projection).getZForResolution(c.resolution,h.zDirection),m=this.renderedTiles,g=[],T=[],x=[],w=L(i),E=!0;for(let y=m.length-1;y>=0;--y){let F=m[y];E=E&&!F.getReplayState(i).dirty;let S=F.executorGroups[w].filter(D=>D.hasExecutors(a));if(S.length===0)continue;let I=this.getTileRenderTransform(F,t),k=F.tileCoord[0],K=!1,P=S[0].getClipCoords(I),V=e,X;if(P){X=new tt,V=X.getContext();for(let D=0,Y=g.length;D<Y;++D)if(f!==k&&k<T[D]){let _=g[D];G([P[0],P[3],P[4],P[7]],[_[0],_[3],_[4],_[7]])&&(K||(V.save(),K=!0),V.beginPath(),V.moveTo(P[0],P[1]),V.lineTo(P[2],P[3]),V.lineTo(P[4],P[5]),V.lineTo(P[6],P[7]),V.moveTo(_[6],_[7]),V.lineTo(_[4],_[5]),V.lineTo(_[2],_[3]),V.lineTo(_[0],_[1]),V.clip())}g.push(P),T.push(k)}for(let D=0,Y=S.length;D<Y;++D)S[D].execute(e,[e.canvas.width,e.canvas.height],I,u,o,a,t.declutter?.[l]);K&&(V===e?V.restore():x[y]=X)}e.globalAlpha=d,this.ready=E,this.tileClipContexts_=x,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,r,o,i,s){if(!r)return!1;let d=!1;if(Array.isArray(r))for(let l=0,a=r.length;l<a;++l)d=Me(o,e,r[l],t,this.boundHandleStyleImageChange_,void 0,i,s)||d;else d=Me(o,e,r,t,this.boundHandleStyleImageChange_,void 0,i,s);return d}tileImageNeedsRender_(e){let t=this.getLayer();if(t.getRenderMode()==="vector")return!1;let r=e.getReplayState(t),o=t.getRevision(),i=e.wantedResolution;return r.renderedTileResolution!==i||r.renderedTileRevision!==o}renderTileImage_(e,t){let r=this.getLayer(),o=e.getReplayState(r),i=r.getRevision(),s=e.executorGroups[L(r)];o.renderedTileRevision=i;let d=e.wrappedTileCoord,l=d[0],a=r.getSource(),c=t.pixelRatio,h=t.viewState.projection,p=a.getTileGridForProjection(h),f=p.getResolution(e.tileCoord[0]),m=t.pixelRatio/e.wantedResolution*f,g=p.getResolution(l),T=e.getContext();c=Math.round(Math.max(c,m/c));let x=a.getTilePixelSize(l,c,h);T.canvas.width=x[0],T.canvas.height=x[1];let w=c/m;if(w!==1){let S=Re(this.tmpTransform_);q(S,w,w),T.setTransform.apply(T,S)}let E=p.getTileCoordExtent(d,this.tempExtent),y=m/g,F=Re(this.tmpTransform_);q(F,y,-y),ce(F,-E[0],-E[3]);for(let S=0,I=s.length;S<I;++S)s[S].execute(T,[T.canvas.width*w,T.canvas.height*w],F,0,!0,Rr[r.getRenderMode()],null);o.renderedTileResolution=e.wantedResolution}},zt=De;var Ie=class extends lt{constructor(e){e=e||{};let t=Object.assign({},e);delete t.preload;let r=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=r;let o=e.renderMode||"hybrid";Qe(o=="hybrid"||o=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=o,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new zt(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get($.PRELOAD)}getUseInterimTilesOnError(){return this.get($.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set($.PRELOAD,e)}setUseInterimTilesOnError(e){this.set($.USE_INTERIM_TILES_ON_ERROR,e)}},Wt=Ie;var Er=["*"],ye=class n{wolClassName=b();wolOpacity=M();wolVisible=M();wolExtent=M();wolZIndex=M();wolMinResolution=M();wolMaxResolution=M();wolMinZoom=M();wolMaxZoom=M();wolRenderOrder=b();wolRenderBuffer=b();wolRenderMode=b();wolSource=M();wolMap=b();wolDeclutter=b();wolStyle=b();wolBackground=b();wolUpdateWhileAnimating=b();wolUpdateWhileInteracting=b();wolPreload=M();wolUseInterimTilesOnError=M();wolProperties=b();wolCacheSize=b();wolChange=v();wolError=v();wolPostRender=v();wolPreRender=v();wolPropertyChange=v();wolSourceReady=v();instance;constructor(){let e=B(ee),t=ue("VectorTileLayer"),r={};re(()=>{let o=new Wt({className:this.wolClassName(),opacity:this.wolOpacity(),visible:this.wolVisible(),extent:this.wolExtent(),zIndex:this.wolZIndex(),minResolution:this.wolMinResolution(),maxResolution:this.wolMaxResolution(),minZoom:this.wolMinZoom(),maxZoom:this.wolMaxZoom(),renderOrder:this.wolRenderOrder(),renderBuffer:this.wolRenderBuffer(),renderMode:this.wolRenderMode(),source:this.wolSource(),map:this.wolMap(),declutter:this.wolDeclutter(),style:this.wolStyle(),background:this.wolBackground(),updateWhileAnimating:this.wolUpdateWhileAnimating(),updateWhileInteracting:this.wolUpdateWhileInteracting(),preload:this.wolPreload(),useInterimTilesOnError:this.wolUseInterimTilesOnError(),properties:this.wolProperties(),cacheSize:this.wolCacheSize()});r.change=o.on("change",i=>this.wolChange.emit(i)),r["change:extent"]=o.on("change:extent",()=>this.wolExtent.set(o.getExtent())),r["change:maxResolution"]=o.on("change:maxResolution",()=>this.wolMaxResolution.set(o.getMaxResolution())),r["change:maxZoom"]=o.on("change:maxZoom",()=>this.wolMaxZoom.set(o.getMaxZoom())),r["change:minResolution"]=o.on("change:minResolution",()=>this.wolMinResolution.set(o.getMinResolution())),r["change:minZoom"]=o.on("change:minZoom",()=>this.wolMinZoom.set(o.getMinZoom())),r["change:opacity"]=o.on("change:opacity",()=>this.wolOpacity.set(o.getOpacity())),r["change:preload"]=o.on("change:preload",()=>this.wolPreload.set(o.getPreload())),r["change:source"]=o.on("change:source",()=>this.wolSource.set(o.getSource()??void 0)),r["change:useInterimTilesOnError"]=o.on("change:useInterimTilesOnError",()=>this.wolUseInterimTilesOnError.set(o.getUseInterimTilesOnError())),r["change:visible"]=o.on("change:visible",()=>this.wolVisible.set(o.getVisible())),r["change:zIndex"]=o.on("change:zIndex",()=>this.wolZIndex.set(o.getZIndex())),r.error=o.on("error",i=>this.wolError.emit(i)),r.postrender=o.on("postrender",i=>this.wolPostRender.emit(i)),r.prerender=o.on("prerender",i=>this.wolPreRender.emit(i)),r.propertychange=o.on("propertychange",i=>this.wolPropertyChange.emit(i)),r.sourceready=o.on("sourceready",i=>this.wolSourceReady.emit(i)),Promise.resolve().then(()=>{t.addLayer(o)}),this.instance=o}),e.onDestroy(()=>{this.instance&&(se(Object.values(r)),t.removeLayer(this.instance),this.instance=void 0)})}ngOnChanges(e){if(this.instance)for(let[t,r]of Object.entries(e))switch(t){case"wolBackground":this.instance.setBackground(r.currentValue);break;case"wolDeclutter":this.instance.setDeclutter(r.currentValue);break;case"wolExtent":this.instance.setExtent(r.currentValue);break;case"wolMap":this.instance.setMap(r.currentValue??null);break;case"wolMaxResolution":this.instance.setMaxResolution(r.currentValue);break;case"wolMaxZoom":this.instance.setMaxZoom(r.currentValue);break;case"wolMinResolution":this.instance.setMinResolution(r.currentValue);break;case"wolMinZoom":this.instance.setMinZoom(r.currentValue);break;case"wolOpacity":this.instance.setOpacity(r.currentValue);break;case"wolPreload":this.instance.setPreload(r.currentValue);break;case"wolProperties":this.instance.setProperties(r.currentValue);break;case"wolSource":this.instance.setSource(r.currentValue??null);break;case"wolStyle":this.instance.setStyle(r.currentValue);break;case"wolUseInterimTilesOnError":this.instance.setUseInterimTilesOnError(r.currentValue);break;case"wolVisible":this.instance.setVisible(r.currentValue);break;case"wolZIndex":this.instance.setZIndex(r.currentValue);break}}getInstance(){return this.instance}static \u0275fac=function(t){return new(t||n)};static \u0275cmp=oe({type:n,selectors:[["wol-vector-tile-layer"]],inputs:{wolClassName:[1,"wolClassName"],wolOpacity:[1,"wolOpacity"],wolVisible:[1,"wolVisible"],wolExtent:[1,"wolExtent"],wolZIndex:[1,"wolZIndex"],wolMinResolution:[1,"wolMinResolution"],wolMaxResolution:[1,"wolMaxResolution"],wolMinZoom:[1,"wolMinZoom"],wolMaxZoom:[1,"wolMaxZoom"],wolRenderOrder:[1,"wolRenderOrder"],wolRenderBuffer:[1,"wolRenderBuffer"],wolRenderMode:[1,"wolRenderMode"],wolSource:[1,"wolSource"],wolMap:[1,"wolMap"],wolDeclutter:[1,"wolDeclutter"],wolStyle:[1,"wolStyle"],wolBackground:[1,"wolBackground"],wolUpdateWhileAnimating:[1,"wolUpdateWhileAnimating"],wolUpdateWhileInteracting:[1,"wolUpdateWhileInteracting"],wolPreload:[1,"wolPreload"],wolUseInterimTilesOnError:[1,"wolUseInterimTilesOnError"],wolProperties:[1,"wolProperties"],wolCacheSize:[1,"wolCacheSize"]},outputs:{wolOpacity:"wolOpacityChange",wolVisible:"wolVisibleChange",wolExtent:"wolExtentChange",wolZIndex:"wolZIndexChange",wolMinResolution:"wolMinResolutionChange",wolMaxResolution:"wolMaxResolutionChange",wolMinZoom:"wolMinZoomChange",wolMaxZoom:"wolMaxZoomChange",wolSource:"wolSourceChange",wolPreload:"wolPreloadChange",wolUseInterimTilesOnError:"wolUseInterimTilesOnErrorChange",wolChange:"wolChange",wolError:"wolError",wolPostRender:"wolPostRender",wolPreRender:"wolPreRender",wolPropertyChange:"wolPropertyChange",wolSourceReady:"wolSourceReady"},exportAs:["wolVectorTileLayer"],features:[te],ngContentSelectors:Er,decls:1,vars:0,template:function(t,r){t&1&&(ie(),ne(0))},encapsulation:2,changeDetection:0})};function ti(n){let e={host:!0,optional:!0},t=B(ye,e),r=B(xe,e);if(t)return{setSource:o=>(t.getInstance()?.setSource(o),()=>{t.getInstance()?.setSource(null)}),getInstance:()=>t.getInstance()};if(r)return{setSource:o=>(r.getInstance()?.setSource(o),()=>{r.getInstance()?.setSource(null)}),getInstance:()=>r.getInstance()};throw new Error(`No VectorTileSource host found. Please wrap the ${n} component in a VectorTileLayer or WebGLVectorTileLayer component.`)}var Ht=[],Le=class extends le{constructor(e,t,r,o,i){super(e,t,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=o.bind(void 0,this),this.removeSourceTiles_=i,this.wrappedTileCoord=r}getContext(){return this.context_||(this.context_=$e(1,1,Ht)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(e){let t=L(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){this.context_&&(Je(this.context_),Ht.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}},Kt=Le;var Oe=class extends le{constructor(e,t,r,o,i,s){super(e,t,s),this.extent=null,this.format_=o,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=i,this.url_=r,this.key=r}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==R.IDLE&&(this.setState(R.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(R.ERROR)}setFeatures(e){this.features_=e,this.setState(R.LOADED)}setLoader(e){this.loader_=e}},Xt=Oe;var ke=class extends ht{constructor(e){let t=e.projection||"EPSG:3857",r=e.extent||ut(t),o=e.tileGrid||dt({extent:r,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,projection:t,state:e.state,tileGrid:o,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Sr,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:Xt,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(e,t,r){if(r.getState()===R.IDLE){r.setState(R.LOADING);let o=r.wrappedTileCoord,i=this.getTileGridForProjection(t),s=i.getTileCoordExtent(o),d=o[0],l=i.getResolution(d);Z(s,-l,s);let a=this.projection;t&&this.projection&&!O(t,a)&&(s=z(s,t,a));let c=this.tileGrid,u=c.getExtent();u&&j(s,u,s);let h=l;t&&a&&!O(t,a)&&(h=l/a.getMetersPerUnit()/t.getMetersPerUnit());let p=c.getZForResolution(h,this.zDirection);c.forEachTileCoord(s,p,f=>{let m=this.tileUrlFunction(f,e,t);this.sourceTiles_[m]||(this.sourceTiles_[m]=new this.tileClass(f,m?R.IDLE:R.EMPTY,m,this.format_,this.tileLoadFunction));let g=this.sourceTiles_[m];r.sourceTiles.push(g),this.tileKeysBySourceTileUrl_[m]||(this.tileKeysBySourceTileUrl_[m]=[]),this.tileKeysBySourceTileUrl_[m].push(r.getKey());let T=g.getState();if(T<R.LOADED){let x=w=>{this.handleTileChange(w);let E=g.getState();if(E===R.LOADED||E===R.ERROR){let y=g.getKey();y in r.errorTileKeys?g.getState()===R.LOADED&&delete r.errorTileKeys[y]:r.loadingSourceTiles--,E===R.ERROR?r.errorTileKeys[y]=!0:g.removeEventListener(W.CHANGE,x),r.loadingSourceTiles===0&&r.setState(Ke(r.errorTileKeys)?R.LOADED:R.ERROR)}};g.addEventListener(W.CHANGE,x),r.loadingSourceTiles++}T===R.IDLE&&(g.extent=c.getTileCoordExtent(f),g.projection=this.projection,g.resolution=c.getResolution(f[0]),g.load())}),r.loadingSourceTiles||r.setState(r.sourceTiles.some(f=>f.getState()===R.ERROR)?R.ERROR:R.LOADED)}return r.sourceTiles}removeSourceTiles(e){let t=e.getKey(),r=e.sourceTiles;for(let o=0,i=r.length;o<i;++o){let s=r[o].getTileUrl();if(!this.tileKeysBySourceTileUrl_[s])return;let d=this.tileKeysBySourceTileUrl_[s].indexOf(t);d!==-1&&(this.tileKeysBySourceTileUrl_[s].splice(d,1),this.tileKeysBySourceTileUrl_[s].length===0&&(delete this.tileKeysBySourceTileUrl_[s],delete this.sourceTiles_[s]))}}getTile(e,t,r,o,i){let s=[e,t,r],d=this.getTileCoordForTileUrlFunction(s,i),l=this.getTileGrid().getExtent(),a=this.projection,c=this.getTileGridForProjection(i);if(d&&l){let p=c.getTileCoordExtent(d);Z(p,-c.getResolution(e),p),G(l,!i||!a||O(i,a)?p:z(p,i,a))||(d=null)}let u=!0;if(d!==null){let p=this.tileGrid,f=c.getResolution(e),m=f;i&&a&&!O(i,a)&&(m=f/a.getMetersPerUnit()/i.getMetersPerUnit());let g=p.getZForResolution(m,1),T=c.getTileCoordExtent(d);Z(T,-f,T),p.forEachTileCoord(!i||!a||O(i,a)?T:z(T,i,a),g,x=>{u=u&&!this.tileUrlFunction(x,o,a)})}let h=new Kt(s,u?R.EMPTY:R.IDLE,d,this.getSourceTiles.bind(this,o,i),this.removeSourceTiles.bind(this));return h.key=this.getKey(),h}getTileGridForProjection(e){let t=e.getCode(),r=this.tileGrids_[t];if(!r){let o=this.projection;if(o!==null&&!O(o,e))return ct(e);let i=this.tileGrid,s=i.getResolutions().slice(),d=s.map(function(c,u){return i.getOrigin(u)}),l=s.map(function(c,u){return i.getTileSize(u)}),a=43;for(let c=s.length;c<a;++c)s.push(s[c-1]/2),d.push(d[c-1]),l.push(l[c-1]);r=new at({extent:i.getExtent(),origins:d,resolutions:s,tileSizes:l}),this.tileGrids_[t]=r}return r}getTilePixelRatio(e){return e}getTilePixelSize(e,t,r){let o=this.getTileGridForProjection(r),i=de(o.getTileSize(e),this.tmpSize);return[Math.round(i[0]*t),Math.round(i[1]*t)]}setOverlaps(e){this.overlaps_=e,this.changed()}},Si=ke;function Sr(n,e){n.setLoader(function(t,r,o){kt(e,n.getFormat(),t,r,o,n.onLoad.bind(n),n.onError.bind(n))})}export{Nr as a,xe as b,ye as c,ti as d,Si as e};
