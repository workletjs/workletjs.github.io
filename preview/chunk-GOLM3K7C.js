import{d as C}from"./chunk-45VHQ4GC.js";import{e as y}from"./chunk-XSNNSIR3.js";import{Cc as m,G as P,Jc as G,K as g,Oc as E,a as j,z as u}from"./chunk-H4U5SDNF.js";import{m as F,u as a}from"./chunk-L76X3E7P.js";var f=class extends C{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,projection:e.projection,state:e.state,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:O,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection}),this.crossOrigin=e.crossOrigin!==void 0?e.crossOrigin:null,this.tileClass=e.tileClass!==void 0?e.tileClass:m,this.tileGridForProjection={},this.reprojectionErrorThreshold_=e.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}getGutterForProjection(e){return this.getProjection()&&e&&!a(this.getProjection(),e)?0:this.getGutter()}getGutter(){return 0}getKey(){let e=super.getKey();return this.getInterpolate()||(e+=":disable-interpolation"),e}getTileGridForProjection(e){let r=this.getProjection();if(this.tileGrid&&(!r||a(r,e)))return this.tileGrid;let i=u(e);return i in this.tileGridForProjection||(this.tileGridForProjection[i]=y(e)),this.tileGridForProjection[i]}createTile_(e,r,i,n,t,o){let s=[e,r,i],l=this.getTileCoordForTileUrlFunction(s,t),c=l?this.tileUrlFunction(l,n,t):void 0,d=new this.tileClass(s,c!==void 0?g.IDLE:g.EMPTY,c!==void 0?c:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return d.key=o,d.addEventListener(j.CHANGE,this.handleTileChange.bind(this)),d}getTile(e,r,i,n,t,o){let s=this.getProjection();if(!s||!t||a(s,t))return this.getTileInternal(e,r,i,n,s||t);let l=[e,r,i],c=this.getKey(),d=this.getTileGridForProjection(s),w=this.getTileGridForProjection(t),R=this.getTileCoordForTileUrlFunction(l,t),T=new G(s,d,t,w,l,R,this.getTilePixelRatio(n),this.getGutter(),(b,v,I,K)=>this.getTileInternal(b,v,I,K,s,o),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return T.key=c,T}getTileInternal(e,r,i,n,t,o){let s=this.getKey(),l=E(this,s,e,r,i);if(o&&o.containsKey(l))return o.get(l);let c=this.createTile_(e,r,i,n,t,s);return o?.set(l,c),c}setRenderReprojectionEdges(e){this.renderReprojectionEdges_!=e&&(this.renderReprojectionEdges_=e,this.changed())}setTileGridForProjection(e,r){let i=F(e);if(i){let n=u(i);n in this.tileGridForProjection||(this.tileGridForProjection[n]=r)}}};function O(h,e){if(P){let r=h.getCrossOrigin(),i="same-origin",n="same-origin";r==="anonymous"||r===""?(i="cors",n="omit"):r==="use-credentials"&&(i="cors",n="include"),fetch(e,{mode:i,credentials:n}).then(t=>{if(!t.ok)throw new Error(`HTTP ${t.status}`);return t.blob()}).then(t=>createImageBitmap(t)).then(t=>{let o=h.getImage();o.width=t.width,o.height=t.height,o.getContext("2d").drawImage(t,0,0),t.close?.(),o.dispatchEvent(new Event("load"))}).catch(()=>{h.getImage().dispatchEvent(new Event("error"))});return}h.getImage().src=e}var z=f;export{O as a,z as b};
