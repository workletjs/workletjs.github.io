import{b as M}from"./chunk-A4IKBYL2.js";import{a as L}from"./chunk-XEW5TN3J.js";import{B as T,ab as p,fb as m,h as g,hb as I,k as F,kb as b,kc as x,q as C,w as d,z as c}from"./chunk-HGXUMOE5.js";import{g as A}from"./chunk-L76X3E7P.js";var y={SELECT:"select"},h=class extends C{constructor(e,t,i,r){super(e),this.selected=t,this.deselected=i,this.mapBrowserEvent=r}},_={},v=class n extends p{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:I,this.addCondition_=e.addCondition?e.addCondition:m,this.removeCondition_=e.removeCondition?e.removeCondition:m,this.toggleCondition_=e.toggleCondition?e.toggleCondition:b,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:F,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:O(),this.features_=e.features||new T;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{let i=e.layers;t=function(r){return i.includes(r)}}else t=F;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[c(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[c(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(d.ADD,this.boundAddFeature_),this.features_.addEventListener(d.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(d.ADD,this.boundAddFeature_),this.features_.removeEventListener(d.REMOVE,this.boundRemoveFeature_))}addFeature_(e){let t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){let i=this.findLayerOfFeature_(t);i&&this.addFeatureLayerAssociation_(t,i)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}findLayerOfFeature_(e){return this.getMap().getAllLayers().find(function(i){if(i instanceof M&&i.getSource()&&i.getSource().hasFeature(e))return i})}getStyle(){return this.style_}applySelectedStyle_(e){let t=c(e);t in _||(_[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){let t=this.getMap().getInteractions().getArray();for(let r=t.length-1;r>=0;--r){let l=t[r];if(l!==this&&l instanceof n&&l.getStyle()&&l.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(l.getStyle());return}}let i=c(e);e.setStyle(_[i]),delete _[i]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[c(e)]}selectFeatureInternal_(e,t,i){if(!(e instanceof L)||!this.filter_(e,t))return;let r=this.getFeatures();return r.getArray().includes(e)||(this.addFeatureLayerAssociation_(e,t),r.push(e),i?.push(e)),e}selectFeature(e){let t=this.findLayerOfFeature_(e);if(!this.layerFilter_(t))return!1;let i=this.selectFeatureInternal_(e,t);return i&&this.dispatchEvent(new h(y.SELECT,[i],[],void 0)),!!i}removeFeatureInternal_(e,t){let i=this.getFeatures();if(!(!(e instanceof L)||!i.getArray().includes(e)))return i.remove(e),this.removeFeatureLayerAssociation_(e),t?.push(e),e}deselectFeature(e){let t=this.removeFeatureInternal_(e);return t&&this.dispatchEvent(new h(y.SELECT,[],[t],void 0)),!!t}toggleFeature(e){this.deselectFeature(e)||this.selectFeature(e)}clearSelection(){A(this.featureLayerAssociation_);let e=this.getFeatures(),t=e.getArray().slice();e.clear(),t.length!==0&&this.dispatchEvent(new h(y.SELECT,[],t,void 0))}handleEvent(e){if(!this.condition_(e))return!0;let t=this.addCondition_(e),i=this.removeCondition_(e),r=this.toggleCondition_(e),l=!t&&!i&&!r,S=e.map,E=this.getFeatures(),f=[],o=[];if(l){let u=!1;S.forEachFeatureAtPixel(e.pixel,(a,s)=>{if(u=!0,!!this.selectFeatureInternal_(a,s,o))return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let a=E.getLength()-1;a>=0;--a){let s=E.item(a);(o.length>0&&!o.includes(s)||!u)&&this.removeFeatureInternal_(s,f)}}else S.forEachFeatureAtPixel(e.pixel,(u,a)=>{let s;if((i||r)&&(s=this.removeFeatureInternal_(u,f)),(t||r)&&!s&&(s=this.selectFeatureInternal_(u,a,o)),!!s)return!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});return(o.length>0||f.length>0)&&this.dispatchEvent(new h(y.SELECT,o,f,e)),!0}};function O(){let n=x();return g(n.Polygon,n.LineString),g(n.GeometryCollection,n.LineString),function(e){return e.getGeometry()?n[e.getGeometry().getType()]:null}}var J=v;export{J as a};
