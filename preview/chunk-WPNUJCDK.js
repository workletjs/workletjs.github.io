import{Ac as ge,Dc as fe,Ea as Ue,Ec as Ne,Fc as G,Gc as le,J as F,K as D,Lc as We,Mc as qe,Nc as L,Oc as He,S as de,Sc as Qe,W as be,Wc as Ve,Xc as Be,d as Ze,f as Me,j as Ae,q as je,y as ve,yb as ke,z,zb as S}from"./chunk-RU7HBO54.js";import{E as se,f as Le,m as re}from"./chunk-S7COXUW4.js";import{B as Ge,L as Oe,N as Ke,O as Ye,P as ne,Q as oe,S as ue,T as De,a as Ie,k as N,l as W,s as te,w as Xe,x as ie}from"./chunk-QFWXP63S.js";var b=[0,0,0],v=5,me=class{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,D(Ae(this.resolutions_,(n,o)=>o-n,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let n=0,o=this.resolutions_.length-1;n<o;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,D(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=oe(i)),D(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,D(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:256,D(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((n,o)=>{let r=new le(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){let s=this.getTileRangeForExtentAndZ(i,o);r.minX=Math.max(s.minX,r.minX),r.maxX=Math.min(s.maxX,r.maxX),r.minY=Math.max(s.minY,r.minY),r.maxY=Math.min(s.maxY,r.maxY)}return r}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){let n=this.getTileRangeForExtentAndZ(e,t);for(let o=n.minX,r=n.maxX;o<=r;++o)for(let s=n.minY,a=n.maxY;s<=a;++s)i([t,o,s])}forEachTileCoordParentTileRange(e,t,i,n){let o,r,s,a=null,l=e[0]-1;for(this.zoomFactor_===2?(r=e[1],s=e[2]):a=this.getTileCoordExtent(e,n);l>=this.minZoom;){if(r!==void 0&&s!==void 0?(r=Math.floor(r/2),s=Math.floor(s/2),o=G(r,r,s,s,i)):o=this.getTileRangeForExtentAndZ(a,l,i),t(l,o))return!0;--l}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){let o=e[1]*2,r=e[2]*2;return G(o,o+1,r,r+1,t)}let n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;let n=e[0],o=e[1],r=e[2];if(t===n)return G(o,r,o,r,i);if(this.zoomFactor_){let a=Math.pow(this.zoomFactor_,t-n),l=Math.floor(o*a),c=Math.floor(r*a);if(t<n)return G(l,l,c,c,i);let u=Math.floor(a*(o+1))-1,d=Math.floor(a*(r+1))-1;return G(l,u,c,d,i)}let s=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,b);let n=b[1],o=b[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,b);let r=b[1],s=b[2];return G(n,r,o,s,i)}getTileCoordCenter(e){let t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=S(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){let i=this.getOrigin(e[0]),n=this.getResolution(e[0]),o=S(this.getTileSize(e[0]),this.tmpSize_),r=i[0]+e[1]*o[0]*n,s=i[1]-(e[2]+1)*o[1]*n,a=r+o[0]*n,l=s+o[1]*n;return ie(r,s,a,l,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,o){let r=this.getZForResolution(i),s=i/this.getResolution(r),a=this.getOrigin(r),l=S(this.getTileSize(r),this.tmpSize_),c=s*(e-a[0])/i/l[0],u=s*(a[1]-t)/i/l[1];return n?(c=W(c,v)-1,u=W(u,v)-1):(c=N(c,v),u=N(u,v)),L(r,c,u,o)}getTileCoordForXYAndZ_(e,t,i,n,o){let r=this.getOrigin(i),s=this.getResolution(i),a=S(this.getTileSize(i),this.tmpSize_),l=(e-r[0])/s/a[0],c=(r[1]-t)/s/a[1];return n?(l=W(l,v)-1,c=W(c,v)-1):(l=N(l,v),c=N(c,v)),L(i,l,c,o)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){let i=Me(this.resolutions_,e,t||0);return Ie(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Ue(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){let t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}},q=me;var xe=class extends q{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}},Et=xe;function $e(h){let e=h.getDefaultTileGrid();return e||(e=ut(h),h.setDefaultTileGrid(e)),e}function Je(h,e,t){let i=e[0],n=h.getTileCoordCenter(e),o=tt(t);if(!te(o,n)){let r=ue(o),s=Math.ceil((o[0]-n[0])/r);return n[0]+=r*s,h.getTileCoordForCoordAndZ(n,i)}return e}function ht(h,e,t,i){i=i!==void 0?i:"top-left";let n=et(h,e,t);return new q({extent:h,origin:Oe(h,i),resolutions:n,tileSize:t})}function At(h){let e=h||{},t=e.extent||re("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:et(t,e.maxZoom,e.tileSize,e.maxResolution)};return new q(i)}function et(h,e,t,i){e=e!==void 0?e:42,t=S(t!==void 0?t:256);let n=Ye(h),o=ue(h);i=i>0?i:Math.max(o/t[0],n/t[1]);let r=e+1,s=new Array(r);for(let a=0;a<r;++a)s[a]=i/Math.pow(2,a);return s}function ut(h,e,t,i){let n=tt(h);return ht(n,e,t,i)}function tt(h){h=re(h);let e=h.getExtent();if(!e){let t=180*Le.degrees/h.getMetersPerUnit();e=ie(-t,-t,t,t)}return e}function pe(h,e,t,i,n){return`${z(h)},${e},${He(t,i,n)}`}function Te(h,e,t){if(!(t in h))return h[t]=new Set([e]),!0;let i=h[t],n=i.has(e);return n||i.add(e),!n}function dt(h,e,t){let i=h[t];return i?i.delete(e):!1}function it(h,e){let t=h.layerStatesArray[h.layerIndex];t.extent&&(e=ne(e,se(t.extent,h.viewState.projection)));let i=t.layer.getRenderSource();if(!i.getWrapX()){let n=i.getTileGridForProjection(h.viewState.projection).getExtent();n&&(e=ne(e,n))}return e}var _e=class extends Ve{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Xe(),this.tempTileRange_=new le(0,0,0,0),this.tempTileCoord_=L(0,0,0);let i=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new qe(i),this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getOrCreateTile(e,t,i,n){let o=this.tileCache_,s=this.getLayer().getSource(),a=pe(s,s.getKey(),e,t,i),l;if(o.containsKey(a))l=o.get(a);else{if(l=s.getTile(e,t,i,n.pixelRatio,n.viewState.projection),!l)return null;o.set(a,l)}return l}getTile(e,t,i,n){let o=this.getOrCreateTile(e,t,i,n);return o||null}getData(e){let t=this.frameState;if(!t)return null;let i=this.getLayer(),n=de(t.pixelToCoordinateTransform,e.slice()),o=i.getExtent();if(o&&!te(o,n))return null;let r=t.viewState,s=i.getRenderSource(),a=s.getTileGridForProjection(r.projection),l=s.getTilePixelRatio(t.pixelRatio);for(let c=a.getZForResolution(r.resolution);c>=a.getMinZoom();--c){let u=a.getTileCoordForCoordAndZ(n,c),d=this.getTile(c,u[1],u[2],t);if(!d||d.getState()!==F.LOADED)continue;let f=a.getOrigin(c),x=S(a.getTileSize(c)),P=a.getResolution(c),g;if(d instanceof Ne||d instanceof We)g=d.getImage();else if(d instanceof fe){if(g=ge(d.getData()),!g)continue}else continue;let C=Math.floor(l*((n[0]-f[0])/P-u[1]*x[0])),I=Math.floor(l*((f[1]-n[1])/P-u[2]*x[1])),y=Math.round(l*s.getGutterForProjection(r.projection));return this.getImageData(g,C+y,I+y)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;let t=this.getLayer().getSource();if(!t)return!1;let i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&this.tileCache_.clear()):this.renderedSourceRevision_=i,!0}enqueueTiles(e,t,i,n,o){let r=e.viewState,s=this.getLayer(),a=s.getRenderSource(),l=a.getTileGridForProjection(r.projection),c=z(a);c in e.wantedTiles||(e.wantedTiles[c]={});let u=e.wantedTiles[c],d=s.getMapInternal(),f=Math.max(i-o,l.getMinZoom(),l.getZForResolution(Math.min(s.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(s.getMinZoom(),0)):l.getResolution(0)),a.zDirection)),x=r.rotation,P=x?Ke(r.center,r.resolution,x,e.size):void 0;for(let g=i;g>=f;--g){let C=l.getTileRangeForExtentAndZ(t,g,this.tempTileRange_),I=l.getResolution(g);for(let y=C.minX;y<=C.maxX;++y)for(let w=C.minY;w<=C.maxY;++w){if(x&&!l.tileCoordIntersectsViewport([g,y,w],P))continue;let Z=this.getTile(g,y,w,e);if(!Z||!Te(n,Z,g))continue;let p=Z.getKey();if(u[p]=!0,Z.getState()===F.IDLE&&!e.tileQueue.isKeyQueued(p)){let U=L(g,y,w,this.tempTileCoord_);e.tileQueue.enqueue([Z,c,l.getTileCoordCenter(U),I])}}}}findStaleTile_(e,t){let i=this.tileCache_,n=e[0],o=e[1],r=e[2],s=this.getStaleKeys();for(let a=0;a<s.length;++a){let l=pe(this.getLayer().getSource(),s[a],n,o,r);if(i.containsKey(l)){let c=i.peek(l);if(c.getState()===F.LOADED)return c.endTransition(z(this)),Te(t,c,n),!0}}return!1}findAltTiles_(e,t,i,n){let o=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!o)return!1;let r=!0,s=this.tileCache_,a=this.getLayer().getRenderSource(),l=a.getKey();for(let c=o.minX;c<=o.maxX;++c)for(let u=o.minY;u<=o.maxY;++u){let d=pe(a,l,i,c,u),f=!1;if(s.containsKey(d)){let x=s.peek(d);x.getState()===F.LOADED&&(Te(n,x,i),f=!0)}f||(r=!1)}return r}renderFrame(e,t){this.renderComplete=!0;let i=e.layerStatesArray[e.layerIndex],n=e.viewState,o=n.projection,r=n.resolution,s=n.center,a=e.pixelRatio,l=this.getLayer(),c=l.getSource(),u=c.getTileGridForProjection(o),d=u.getZForResolution(r,c.zDirection),f=u.getResolution(d),x=c.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==x&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=x):this.renderedSourceKey_=x;let P=e.extent,g=c.getTilePixelRatio(a);this.prepareContainer(e,t);let C=this.context.canvas.width,I=this.context.canvas.height,y=i.extent&&se(i.extent,o);y&&(P=ne(P,se(i.extent,o)));let w=f*C/2/g,Z=f*I/2/g,O=[s[0]-w,s[1]-Z,s[0]+w,s[1]+Z],p={};this.renderedTiles.length=0;let U=l.getPreload();if(e.nextExtent){let T=u.getZForResolution(n.nextResolution,c.zDirection),_=it(e,e.nextExtent);this.enqueueTiles(e,_,T,p,U)}let Se=it(e,P);if(this.enqueueTiles(e,Se,d,p,0),U>0&&setTimeout(()=>{this.enqueueTiles(e,Se,d-1,p,U-1)},0),!(d in p))return this.container;let ye=z(this),ot=e.time;for(let T of p[d]){let _=T.getState();if(_===F.EMPTY)continue;let M=T.tileCoord;if(_===F.LOADED&&T.getAlpha(ye,ot)===1){T.endTransition(ye);continue}if(_!==F.ERROR&&(this.renderComplete=!1),this.findStaleTile_(M,p)){dt(p,T,d),e.animate=!0;continue}if(this.findAltTiles_(u,M,d+1,p))continue;let Y=u.getMinZoom();for(let X=d-1;X>=Y&&!this.findAltTiles_(u,M,X,p);--X);}let H=f/r*a/g,m=this.getRenderContext(e);be(this.tempTransform,C/2,I/2,H,H,0,-C/2,-I/2),i.extent&&this.clipUnrotated(m,e,y),c.getInterpolate()||(m.imageSmoothingEnabled=!1),this.preRender(m,e);let Q=Object.keys(p).map(Number);Q.sort(Ze);let E,ce=[],Ce=[];for(let T=Q.length-1;T>=0;--T){let _=Q[T],M=c.getTilePixelSize(_,a,o),K=u.getResolution(_)/f,Y=M[0]*K*H,X=M[1]*K*H,V=u.getTileCoordForCoordAndZ(oe(O),_),Ee=u.getTileCoordExtent(V),B=de(this.tempTransform,[g*(Ee[0]-O[0])/f,g*(O[3]-Ee[3])/f]),rt=g*c.getGutterForProjection(o);for(let k of p[_]){if(k.getState()!==F.LOADED)continue;let ze=k.tileCoord,Fe=V[1]-ze[1],st=Math.round(B[0]-(Fe-1)*Y),Pe=V[2]-ze[2],lt=Math.round(B[1]-(Pe-1)*X),A=Math.round(B[0]-Fe*Y),j=Math.round(B[1]-Pe*X),$=st-A,J=lt-j,we=Q.length===1,he=!1;E=[A,j,A+$,j,A+$,j+J,A,j+J];for(let ee=0,ct=ce.length;ee<ct;++ee)if(!we&&_<Ce[ee]){let R=ce[ee];De([A,j,A+$,j+J],[R[0],R[3],R[4],R[7]])&&(he||(m.save(),he=!0),m.beginPath(),m.moveTo(E[0],E[1]),m.lineTo(E[2],E[3]),m.lineTo(E[4],E[5]),m.lineTo(E[6],E[7]),m.moveTo(R[6],R[7]),m.lineTo(R[4],R[5]),m.lineTo(R[2],R[3]),m.lineTo(R[0],R[1]),m.clip())}ce.push(E),Ce.push(_),this.drawTile(k,e,A,j,$,J,rt,we),he&&m.restore(),this.renderedTiles.unshift(k),this.updateUsedTiles(e.usedTiles,c,k)}}if(this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!Ge(this.renderedExtent_,O),this.renderedExtent_=O,this.renderedPixelRatio=a,this.postRender(this.context,e),i.extent&&m.restore(),m.imageSmoothingEnabled=!0,this.renderComplete){let T=(_,M)=>{let ae=z(c),K=M.wantedTiles[ae],Y=K?Object.keys(K).length:0;this.updateCacheSize(Y),this.tileCache_.expireCache()};e.postRenderFunctions.push(T)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,i,n,o,r,s,a){let l;if(e instanceof fe){if(l=ge(e.getData()),!l)throw new Error("Rendering array data is not yet supported")}else l=this.getTileImage(e);if(!l)return;let c=this.getRenderContext(t),u=z(this),d=t.layerStatesArray[t.layerIndex],f=d.opacity*(a?e.getAlpha(u,t.time):1),x=f!==c.globalAlpha;x&&(c.save(),c.globalAlpha=f),c.drawImage(l,s,s,l.width-2*s,l.height-2*s,i,n,o,r),x&&c.restore(),f!==d.opacity?t.animate=!0:a&&e.endTransition(u)}getImage(){let e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){let n=z(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}},qt=_e;var Qt={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var Re=class extends Be{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;let t=[256,256];this.tileGrid&&S(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||z(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){let t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,o){return ve()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:$e(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){let n=this.getTileGridForProjection(i),o=this.getTilePixelRatio(t),r=S(n.getTileSize(e),this.tmpSize);return o==1?r:ke(r,o,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){let i=t!==void 0?t:this.getProjection(),n=t!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=Je(n,e,i)),Qe(e,n)?e:null}clear(){}refresh(){this.clear(),super.refresh()}},nt=class extends je{constructor(e,t){super(e),this.tile=t}},ni=Re;export{qt as a,Qt as b,q as c,Et as d,$e as e,At as f,tt as g,nt as h,ni as i};
