import{a as D}from"./chunk-36MU545B.js";import{b as v}from"./chunk-3KX3IH4N.js";import{d as j}from"./chunk-CQDBB52F.js";import{c as y}from"./chunk-KNT5A3QN.js";import{Cc as G,J as U,Ta as _,zb as F}from"./chunk-SFR7ATWH.js";import{x as E}from"./chunk-GF377ULF.js";var z=class extends G{constructor(e,n,c,l,s,a,i){super(n,c,l,s,a,i),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;let e=super.getImage();if(this.state==U.LOADED){let n=this.tileSize_;if(e.width==n[0]&&e.height==n[1])return this.zoomifyImage_=e,e;let c=_(n[0],n[1]);return c.drawImage(e,0,0),this.zoomifyImage_=c.canvas,c.canvas}return e}},p=class extends D{constructor(e){let n=e.size,c=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",l=e.tilePixelRatio||1,s=n[0],a=n[1],i=[],u=e.tileSize||256,r=u*l;switch(c){case"default":for(;s>r||a>r;)i.push([Math.ceil(s/r),Math.ceil(a/r)]),r+=r;break;case"truncated":let t=s,o=a;for(;t>r||o>r;)i.push([Math.ceil(t/r),Math.ceil(o/r)]),t>>=1,o>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}i.push([1,1]),i.reverse();let m=[l],d=[0];for(let t=1,o=i.length;t<o;t++)m.push(l<<t),d.push(i[t-1][0]*i[t-1][1]+d[t-1]);m.reverse();let f=new y({tileSize:u,extent:e.extent||[0,-a,s,0],resolutions:m}),h=e.url;h&&!h.includes("{TileGroup}")&&!h.includes("{tileIndex}")&&(h+="{TileGroup}/{z}-{x}-{y}.jpg");let R=j(h),x=u*l;function L(t){return(function(o,Z,H){if(!o)return;let g=o[0],I=o[1],C=o[2],w=I+C*i[g][0],O=(w+d[g])/x|0,P={z:g,x:I,y:C,tileIndex:w,TileGroup:"TileGroup"+O};return t.replace(/\{(\w+?)\}/g,function(X,W){return P[W]})})}let T=v(R.map(L)),M=z.bind(null,F(u*l));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:l,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:M,tileGrid:f,tileUrlFunction:T,transition:e.transition}),this.zDirection=e.zDirection;let k=f.getTileCoordForCoordAndResolution(E(f.getExtent()),m[m.length-1]),A=T(k,1,null),S=new Image;S.addEventListener("error",()=>{x=u,this.changed()}),S.src=A}},te=p;export{te as a};
