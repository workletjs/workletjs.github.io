import{a as lt,b as at}from"./chunk-NMXZJOHS.js";import{a as $e,c as oe,e as Je,f as $,g as Qe,h as et,k as rt,l as it,m as ot,n as nt,o as se,p as st}from"./chunk-WWJ44XJ2.js";import{d as tt,f as ne}from"./chunk-3ZX67TCU.js";import{d as qe}from"./chunk-YVF6ZWVF.js";import{a as He,b as z,c as We,f as Xe,g as Ye}from"./chunk-7JSZMF5L.js";import{Da as Be,Ea as Ue,F as m,G as X,I as N,K as Le,Ka as Ze,L as ie,La as Ae,M as Oe,Mb as je,O as ke,Q as j,R as Ge,Ub as ze,Vb as q,Ya as Y,a as re,d as Me,nc as Ke,qa as Ne,u as Ve,y as b}from"./chunk-FDJJDQFY.js";import{b as De,g as _e,m as Ie,u as be}from"./chunk-AKEHF7AE.js";import{C as W,D as Pe,G as O,b as Re,c as G,g as Ee,ja as ve,o as Ce}from"./chunk-O23OEJHM.js";import{Aa as ye,Ja as Te,P as xe,S as H,Tb as k,Ub as M,Xb as _,_ as we,ea as pe,jb as Se,kb as Fe,za as me}from"./chunk-JM5XIBFZ.js";var Tt={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},dt={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},le=class extends He{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=Le(),this.tileClipContexts_=null}drawTile(e,t,r,i,n,s,c,l){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,r,i,n,s,c,l)}getTile(e,t,r,i){let n=this.getOrCreateTile(e,t,r,i);if(!n)return null;let c=i.viewState.resolution,l=i.viewHints;return(!(l[N.ANIMATING]||l[N.INTERACTING])||!n.wantedResolution)&&(n.wantedResolution=c),n}prepareFrame(e){let t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){let i=this.getLayer(),n=i.getRevision(),s=i.getRenderOrder()||null,c=e.wantedResolution,l=e.getReplayState(i);if(!l.dirty&&l.renderedResolution===c&&l.renderedRevision==n&&l.renderedRenderOrder==s)return;let a=i.getSource(),d=!!i.getDeclutter(),h=a.getTileGrid(),f=a.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),g=a.getSourceTiles(t,r,e),w=b(i);delete e.hitDetectionImageData[w],e.executorGroups[w]=[],l.dirty=!1;for(let p=0,F=g.length;p<F;++p){let y=g[p];if(y.getState()!=m.LOADED)continue;let x=y.tileCoord,R=h.getTileCoordExtent(x),T=W(f,R),E=G(T,i.getRenderBuffer()*c,this.tempExtent),S=Ce(R,T)?null:E,I=new $e(0,T,c,t),L=tt(c,t),Z=function(V,P){let B,fe=V.getStyleFunction()||i.getStyleFunction();if(fe&&(B=fe(V,c)),B){let yt=this.renderFeature(V,L,B,I,d,P);l.dirty=l.dirty||yt}},C=y.getFeatures();s&&s!==l.renderedRenderOrder&&C.sort(s);for(let V=0,P=C.length;V<P;++V){let B=C[V];(!S||O(S,B.getGeometry().getExtent()))&&Z.call(this,B,V)}let v=I.finish(),A=i.getRenderMode()!=="vector"&&d&&g.length===1?null:T,D=new Je(A,c,t,a.getOverlaps(),v,i.getRenderBuffer(),!0);e.executorGroups[w].push(D)}l.renderedRevision=n,l.renderedRenderOrder=s,l.renderedResolution=c}forEachFeatureAtCoordinate(e,t,r,i,n){let s=t.viewState.resolution,c=t.viewState.rotation;r=r??0;let l=this.getLayer(),d=l.getSource().getTileGridForProjection(t.viewState.projection),h=Re([e]);G(h,s*r,h);let u={},f=function(x,R,T){let E=x.getId();E===void 0&&(E=b(x));let S=u[E];if(S){if(S!==!0&&T<S.distanceSq){if(T===0)return u[E]=!0,n.splice(n.lastIndexOf(S),1),i(x,l,R);S.geometry=R,S.distanceSq=T}}else{if(T===0)return u[E]=!0,i(x,l,R);n.push(u[E]={feature:x,layer:l,geometry:R,distanceSq:T,callback:i})}},g=this.renderedTiles,w=b(l),p=l.getDeclutter(),F=p?t.declutter?.[p]?.all().map(x=>x.value):null,y;e:for(let x=0,R=g.length;x<R;++x){let T=g[x],E=d.getTileCoordExtent(T.wrappedTileCoord);if(!O(E,h))continue;let S=T.executorGroups[w];for(let I=0,L=S.length;I<L;++I)if(y=S[I].forEachFeatureAtCoordinate(e,s,c,r,f,F),y)break e}return y}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((t,r)=>{let i=this.getLayer(),n=i.getSource(),s=this.renderedProjection,c=s.getExtent(),l=this.renderedResolution,a=n.getTileGridForProjection(s),d=ke(this.renderedPixelToCoordinateTransform_,e.slice()),h=a.getTileCoordForCoordAndResolution(d,l).toString(),u=this.renderedTiles.find(x=>x.tileCoord.toString()===h&&x.getState()===m.LOADED);if(!u||u.loadingSourceTiles>0){t([]);return}n.getWrapX()&&s.canWrapX()&&!Ee(c,a.getTileCoordExtent(u.tileCoord))&&ve(d,s);let f=b(i),g=a.getTileCoordExtent(u.wrappedTileCoord),w=Pe(g),p=[(d[0]-w[0])/l,(w[1]-d[1])/l],F=u.getSourceTiles().reduce((x,R)=>x.concat(R.getFeatures()),[]),y=u.hitDetectionImageData[f];if(!y){let x=Y(a.getTileSize(a.getZForResolution(l,n.zDirection))),R=this.renderedRotation_,T=[this.getRenderTransform(a.getTileCoordCenter(u.wrappedTileCoord),l,0,$,x[0]*$,x[1]*$,0)];y=Qe(x,T,F,i.getStyleFunction(),a.getTileCoordExtent(u.wrappedTileCoord),u.getReplayState(i).renderedResolution,R),u.hitDetectionImageData[f]=y}t(et(p,F,y))})}getFeaturesInExtent(e){let t=[],r=this.getTileCache();if(r.getCount()===0)return t;let n=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),s=n.getZForResolution(this.renderedResolution),c={};return r.forEach(l=>{if(l.tileCoord[0]!==s||l.getState()!==m.LOADED)return;let a=l.getSourceTiles();for(let d=0,h=a.length;d<h;++d){let u=a[d],f=u.getKey();if(f in c)continue;c[f]=!0;let g=u.tileCoord;if(O(e,n.getTileCoordExtent(g))){let w=u.getFeatures();if(w)for(let p=0,F=w.length;p<F;++p){let y=w[p],x=y.getGeometry();O(e,x.getExtent())&&t.push(y)}}}}),t}handleFontsChanged(){let e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){let r=this.context,i=r.globalAlpha;r.globalAlpha=t.opacity;let n=e.viewHints,s=!(n[N.ANIMATING]||n[N.INTERACTING]),c=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),a=l?e.declutter?.[l]:void 0,d=b(this.getLayer()),h=this.renderedTiles;for(let u=0,f=h.length;u<f;++u){let g=h[u],w=g.executorGroups[d];if(w)for(let p=w.length-1;p>=0;--p)w[p].execute(this.context,c,this.getTileRenderTransform(g,e),e.viewState.rotation,s,oe,a)}r.globalAlpha=i}renderDeferredInternal(e){let t=this.renderedTiles,r=b(this.getLayer()),i=t.reduce((l,a,d)=>(a.executorGroups[r].forEach(h=>l.push({executorGroup:h,index:d})),l),[]),n=i.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),s={};for(let l=0,a=i.length;l<a;++l){let d=i[l].executorGroup.getDeferredZIndexContexts();for(let h in d)s[h]=!0}Object.keys(s).map(Number).sort(Me).forEach(l=>{n.forEach((a,d)=>{a[l]&&(a[l].forEach(h=>{let{executorGroup:u,index:f}=i[d],g=u.getRenderedContext(),w=g.globalAlpha;g.globalAlpha=this.renderedOpacity_;let p=this.tileClipContexts_[f];p&&p.draw(g),h.draw(g),p&&g.restore(),g.globalAlpha=w,h.clear()}),a[l].length=0)})})}getTileRenderTransform(e,t){let r=t.pixelRatio,i=t.viewState,n=i.center,s=i.resolution,c=i.rotation,l=t.size,a=Math.round(l[0]*r),d=Math.round(l[1]*r),u=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),f=e.tileCoord,g=u.getTileCoordExtent(e.wrappedTileCoord),w=u.getTileCoordExtent(f,this.tempExtent)[0]-g[0];return Oe(j(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(n,s,c,r,a,d,w))}postRender(e,t){let r=t.viewHints,i=!(r[N.ANIMATING]||r[N.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;let n=this.getLayer(),s=n.getRenderMode(),c=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;let l=n.getDeclutter(),a=l?dt[s].filter(T=>!oe.includes(T)):dt[s],d=t.viewState,h=d.rotation,u=n.getSource(),g=u.getTileGridForProjection(d.projection).getZForResolution(d.resolution,u.zDirection),w=this.renderedTiles,p=[],F=[],y=[],x=b(n),R=!0;for(let T=w.length-1;T>=0;--T){let E=w[T];R=R&&!E.getReplayState(n).dirty;let S=E.executorGroups[x].filter(D=>D.hasExecutors(a));if(S.length===0)continue;let I=this.getTileRenderTransform(E,t),L=E.tileCoord[0],Z=!1,C=S[0].getClipCoords(I),v=e,A;if(C){A=new Ke,v=A.getContext();for(let D=0,V=p.length;D<V;++D)if(g!==L&&L<F[D]){let P=p[D];O([C[0],C[3],C[4],C[7]],[P[0],P[3],P[4],P[7]])&&(Z||(v.save(),Z=!0),v.beginPath(),v.moveTo(C[0],C[1]),v.lineTo(C[2],C[3]),v.lineTo(C[4],C[5]),v.lineTo(C[6],C[7]),v.moveTo(P[6],P[7]),v.lineTo(P[4],P[5]),v.lineTo(P[2],P[3]),v.lineTo(P[0],P[1]),v.clip())}p.push(C),F.push(L)}for(let D=0,V=S.length;D<V;++D)S[D].execute(e,[e.canvas.width,e.canvas.height],I,h,i,a,t.declutter?.[l]);Z&&(v===e?v.restore():y[T]=A)}e.globalAlpha=c,this.ready=R,this.tileClipContexts_=y,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,r,i,n,s){if(!r)return!1;let c=!1;if(Array.isArray(r))for(let l=0,a=r.length;l<a;++l)c=ne(i,e,r[l],t,this.boundHandleStyleImageChange_,void 0,n,s)||c;else c=ne(i,e,r,t,this.boundHandleStyleImageChange_,void 0,n,s);return c}tileImageNeedsRender_(e){let t=this.getLayer();if(t.getRenderMode()==="vector")return!1;let r=e.getReplayState(t),i=t.getRevision(),n=e.wantedResolution;return r.renderedTileResolution!==n||r.renderedTileRevision!==i}renderTileImage_(e,t){let r=this.getLayer(),i=e.getReplayState(r),n=r.getRevision(),s=e.executorGroups[b(r)];i.renderedTileRevision=n;let c=e.wrappedTileCoord,l=c[0],a=r.getSource(),d=t.pixelRatio,u=t.viewState.projection,f=a.getTileGridForProjection(u),g=f.getResolution(e.tileCoord[0]),w=t.pixelRatio/e.wantedResolution*g,p=f.getResolution(l),F=e.getContext();d=Math.round(Math.max(d,w/d));let y=a.getTilePixelSize(l,d,u);F.canvas.width=y[0],F.canvas.height=y[1];let x=d/w;if(x!==1){let S=ie(this.tmpTransform_);j(S,x,x),F.setTransform.apply(F,S)}let R=f.getTileCoordExtent(c,this.tempExtent),T=w/p,E=ie(this.tmpTransform_);j(E,T,-T),Ge(E,-R[0],-R[3]);for(let S=0,I=s.length;S<I;++S)s[S].execute(F,[F.canvas.width*x,F.canvas.height*x],E,0,!0,Tt[r.getRenderMode()],null);i.renderedTileResolution=e.wantedResolution}},ct=le;var ae=class extends je{constructor(e){e=e||{};let t=Object.assign({},e);delete t.preload;let r=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=r;let i=e.renderMode||"hybrid";X(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new ct(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(z.PRELOAD)}getUseInterimTilesOnError(){return this.get(z.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(z.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(z.USE_INTERIM_TILES_ON_ERROR,e)}},ut=ae;var Ft=["*"],J=class o{wolClassName=M();wolOpacity=_();wolVisible=_();wolExtent=_();wolZIndex=_();wolMinResolution=_();wolMaxResolution=_();wolMinZoom=_();wolMaxZoom=_();wolRenderOrder=M();wolRenderBuffer=M();wolRenderMode=M();wolSource=_();wolMap=M();wolDeclutter=M();wolStyle=M();wolBackground=M();wolUpdateWhileAnimating=M();wolUpdateWhileInteracting=M();wolPreload=_();wolUseInterimTilesOnError=_();wolProperties=M();wolCacheSize=M();wolChange=k();wolError=k();wolPostRender=k();wolPreRender=k();wolPropertyChange=k();wolSourceReady=k();instance;constructor(){let e=H(we),t=ze("VectorTileLayer"),r={};Te(()=>{let i=new ut({className:this.wolClassName(),opacity:this.wolOpacity(),visible:this.wolVisible(),extent:this.wolExtent(),zIndex:this.wolZIndex(),minResolution:this.wolMinResolution(),maxResolution:this.wolMaxResolution(),minZoom:this.wolMinZoom(),maxZoom:this.wolMaxZoom(),renderOrder:this.wolRenderOrder(),renderBuffer:this.wolRenderBuffer(),renderMode:this.wolRenderMode(),source:this.wolSource(),map:this.wolMap(),declutter:this.wolDeclutter(),style:this.wolStyle(),background:this.wolBackground(),updateWhileAnimating:this.wolUpdateWhileAnimating(),updateWhileInteracting:this.wolUpdateWhileInteracting(),preload:this.wolPreload(),useInterimTilesOnError:this.wolUseInterimTilesOnError(),properties:this.wolProperties(),cacheSize:this.wolCacheSize()});r.change=i.on("change",n=>this.wolChange.emit(n)),r["change:extent"]=i.on("change:extent",()=>this.wolExtent.set(i.getExtent())),r["change:maxResolution"]=i.on("change:maxResolution",()=>this.wolMaxResolution.set(i.getMaxResolution())),r["change:maxZoom"]=i.on("change:maxZoom",()=>this.wolMaxZoom.set(i.getMaxZoom())),r["change:minResolution"]=i.on("change:minResolution",()=>this.wolMinResolution.set(i.getMinResolution())),r["change:minZoom"]=i.on("change:minZoom",()=>this.wolMinZoom.set(i.getMinZoom())),r["change:opacity"]=i.on("change:opacity",()=>this.wolOpacity.set(i.getOpacity())),r["change:preload"]=i.on("change:preload",()=>this.wolPreload.set(i.getPreload())),r["change:source"]=i.on("change:source",()=>this.wolSource.set(i.getSource()??void 0)),r["change:useInterimTilesOnError"]=i.on("change:useInterimTilesOnError",()=>this.wolUseInterimTilesOnError.set(i.getUseInterimTilesOnError())),r["change:visible"]=i.on("change:visible",()=>this.wolVisible.set(i.getVisible())),r["change:zIndex"]=i.on("change:zIndex",()=>this.wolZIndex.set(i.getZIndex())),r.error=i.on("error",n=>this.wolError.emit(n)),r.postrender=i.on("postrender",n=>this.wolPostRender.emit(n)),r.prerender=i.on("prerender",n=>this.wolPreRender.emit(n)),r.propertychange=i.on("propertychange",n=>this.wolPropertyChange.emit(n)),r.sourceready=i.on("sourceready",n=>this.wolSourceReady.emit(n)),Promise.resolve().then(()=>{t.addLayer(i)}),this.instance=i}),e.onDestroy(()=>{this.instance&&(Ve(Object.values(r)),t.removeLayer(this.instance),this.instance=void 0)})}ngOnChanges(e){if(this.instance)for(let[t,r]of Object.entries(e))switch(t){case"wolBackground":this.instance.setBackground(r.currentValue);break;case"wolDeclutter":this.instance.setDeclutter(r.currentValue);break;case"wolExtent":this.instance.setExtent(r.currentValue);break;case"wolMap":this.instance.setMap(r.currentValue??null);break;case"wolMaxResolution":this.instance.setMaxResolution(r.currentValue);break;case"wolMaxZoom":this.instance.setMaxZoom(r.currentValue);break;case"wolMinResolution":this.instance.setMinResolution(r.currentValue);break;case"wolMinZoom":this.instance.setMinZoom(r.currentValue);break;case"wolOpacity":this.instance.setOpacity(r.currentValue);break;case"wolPreload":this.instance.setPreload(r.currentValue);break;case"wolProperties":this.instance.setProperties(r.currentValue);break;case"wolSource":this.instance.setSource(r.currentValue??null);break;case"wolStyle":this.instance.setStyle(r.currentValue);break;case"wolUseInterimTilesOnError":this.instance.setUseInterimTilesOnError(r.currentValue);break;case"wolVisible":this.instance.setVisible(r.currentValue);break;case"wolZIndex":this.instance.setZIndex(r.currentValue);break}}getInstance(){return this.instance}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=me({type:o,selectors:[["wol-vector-tile-layer"]],inputs:{wolClassName:[1,"wolClassName"],wolOpacity:[1,"wolOpacity"],wolVisible:[1,"wolVisible"],wolExtent:[1,"wolExtent"],wolZIndex:[1,"wolZIndex"],wolMinResolution:[1,"wolMinResolution"],wolMaxResolution:[1,"wolMaxResolution"],wolMinZoom:[1,"wolMinZoom"],wolMaxZoom:[1,"wolMaxZoom"],wolRenderOrder:[1,"wolRenderOrder"],wolRenderBuffer:[1,"wolRenderBuffer"],wolRenderMode:[1,"wolRenderMode"],wolSource:[1,"wolSource"],wolMap:[1,"wolMap"],wolDeclutter:[1,"wolDeclutter"],wolStyle:[1,"wolStyle"],wolBackground:[1,"wolBackground"],wolUpdateWhileAnimating:[1,"wolUpdateWhileAnimating"],wolUpdateWhileInteracting:[1,"wolUpdateWhileInteracting"],wolPreload:[1,"wolPreload"],wolUseInterimTilesOnError:[1,"wolUseInterimTilesOnError"],wolProperties:[1,"wolProperties"],wolCacheSize:[1,"wolCacheSize"]},outputs:{wolOpacity:"wolOpacityChange",wolVisible:"wolVisibleChange",wolExtent:"wolExtentChange",wolZIndex:"wolZIndexChange",wolMinResolution:"wolMinResolutionChange",wolMaxResolution:"wolMaxResolutionChange",wolMinZoom:"wolMinZoomChange",wolMaxZoom:"wolMaxZoomChange",wolSource:"wolSourceChange",wolPreload:"wolPreloadChange",wolUseInterimTilesOnError:"wolUseInterimTilesOnErrorChange",wolChange:"wolChange",wolError:"wolError",wolPostRender:"wolPostRender",wolPreRender:"wolPreRender",wolPropertyChange:"wolPropertyChange",wolSourceReady:"wolSourceReady"},exportAs:["wolVectorTileLayer"],features:[pe],ngContentSelectors:Ft,decls:1,vars:0,template:function(t,r){t&1&&(Se(),Fe(0))},encapsulation:2,changeDetection:0})};var ht=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=ye({type:o});static \u0275inj=xe({})};var gt=23283064365386963e-26,Rt=12,ft=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),de=0,Q=1,K=2,ee=5,te=class{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,r=this.length){for(;this.pos<r;){let i=this.readVarint(),n=i>>3,s=this.pos;this.type=i&7,e(n,t,this),this.pos===s&&this.skip(i)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){let e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){let e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readSFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readFloat(){let e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){let e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){let t=this.buf,r,i;return i=t[this.pos++],r=i&127,i<128||(i=t[this.pos++],r|=(i&127)<<7,i<128)||(i=t[this.pos++],r|=(i&127)<<14,i<128)||(i=t[this.pos++],r|=(i&127)<<21,i<128)?r:(i=t[this.pos],r|=(i&15)<<28,Et(r,e,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){let e=this.readVarint();return e%2===1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){let e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=Rt&&ft?ft.decode(this.buf.subarray(t,e)):Gt(this.buf,t,e)}readBytes(){let e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){let r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===K?this.readVarint()+this.pos:this.pos+1}skip(e){let t=e&7;if(t===de)for(;this.buf[this.pos++]>127;);else if(t===K)this.pos=this.readVarint()+this.pos;else if(t===ee)this.pos+=4;else if(t===Q)this.pos+=8;else throw new Error(`Unimplemented type: ${t}`)}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){let r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*gt),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*gt),!0),this.pos+=8}writeVarint(e){if(e=+e||0,e>268435455||e<0){Ct(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))}writeSVarint(e){this.writeVarint(e<0?-e*2-1:e*2)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(e.length*4),this.pos++;let t=this.pos;this.pos=Nt(this.buf,e,this.pos);let r=this.pos-t;r>=128&&xt(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){let t=e.length;this.writeVarint(t),this.realloc(t);for(let r=0;r<t;r++)this.buf[this.pos++]=e[r]}writeRawMessage(e,t){this.pos++;let r=this.pos;e(t,this);let i=this.pos-r;i>=128&&xt(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i}writeMessage(e,t,r){this.writeTag(e,K),this.writeRawMessage(t,r)}writePackedVarint(e,t){t.length&&this.writeMessage(e,Mt,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,Dt,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,It,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,Vt,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,_t,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,bt,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,Lt,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,Ot,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,kt,t)}writeBytesField(e,t){this.writeTag(e,K),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,ee),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,ee),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,Q),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,Q),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,de),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,de),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,K),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,ee),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,Q),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function Et(o,e,t){let r=t.buf,i,n;if(n=r[t.pos++],i=(n&112)>>4,n<128||(n=r[t.pos++],i|=(n&127)<<3,n<128)||(n=r[t.pos++],i|=(n&127)<<10,n<128)||(n=r[t.pos++],i|=(n&127)<<17,n<128)||(n=r[t.pos++],i|=(n&127)<<24,n<128)||(n=r[t.pos++],i|=(n&1)<<31,n<128))return U(o,i,e);throw new Error("Expected varint not more than 10 bytes")}function U(o,e,t){return t?e*4294967296+(o>>>0):(e>>>0)*4294967296+(o>>>0)}function Ct(o,e){let t,r;if(o>=0?(t=o%4294967296|0,r=o/4294967296|0):(t=~(-o%4294967296),r=~(-o/4294967296),t^4294967295?t=t+1|0:(t=0,r=r+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),Pt(t,r,e),vt(r,e)}function Pt(o,e,t){t.buf[t.pos++]=o&127|128,o>>>=7,t.buf[t.pos++]=o&127|128,o>>>=7,t.buf[t.pos++]=o&127|128,o>>>=7,t.buf[t.pos++]=o&127|128,o>>>=7,t.buf[t.pos]=o&127}function vt(o,e){let t=(o&7)<<4;e.buf[e.pos++]|=t|((o>>>=3)?128:0),o&&(e.buf[e.pos++]=o&127|((o>>>=7)?128:0),o&&(e.buf[e.pos++]=o&127|((o>>>=7)?128:0),o&&(e.buf[e.pos++]=o&127|((o>>>=7)?128:0),o&&(e.buf[e.pos++]=o&127|((o>>>=7)?128:0),o&&(e.buf[e.pos++]=o&127)))))}function xt(o,e,t){let r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(r);for(let i=t.pos-1;i>=o;i--)t.buf[i+r]=t.buf[i]}function Mt(o,e){for(let t=0;t<o.length;t++)e.writeVarint(o[t])}function Dt(o,e){for(let t=0;t<o.length;t++)e.writeSVarint(o[t])}function Vt(o,e){for(let t=0;t<o.length;t++)e.writeFloat(o[t])}function _t(o,e){for(let t=0;t<o.length;t++)e.writeDouble(o[t])}function It(o,e){for(let t=0;t<o.length;t++)e.writeBoolean(o[t])}function bt(o,e){for(let t=0;t<o.length;t++)e.writeFixed32(o[t])}function Lt(o,e){for(let t=0;t<o.length;t++)e.writeSFixed32(o[t])}function Ot(o,e){for(let t=0;t<o.length;t++)e.writeFixed64(o[t])}function kt(o,e){for(let t=0;t<o.length;t++)e.writeSFixed64(o[t])}function Gt(o,e,t){let r="",i=e;for(;i<t;){let n=o[i],s=null,c=n>239?4:n>223?3:n>191?2:1;if(i+c>t)break;let l,a,d;c===1?n<128&&(s=n):c===2?(l=o[i+1],(l&192)===128&&(s=(n&31)<<6|l&63,s<=127&&(s=null))):c===3?(l=o[i+1],a=o[i+2],(l&192)===128&&(a&192)===128&&(s=(n&15)<<12|(l&63)<<6|a&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):c===4&&(l=o[i+1],a=o[i+2],d=o[i+3],(l&192)===128&&(a&192)===128&&(d&192)===128&&(s=(n&15)<<18|(l&63)<<12|(a&63)<<6|d&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,c=1):s>65535&&(s-=65536,r+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),r+=String.fromCharCode(s),i+=c}return r}function Nt(o,e,t){for(let r=0,i,n;r<e.length;r++){if(i=e.charCodeAt(r),i>55295&&i<57344)if(n)if(i<56320){o[t++]=239,o[t++]=191,o[t++]=189,n=i;continue}else i=n-55296<<10|i-56320|65536,n=null;else{i>56319||r+1===e.length?(o[t++]=239,o[t++]=191,o[t++]=189):n=i;continue}else n&&(o[t++]=239,o[t++]=191,o[t++]=189,n=null);i<128?o[t++]=i:(i<2048?o[t++]=i>>6|192:(i<65536?o[t++]=i>>12|224:(o[t++]=i>>18|240,o[t++]=i>>12&63|128),o[t++]=i>>6&63|128),o[t++]=i&63|128)}return t}var ce=class extends lt{constructor(e){super(),e=e||{},this.dataProjection=new _e({code:"",units:"tile-pixels"}),this.featureClass=e.featureClass?e.featureClass:se,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,r,i){e.pos=t.geometry;let n=e.readVarint()+e.pos,s=1,c=0,l=0,a=0,d=0,h=0;for(;e.pos<n;){if(!c){let u=e.readVarint();s=u&7,c=u>>3}if(c--,s===1||s===2)l+=e.readSVarint(),a+=e.readSVarint(),s===1&&d>h&&(i.push(d),h=d),r.push(l,a),d+=2;else if(s===7)d>h&&(r.push(r[h],r[h+1]),d+=2);else throw new Error("Invalid command found in the PBF")}d>h&&(i.push(d),h=d)}createFeature_(e,t,r){let i=t.type;if(i===0)return null;let n,s=t.properties,c;this.idProperty_?(c=s[this.idProperty_],delete s[this.idProperty_]):c=t.id,s[this.layerName_]=t.layer.name;let l=[],a=[];this.readRawGeometry_(e,t,l,a);let d=jt(i,a.length);if(this.featureClass===se)n=new this.featureClass(d,l,a,2,s,c),n.transform(r.dataProjection);else{let h;if(d=="Polygon"){let g=Be(l,a);h=g.length>1?new nt(l,"XY",g):new Ue(l,"XY",a)}else h=d==="Point"?new Ne(l,"XY"):d==="LineString"?new rt(l,"XY"):d==="MultiPoint"?new ot(l,"XY"):d==="MultiLineString"?new it(l,"XY",a):null;let u=this.featureClass;n=new u,this.geometryName_&&n.setGeometryName(this.geometryName_);let f=at(h,!1,r);n.setGeometry(f),c!==void 0&&n.setId(c),n.setProperties(s,!0)}return n}getType(){return"arraybuffer"}readFeatures(e,t){let r=this.layers_;t=this.adaptOptions(t);let i=Ie(t.dataProjection);i.setWorldExtent(t.extent),t.dataProjection=i;let n=new te(e),s=n.readFields(Bt,{}),c=[];for(let l in s){if(r&&!r.includes(l))continue;let a=s[l],d=a?[0,0,a.extent,a.extent]:null;i.setExtent(d);for(let h=0,u=a.length;h<u;++h){let f=At(n,a,h),g=this.createFeature_(n,f,t);g!==null&&c.push(g)}}return c}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}};function Bt(o,e,t){if(o===3){let r={keys:[],values:[],features:[]},i=t.readVarint()+t.pos;t.readFields(Ut,r,i),r.length=r.features.length,r.length&&(e[r.name]=r)}}function Ut(o,e,t){if(o===15)e.version=t.readVarint();else if(o===1)e.name=t.readString();else if(o===5)e.extent=t.readVarint();else if(o===2)e.features.push(t.pos);else if(o===3)e.keys.push(t.readString());else if(o===4){let r=null,i=t.readVarint()+t.pos;for(;t.pos<i;)o=t.readVarint()>>3,r=o===1?t.readString():o===2?t.readFloat():o===3?t.readDouble():o===4?t.readVarint64():o===5?t.readVarint():o===6?t.readSVarint():o===7?t.readBoolean():null;e.values.push(r)}}function Zt(o,e,t){if(o==1)e.id=t.readVarint();else if(o==2){let r=t.readVarint()+t.pos;for(;t.pos<r;){let i=e.layer.keys[t.readVarint()],n=e.layer.values[t.readVarint()];e.properties[i]=n}}else o==3?e.type=t.readVarint():o==4&&(e.geometry=t.pos)}function At(o,e,t){o.pos=e.features[t];let r=o.readVarint()+o.pos,i={layer:e,type:0,properties:{}};return o.readFields(Zt,i,r),i}function jt(o,e){let t;return o===1?t=e===1?"Point":"MultiPoint":o===2?t=e===1?"LineString":"MultiLineString":o===3&&(t="Polygon"),t}var Gr=ce;function Ar(o){let t=H(J,{host:!0,optional:!0});if(t)return{setSource:r=>(t.getInstance()?.setSource(r),()=>{t.getInstance()?.setSource(null)}),getInstance:()=>t.getInstance()};throw new Error(`No VectorTileSource host found. Please wrap the ${o} component in a VectorTileLayer component.`)}var wt=[],ue=class extends q{constructor(e,t,r,i,n){super(e,t,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=i.bind(void 0,this),this.removeSourceTiles_=n,this.wrappedTileCoord=r}getContext(){return this.context_||(this.context_=Ze(1,1,wt)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(e){let t=b(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){this.context_&&(Ae(this.context_),wt.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}},pt=ue;var he=class extends q{constructor(e,t,r,i,n,s){super(e,t,s),this.extent=null,this.format_=i,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=n,this.url_=r,this.key=r}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==m.IDLE&&(this.setState(m.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(m.ERROR)}setFeatures(e){this.features_=e,this.setState(m.LOADED)}setLoader(e){this.loader_=e}},mt=he;var ge=class extends qe{constructor(e){let t=e.projection||"EPSG:3857",r=e.extent||Ye(t),i=e.tileGrid||Xe({extent:r,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,projection:t,state:e.state,tileGrid:i,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:zt,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:mt,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(e,t,r){if(r.getState()===m.IDLE){r.setState(m.LOADING);let i=r.wrappedTileCoord,n=this.getTileGridForProjection(t),s=n.getTileCoordExtent(i),c=i[0],l=n.getResolution(c);G(s,-l,s);let a=this.tileGrid,d=a.getExtent();d&&W(s,d,s);let h=a.getZForResolution(l,this.zDirection);a.forEachTileCoord(s,h,u=>{let f=this.tileUrlFunction(u,e,t);this.sourceTiles_[f]||(this.sourceTiles_[f]=new this.tileClass(u,f?m.IDLE:m.EMPTY,f,this.format_,this.tileLoadFunction));let g=this.sourceTiles_[f];r.sourceTiles.push(g),this.tileKeysBySourceTileUrl_[f]||(this.tileKeysBySourceTileUrl_[f]=[]),this.tileKeysBySourceTileUrl_[f].push(r.getKey());let w=g.getState();if(w<m.LOADED){let p=F=>{this.handleTileChange(F);let y=g.getState();if(y===m.LOADED||y===m.ERROR){let x=g.getKey();x in r.errorTileKeys?g.getState()===m.LOADED&&delete r.errorTileKeys[x]:r.loadingSourceTiles--,y===m.ERROR?r.errorTileKeys[x]=!0:g.removeEventListener(re.CHANGE,p),r.loadingSourceTiles===0&&r.setState(De(r.errorTileKeys)?m.LOADED:m.ERROR)}};g.addEventListener(re.CHANGE,p),r.loadingSourceTiles++}w===m.IDLE&&(g.extent=a.getTileCoordExtent(u),g.projection=t,g.resolution=a.getResolution(u[0]),g.load())}),r.loadingSourceTiles||r.setState(r.sourceTiles.some(u=>u.getState()===m.ERROR)?m.ERROR:m.LOADED)}return r.sourceTiles}removeSourceTiles(e){let t=e.getKey(),r=e.sourceTiles;for(let i=0,n=r.length;i<n;++i){let s=r[i].getTileUrl();if(!this.tileKeysBySourceTileUrl_[s])return;let c=this.tileKeysBySourceTileUrl_[s].indexOf(t);c!==-1&&(this.tileKeysBySourceTileUrl_[s].splice(c,1),this.tileKeysBySourceTileUrl_[s].length===0&&(delete this.tileKeysBySourceTileUrl_[s],delete this.sourceTiles_[s]))}}getTile(e,t,r,i,n){let s=[e,t,r],c=this.getTileCoordForTileUrlFunction(s,n),l=this.getTileGrid().getExtent(),a=this.getTileGridForProjection(n);if(c&&l){let u=a.getTileCoordExtent(c);G(u,-a.getResolution(e),u),O(l,u)||(c=null)}let d=!0;if(c!==null){let u=this.tileGrid,f=a.getResolution(e),g=u.getZForResolution(f,1),w=a.getTileCoordExtent(c);G(w,-f,w),u.forEachTileCoord(w,g,p=>{d=d&&!this.tileUrlFunction(p,i,n)})}let h=new pt(s,d?m.EMPTY:m.IDLE,c,this.getSourceTiles.bind(this,i,n),this.removeSourceTiles.bind(this));return h.key=this.getKey(),h}getTileGridForProjection(e){let t=e.getCode(),r=this.tileGrids_[t];if(!r){let i=this.getProjection();X(i===null||be(i,e),"A VectorTile source can only be rendered if it has a projection compatible with the view projection.");let n=this.tileGrid,s=n.getResolutions().slice(),c=s.map(function(d,h){return n.getOrigin(h)}),l=s.map(function(d,h){return n.getTileSize(h)}),a=43;for(let d=s.length;d<a;++d)s.push(s[d-1]/2),c.push(c[d-1]),l.push(l[d-1]);r=new We({extent:n.getExtent(),origins:c,resolutions:s,tileSizes:l}),this.tileGrids_[t]=r}return r}getTilePixelRatio(e){return e}getTilePixelSize(e,t,r){let i=this.getTileGridForProjection(r),n=Y(i.getTileSize(e),this.tmpSize);return[Math.round(n[0]*t),Math.round(n[1]*t)]}setOverlaps(e){this.overlaps_=e,this.changed()}},ui=ge;function zt(o,e){o.setLoader(function(t,r,i){st(e,o.getFormat(),t,r,i,o.onLoad.bind(o),o.onError.bind(o))})}export{J as a,ht as b,Ar as c,ui as d,Gr as e};
