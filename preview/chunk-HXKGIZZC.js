import{b as M}from"./chunk-VGNHCWFP.js";import{a as m}from"./chunk-RLG4KX5E.js";import{B as T,ab as E,fb as g,h as f,hb as p,k as _,kb as x,lc as b,q as C,w as u,z as d}from"./chunk-XXB2L3KO.js";import{a as v}from"./chunk-S7COXUW4.js";var P={SELECT:"select"},F=class extends C{constructor(e,t,s,r){super(e),this.selected=t,this.deselected=s,this.mapBrowserEvent=r}},y={},L=class l extends E{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.boundAddFeature_=this.addFeature_.bind(this),this.boundRemoveFeature_=this.removeFeature_.bind(this),this.condition_=e.condition?e.condition:p,this.addCondition_=e.addCondition?e.addCondition:g,this.removeCondition_=e.removeCondition?e.removeCondition:g,this.toggleCondition_=e.toggleCondition?e.toggleCondition:x,this.multi_=e.multi?e.multi:!1,this.filter_=e.filter?e.filter:_,this.hitTolerance_=e.hitTolerance?e.hitTolerance:0,this.style_=e.style!==void 0?e.style:R(),this.features_=e.features||new T;let t;if(e.layers)if(typeof e.layers=="function")t=e.layers;else{let s=e.layers;t=function(r){return s.includes(r)}}else t=_;this.layerFilter_=t,this.featureLayerAssociation_={}}addFeatureLayerAssociation_(e,t){this.featureLayerAssociation_[d(e)]=t}getFeatures(){return this.features_}getHitTolerance(){return this.hitTolerance_}getLayer(e){return this.featureLayerAssociation_[d(e)]}setHitTolerance(e){this.hitTolerance_=e}setMap(e){this.getMap()&&this.style_&&this.features_.forEach(this.restorePreviousStyle_.bind(this)),super.setMap(e),e?(this.features_.addEventListener(u.ADD,this.boundAddFeature_),this.features_.addEventListener(u.REMOVE,this.boundRemoveFeature_),this.style_&&this.features_.forEach(this.applySelectedStyle_.bind(this))):(this.features_.removeEventListener(u.ADD,this.boundAddFeature_),this.features_.removeEventListener(u.REMOVE,this.boundRemoveFeature_))}addFeature_(e){let t=e.element;if(this.style_&&this.applySelectedStyle_(t),!this.getLayer(t)){let s=this.getMap().getAllLayers().find(function(r){if(r instanceof M&&r.getSource()&&r.getSource().hasFeature(t))return r});s&&this.addFeatureLayerAssociation_(t,s)}}removeFeature_(e){this.style_&&this.restorePreviousStyle_(e.element)}getStyle(){return this.style_}applySelectedStyle_(e){let t=d(e);t in y||(y[t]=e.getStyle()),e.setStyle(this.style_)}restorePreviousStyle_(e){let t=this.getMap().getInteractions().getArray();for(let r=t.length-1;r>=0;--r){let h=t[r];if(h!==this&&h instanceof l&&h.getStyle()&&h.getFeatures().getArray().lastIndexOf(e)!==-1){e.setStyle(h.getStyle());return}}let s=d(e);e.setStyle(y[s]),delete y[s]}removeFeatureLayerAssociation_(e){delete this.featureLayerAssociation_[d(e)]}handleEvent(e){if(!this.condition_(e))return!0;let t=this.addCondition_(e),s=this.removeCondition_(e),r=this.toggleCondition_(e),h=!t&&!s&&!r,S=e.map,a=this.getFeatures(),c=[],n=[];if(h){v(this.featureLayerAssociation_),S.forEachFeatureAtPixel(e.pixel,(i,o)=>{if(!(!(i instanceof m)||!this.filter_(i,o)))return this.addFeatureLayerAssociation_(i,o),n.push(i),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let i=a.getLength()-1;i>=0;--i){let o=a.item(i),A=n.indexOf(o);A>-1?n.splice(A,1):(a.remove(o),c.push(o))}n.length!==0&&a.extend(n)}else{S.forEachFeatureAtPixel(e.pixel,(i,o)=>{if(!(!(i instanceof m)||!this.filter_(i,o)))return(t||r)&&!a.getArray().includes(i)?(this.addFeatureLayerAssociation_(i,o),n.push(i)):(s||r)&&a.getArray().includes(i)&&(c.push(i),this.removeFeatureLayerAssociation_(i)),!this.multi_},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(let i=c.length-1;i>=0;--i)a.remove(c[i]);a.extend(n)}return(n.length>0||c.length>0)&&this.dispatchEvent(new F(P.SELECT,n,c,e)),!0}};function R(){let l=b();return f(l.Polygon,l.LineString),f(l.GeometryCollection,l.LineString),function(e){return e.getGeometry()?l[e.getGeometry().getType()]:null}}var J=L;export{J as a};
