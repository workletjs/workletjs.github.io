import{b as g}from"./chunk-H6QH7D4S.js";import{c as _}from"./chunk-XZFPOBQN.js";import{a as h}from"./chunk-5RIY7GGT.js";import{D as T,Ma as p,db as w,lc as x,nb as C,q as v,wa as D}from"./chunk-BZGSA6SQ.js";import{D as P}from"./chunk-S7COXUW4.js";import{H as I,da as S,ka as d,la as O,ma as f,o as c}from"./chunk-QFWXP63S.js";var X={EXTENTCHANGED:"extentchanged"},m=class extends v{constructor(e){super(X.EXTENTCHANGED),this.extent=e}},y=class extends C{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.condition_=e.condition?e.condition:w,this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,e||(e={}),this.extentOverlay_=new g({source:new _({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.boxStyle?e.boxStyle:A(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new g({source:new _({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.pointerStyle?e.pointerStyle:G(),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.extent&&this.setExtent(e.extent)}snapToVertex_(e,t){let s=t.getCoordinateFromPixelInternal(e),r=function(a,l){return f(s,a)-f(s,l)},i=this.getExtentInternal();if(i){let a=N(i);a.sort(r);let l=a[0],o=S(s,l),u=t.getPixelFromCoordinateInternal(o);if(O(e,u)<=this.pixelTolerance_){let V=t.getPixelFromCoordinateInternal(l[0]),U=t.getPixelFromCoordinateInternal(l[1]),E=d(u,V),F=d(u,U),q=Math.sqrt(Math.min(E,F));return this.snappedToVertex_=q<=this.pixelTolerance_,this.snappedToVertex_&&(o=E>F?l[1]:l[0]),o}}return null}handlePointerMove_(e){let t=e.pixel,s=e.map,r=this.snapToVertex_(t,s);r||(r=s.getCoordinateFromPixelInternal(t)),this.createOrUpdatePointerFeature_(r)}createOrUpdateExtentFeature_(e){let t=this.extentFeature_;return t?e?t.setGeometry(p(e)):t.setGeometry(void 0):(e?t=new h(p(e)):t=new h({}),this.extentFeature_=t,this.extentOverlay_.getSource().addFeature(t)),t}createOrUpdatePointerFeature_(e){let t=this.vertexFeature_;return t?t.getGeometry().setCoordinates(e):(t=new h(new D(e)),this.vertexFeature_=t,this.vertexOverlay_.getSource().addFeature(t)),t}handleEvent(e){return!e.originalEvent||!this.condition_(e)?!0:(e.type==T.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),super.handleEvent(e),!1)}handleDownEvent(e){let t=e.pixel,s=e.map,r=this.getExtentInternal(),i=this.snapToVertex_(t,s),a=function(l){let o=null,u=null;return l[0]==r[0]?o=r[2]:l[0]==r[2]&&(o=r[0]),l[1]==r[1]?u=r[3]:l[1]==r[3]&&(u=r[1]),o!==null&&u!==null?[o,u]:null};if(i&&r){let l=i[0]==r[0]||i[0]==r[2]?i[0]:null,o=i[1]==r[1]||i[1]==r[3]?i[1]:null;l!==null&&o!==null?this.pointerHandler_=H(a(i)):l!==null?this.pointerHandler_=M(a([l,r[1]]),a([l,r[3]])):o!==null&&(this.pointerHandler_=M(a([r[0],o]),a([r[2],o])))}else i=s.getCoordinateFromPixelInternal(t),this.setExtent([i[0],i[1],i[0],i[1]]),this.pointerHandler_=H(i);return!0}handleDragEvent(e){if(this.pointerHandler_){let t=e.coordinate;this.setExtent(this.pointerHandler_(t)),this.createOrUpdatePointerFeature_(t)}}handleUpEvent(e){this.pointerHandler_=null;let t=this.getExtentInternal();return(!t||I(t)===0)&&this.setExtent(null),!1}setMap(e){this.extentOverlay_.setMap(e),this.vertexOverlay_.setMap(e),super.setMap(e)}getExtent(){return P(this.getExtentInternal(),this.getMap().getView().getProjection())}getExtentInternal(){return this.extent_}setExtent(e){this.extent_=e||null,this.createOrUpdateExtentFeature_(e),this.dispatchEvent(new m(this.extent_))}};function A(){let n=x();return function(e,t){return n.Polygon}}function G(){let n=x();return function(e,t){return n.Point}}function H(n){return function(e){return c([n,e])}}function M(n,e){return n[0]==e[0]?function(t){return c([n,[t[0],e[1]]])}:n[1]==e[1]?function(t){return c([n,[e[0],t[1]]])}:null}function N(n){return[[[n[0],n[1]],[n[0],n[3]]],[[n[0],n[3]],[n[2],n[3]]],[[n[2],n[3]],[n[2],n[1]]],[[n[2],n[1]],[n[0],n[1]]]]}var B=y;export{B as a};
