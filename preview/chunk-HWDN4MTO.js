import{H as ge,K as fe,P as be,Q as G,R as re,V as D,Wc as Be,_ as me,ca as ke,d as Oe,f as Ke,fa as qe,ga as We,gb as Ve,ha as S,ia as xe,j as Ye,ja as L,ma as ce,pa as He,q as De,w as z,wa as Qe,y as Le,z as F}from"./chunk-5QSZOAPF.js";import{E as le,f as Ue,m as se,u as Ne}from"./chunk-XVBTN5DM.js";import{A as ve,B as Ie,C as ne,D as oe,F as de,G as Xe,O as Ge,Y as k,Z as q,f as te,j as Ze,k as ie,o as Ae,y as je}from"./chunk-WEL5MCWD.js";var b=[0,0,0],v=5,Te=class{constructor(e){this.minZoom=e.minZoom!==void 0?e.minZoom:0,this.resolutions_=e.resolutions,D(Ye(this.resolutions_,(n,o)=>o-n,!0),"`resolutions` must be sorted in descending order");let t;if(!e.origins){for(let n=0,o=this.resolutions_.length-1;n<o;++n)if(!t)t=this.resolutions_[n]/this.resolutions_[n+1];else if(this.resolutions_[n]/this.resolutions_[n+1]!==t){t=void 0;break}}this.zoomFactor_=t,this.maxZoom=this.resolutions_.length-1,this.origin_=e.origin!==void 0?e.origin:null,this.origins_=null,e.origins!==void 0&&(this.origins_=e.origins,D(this.origins_.length==this.resolutions_.length,"Number of `origins` and `resolutions` must be equal"));let i=e.extent;i!==void 0&&!this.origin_&&!this.origins_&&(this.origin_=oe(i)),D(!this.origin_&&this.origins_||this.origin_&&!this.origins_,"Either `origin` or `origins` must be configured, never both"),this.tileSizes_=null,e.tileSizes!==void 0&&(this.tileSizes_=e.tileSizes,D(this.tileSizes_.length==this.resolutions_.length,"Number of `tileSizes` and `resolutions` must be equal")),this.tileSize_=e.tileSize!==void 0?e.tileSize:this.tileSizes_?null:256,D(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,"Either `tileSize` or `tileSizes` must be configured, never both"),this.extent_=i!==void 0?i:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],e.sizes!==void 0?this.fullTileRanges_=e.sizes.map((n,o)=>{let r=new re(Math.min(0,n[0]),Math.max(n[0]-1,-1),Math.min(0,n[1]),Math.max(n[1]-1,-1));if(i){let s=this.getTileRangeForExtentAndZ(i,o);r.minX=Math.max(s.minX,r.minX),r.maxX=Math.min(s.maxX,r.maxX),r.minY=Math.max(s.minY,r.minY),r.maxY=Math.min(s.maxY,r.maxY)}return r}):i&&this.calculateTileRanges_(i)}forEachTileCoord(e,t,i){let n=this.getTileRangeForExtentAndZ(e,t);for(let o=n.minX,r=n.maxX;o<=r;++o)for(let s=n.minY,a=n.maxY;s<=a;++s)i([t,o,s])}forEachTileCoordParentTileRange(e,t,i,n){let o,r,s,a=null,c=e[0]-1;for(this.zoomFactor_===2?(r=e[1],s=e[2]):a=this.getTileCoordExtent(e,n);c>=this.minZoom;){if(r!==void 0&&s!==void 0?(r=Math.floor(r/2),s=Math.floor(s/2),o=G(r,r,s,s,i)):o=this.getTileRangeForExtentAndZ(a,c,i),t(c,o))return!0;--c}return!1}getExtent(){return this.extent_}getMaxZoom(){return this.maxZoom}getMinZoom(){return this.minZoom}getOrigin(e){return this.origin_?this.origin_:this.origins_[e]}getResolution(e){return this.resolutions_[e]}getResolutions(){return this.resolutions_}getTileCoordChildTileRange(e,t,i){if(e[0]<this.maxZoom){if(this.zoomFactor_===2){let o=e[1]*2,r=e[2]*2;return G(o,o+1,r,r+1,t)}let n=this.getTileCoordExtent(e,i||this.tmpExtent_);return this.getTileRangeForExtentAndZ(n,e[0]+1,t)}return null}getTileRangeForTileCoordAndZ(e,t,i){if(t>this.maxZoom||t<this.minZoom)return null;let n=e[0],o=e[1],r=e[2];if(t===n)return G(o,r,o,r,i);if(this.zoomFactor_){let a=Math.pow(this.zoomFactor_,t-n),c=Math.floor(o*a),l=Math.floor(r*a);if(t<n)return G(c,c,l,l,i);let u=Math.floor(a*(o+1))-1,d=Math.floor(a*(r+1))-1;return G(c,u,l,d,i)}let s=this.getTileCoordExtent(e,this.tmpExtent_);return this.getTileRangeForExtentAndZ(s,t,i)}getTileRangeForExtentAndZ(e,t,i){this.getTileCoordForXYAndZ_(e[0],e[3],t,!1,b);let n=b[1],o=b[2];this.getTileCoordForXYAndZ_(e[2],e[1],t,!0,b);let r=b[1],s=b[2];return G(n,r,o,s,i)}getTileCoordCenter(e){let t=this.getOrigin(e[0]),i=this.getResolution(e[0]),n=S(this.getTileSize(e[0]),this.tmpSize_);return[t[0]+(e[1]+.5)*n[0]*i,t[1]-(e[2]+.5)*n[1]*i]}getTileCoordExtent(e,t){let i=this.getOrigin(e[0]),n=this.getResolution(e[0]),o=S(this.getTileSize(e[0]),this.tmpSize_),r=i[0]+e[1]*o[0]*n,s=i[1]-(e[2]+1)*o[1]*n,a=r+o[0]*n,c=s+o[1]*n;return ie(r,s,a,c,t)}getTileCoordForCoordAndResolution(e,t,i){return this.getTileCoordForXYAndResolution_(e[0],e[1],t,!1,i)}getTileCoordForXYAndResolution_(e,t,i,n,o){let r=this.getZForResolution(i),s=i/this.getResolution(r),a=this.getOrigin(r),c=S(this.getTileSize(r),this.tmpSize_),l=s*(e-a[0])/i/c[0],u=s*(a[1]-t)/i/c[1];return n?(l=q(l,v)-1,u=q(u,v)-1):(l=k(l,v),u=k(u,v)),L(r,l,u,o)}getTileCoordForXYAndZ_(e,t,i,n,o){let r=this.getOrigin(i),s=this.getResolution(i),a=S(this.getTileSize(i),this.tmpSize_),c=(e-r[0])/s/a[0],l=(r[1]-t)/s/a[1];return n?(c=q(c,v)-1,l=q(l,v)-1):(c=k(c,v),l=k(l,v)),L(i,c,l,o)}getTileCoordForCoordAndZ(e,t,i){return this.getTileCoordForXYAndZ_(e[0],e[1],t,!1,i)}getTileCoordResolution(e){return this.resolutions_[e[0]]}getTileSize(e){return this.tileSize_?this.tileSize_:this.tileSizes_[e]}getFullTileRange(e){return this.fullTileRanges_?this.fullTileRanges_[e]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,e):null}getZForResolution(e,t){let i=Ke(this.resolutions_,e,t||0);return Ge(i,this.minZoom,this.maxZoom)}tileCoordIntersectsViewport(e,t){return Ve(t,0,t.length,2,this.getTileCoordExtent(e))}calculateTileRanges_(e){let t=this.resolutions_.length,i=new Array(t);for(let n=this.minZoom;n<t;++n)i[n]=this.getTileRangeForExtentAndZ(e,n);this.fullTileRanges_=i}},W=Te;var pe=class extends W{constructor(e){super({extent:e.extent,origin:e.origin,origins:e.origins,resolutions:e.resolutions,tileSize:e.tileSize,tileSizes:e.tileSizes,sizes:e.sizes}),this.matrixIds_=e.matrixIds}getMatrixId(e){return this.matrixIds_[e]}getMatrixIds(){return this.matrixIds_}},Et=pe;function Je(h){let e=h.getDefaultTileGrid();return e||(e=ut(h),h.setDefaultTileGrid(e)),e}function $e(h,e,t){let i=e[0],n=h.getTileCoordCenter(e),o=tt(t);if(!te(o,n)){let r=de(o),s=Math.ceil((o[0]-n[0])/r);return n[0]+=r*s,h.getTileCoordForCoordAndZ(n,i)}return e}function ht(h,e,t,i){i=i!==void 0?i:"top-left";let n=et(h,e,t);return new W({extent:h,origin:je(h,i),resolutions:n,tileSize:t})}function At(h){let e=h||{},t=e.extent||se("EPSG:3857").getExtent(),i={extent:t,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:et(t,e.maxZoom,e.tileSize,e.maxResolution)};return new W(i)}function et(h,e,t,i){e=e!==void 0?e:42,t=S(t!==void 0?t:256);let n=Ie(h),o=de(h);i=i>0?i:Math.max(o/t[0],n/t[1]);let r=e+1,s=new Array(r);for(let a=0;a<r;++a)s[a]=i/Math.pow(2,a);return s}function ut(h,e,t,i){let n=tt(h);return ht(n,e,t,i)}function tt(h){h=se(h);let e=h.getExtent();if(!e){let t=180*Ue.degrees/h.getMetersPerUnit();e=ie(-t,-t,t,t)}return e}function _e(h,e,t){if(!(t in h))return h[t]=new Set([e]),!0;let i=h[t],n=i.has(e);return n||i.add(e),!n}function dt(h,e,t){let i=h[t];return i?i.delete(e):!1}function it(h,e){let t=h.layerStatesArray[h.layerIndex];t.extent&&(e=ne(e,le(t.extent,h.viewState.projection)));let i=t.layer.getRenderSource();if(!i.getWrapX()){let n=i.getTileGridForProjection(h.viewState.projection).getExtent();n&&(e=ne(e,n))}return e}var Re=class extends Qe{constructor(e,t){super(e),t=t||{},this.extentChanged=!0,this.renderComplete=!1,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedTiles=[],this.renderedSourceKey_,this.renderedSourceRevision_,this.tempExtent=Ze(),this.tempTileRange_=new re(0,0,0,0),this.tempTileCoord_=L(0,0,0);let i=t.cacheSize!==void 0?t.cacheSize:512;this.tileCache_=new xe(i),this.sourceTileCache_=null,this.maxStaleKeys=i*.5}getTileCache(){return this.tileCache_}getSourceTileCache(){return this.sourceTileCache_||(this.sourceTileCache_=new xe(512)),this.sourceTileCache_}getOrCreateTile(e,t,i,n){let o=this.tileCache_,s=this.getLayer().getSource(),a=ce(s,s.getKey(),e,t,i),c;if(o.containsKey(a))c=o.get(a);else{let l=n.viewState.projection,u=s.getProjection();if(c=s.getTile(e,t,i,n.pixelRatio,l,!u||Ne(u,l)?void 0:this.getSourceTileCache()),!c)return null;o.set(a,c)}return c}getTile(e,t,i,n){let o=this.getOrCreateTile(e,t,i,n);return o||null}getData(e){let t=this.frameState;if(!t)return null;let i=this.getLayer(),n=me(t.pixelToCoordinateTransform,e.slice()),o=i.getExtent();if(o&&!te(o,n))return null;let r=t.viewState,s=i.getRenderSource(),a=s.getTileGridForProjection(r.projection),c=s.getTilePixelRatio(t.pixelRatio);for(let l=a.getZForResolution(r.resolution);l>=a.getMinZoom();--l){let u=a.getTileCoordForCoordAndZ(n,l),d=this.getTile(l,u[1],u[2],t);if(!d||d.getState()!==z.LOADED)continue;let f=a.getOrigin(l),x=S(a.getTileSize(l)),P=a.getResolution(l),g;if(d instanceof be||d instanceof qe)g=d.getImage();else if(d instanceof fe){if(g=ge(d.getData()),!g)continue}else continue;let y=Math.floor(c*((n[0]-f[0])/P-u[1]*x[0])),I=Math.floor(c*((f[1]-n[1])/P-u[2]*x[1])),C=Math.round(c*s.getGutterForProjection(r.projection));return this.getImageData(g,y+C,I+C)}return null}prepareFrame(e){this.renderedProjection?e.viewState.projection!==this.renderedProjection&&(this.tileCache_.clear(),this.renderedProjection=e.viewState.projection):this.renderedProjection=e.viewState.projection;let t=this.getLayer().getSource();if(!t)return!1;let i=t.getRevision();return this.renderedSourceRevision_?this.renderedSourceRevision_!==i&&(this.renderedSourceRevision_=i,this.renderedSourceKey_===t.getKey()&&(this.tileCache_.clear(),this.sourceTileCache_?.clear())):this.renderedSourceRevision_=i,!0}enqueueTilesForNextExtent(){return!0}enqueueTiles(e,t,i,n,o){let r=e.viewState,s=this.getLayer(),a=s.getRenderSource(),c=a.getTileGridForProjection(r.projection),l=F(a);l in e.wantedTiles||(e.wantedTiles[l]={});let u=e.wantedTiles[l],d=s.getMapInternal(),f=Math.max(i-o,c.getMinZoom(),c.getZForResolution(Math.min(s.getMaxResolution(),d?d.getView().getResolutionForZoom(Math.max(s.getMinZoom(),0)):c.getResolution(0)),a.zDirection)),x=r.rotation,P=x?ve(r.center,r.resolution,x,e.size):void 0;for(let g=i;g>=f;--g){let y=c.getTileRangeForExtentAndZ(t,g,this.tempTileRange_),I=c.getResolution(g);for(let C=y.minX;C<=y.maxX;++C)for(let w=y.minY;w<=y.maxY;++w){if(x&&!c.tileCoordIntersectsViewport([g,C,w],P))continue;let M=this.getTile(g,C,w,e);if(!M||!_e(n,M,g))continue;let T=M.getKey();if(u[T]=!0,M.getState()===z.IDLE&&!e.tileQueue.isKeyQueued(T)){let U=L(g,C,w,this.tempTileCoord_);e.tileQueue.enqueue([M,l,c.getTileCoordCenter(U),I])}}}}findStaleTile_(e,t){let i=this.tileCache_,n=e[0],o=e[1],r=e[2],s=this.getStaleKeys();for(let a=0;a<s.length;++a){let c=ce(this.getLayer().getSource(),s[a],n,o,r);if(i.containsKey(c)){let l=i.peek(c);if(l.getState()===z.LOADED)return l.endTransition(F(this)),_e(t,l,n),!0}}return!1}findAltTiles_(e,t,i,n){let o=e.getTileRangeForTileCoordAndZ(t,i,this.tempTileRange_);if(!o)return!1;let r=!0,s=this.tileCache_,a=this.getLayer().getRenderSource(),c=a.getKey();for(let l=o.minX;l<=o.maxX;++l)for(let u=o.minY;u<=o.maxY;++u){let d=ce(a,c,i,l,u),f=!1;if(s.containsKey(d)){let x=s.peek(d);x.getState()===z.LOADED&&(_e(n,x,i),f=!0)}f||(r=!1)}return r}renderFrame(e,t){this.renderComplete=!0;let i=e.layerStatesArray[e.layerIndex],n=e.viewState,o=n.projection,r=n.resolution,s=n.center,a=e.pixelRatio,c=this.getLayer(),l=c.getSource(),u=l.getTileGridForProjection(o),d=u.getZForResolution(r,l.zDirection),f=u.getResolution(d),x=l.getKey();this.renderedSourceKey_?this.renderedSourceKey_!==x&&(this.prependStaleKey(this.renderedSourceKey_),this.renderedSourceKey_=x):this.renderedSourceKey_=x;let P=e.extent,g=l.getTilePixelRatio(a);this.prepareContainer(e,t);let y=this.context.canvas.width,I=this.context.canvas.height,C=i.extent&&le(i.extent,o);C&&(P=ne(P,le(i.extent,o)));let w=f*y/2/g,M=f*I/2/g,O=[s[0]-w,s[1]-M,s[0]+w,s[1]+M],T={};this.renderedTiles.length=0;let U=c.getPreload();if(e.nextExtent&&this.enqueueTilesForNextExtent()){let p=u.getZForResolution(n.nextResolution,l.zDirection),_=it(e,e.nextExtent);this.enqueueTiles(e,_,p,T,U)}let Ce=it(e,P);if(this.enqueueTiles(e,Ce,d,T,0),U>0&&setTimeout(()=>{this.enqueueTiles(e,Ce,d-1,T,U-1)},0),!(d in T))return this.container;let ye=F(this),ot=e.time;for(let p of T[d]){let _=p.getState();if(_===z.EMPTY)continue;let Z=p.tileCoord;if(_===z.LOADED&&p.getAlpha(ye,ot)===1){p.endTransition(ye);continue}if(_!==z.ERROR&&(this.renderComplete=!1),this.findStaleTile_(Z,T)){dt(T,p,d),e.animate=!0;continue}if(this.findAltTiles_(u,Z,d+1,T))continue;let Y=u.getMinZoom();for(let X=d-1;X>=Y&&!this.findAltTiles_(u,Z,X,T);--X);}let H=f/r*a/g,m=this.getRenderContext(e);ke(this.tempTransform,y/2,I/2,H,H,0,-y/2,-I/2),i.extent&&this.clipUnrotated(m,e,C),l.getInterpolate()||(m.imageSmoothingEnabled=!1),this.preRender(m,e);let Q=Object.keys(T).map(Number);Q.sort(Oe);let E,ae=[],Ee=[];for(let p=Q.length-1;p>=0;--p){let _=Q[p],Z=l.getTilePixelSize(_,a,o),K=u.getResolution(_)/f,Y=Z[0]*K*H,X=Z[1]*K*H,V=u.getTileCoordForCoordAndZ(oe(O),_),ze=u.getTileCoordExtent(V),B=me(this.tempTransform,[g*(ze[0]-O[0])/f,g*(O[3]-ze[3])/f]),rt=g*l.getGutterForProjection(o);for(let N of T[_]){if(N.getState()!==z.LOADED)continue;let Fe=N.tileCoord,Pe=V[1]-Fe[1],st=Math.round(B[0]-(Pe-1)*Y),we=V[2]-Fe[2],lt=Math.round(B[1]-(we-1)*X),A=Math.round(B[0]-Pe*Y),j=Math.round(B[1]-we*X),J=st-A,$=lt-j,Me=Q.length===1,ue=!1;E=[A,j,A+J,j,A+J,j+$,A,j+$];for(let ee=0,ct=ae.length;ee<ct;++ee)if(!Me&&_<Ee[ee]){let R=ae[ee];Xe([A,j,A+J,j+$],[R[0],R[3],R[4],R[7]])&&(ue||(m.save(),ue=!0),m.beginPath(),m.moveTo(E[0],E[1]),m.lineTo(E[2],E[3]),m.lineTo(E[4],E[5]),m.lineTo(E[6],E[7]),m.moveTo(R[6],R[7]),m.lineTo(R[4],R[5]),m.lineTo(R[2],R[3]),m.lineTo(R[0],R[1]),m.clip())}ae.push(E),Ee.push(_),this.drawTile(N,e,A,j,J,$,rt,Me),ue&&m.restore(),this.renderedTiles.unshift(N),this.updateUsedTiles(e.usedTiles,l,N)}}if(this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!Ae(this.renderedExtent_,O),this.renderedExtent_=O,this.renderedPixelRatio=a,this.postRender(this.context,e),i.extent&&m.restore(),m.imageSmoothingEnabled=!0,this.renderComplete){let p=(_,Z)=>{let he=F(l),K=Z.wantedTiles[he],Y=K?Object.keys(K).length:0;this.updateCacheSize(Y),this.tileCache_.expireCache(),this.sourceTileCache_?.expireCache()};e.postRenderFunctions.push(p)}return this.container}updateCacheSize(e){this.tileCache_.highWaterMark=Math.max(this.tileCache_.highWaterMark,e*2)}drawTile(e,t,i,n,o,r,s,a){let c;if(e instanceof fe){if(c=ge(e.getData()),!c)throw new Error("Rendering array data is not yet supported")}else c=this.getTileImage(e);if(!c)return;let l=this.getRenderContext(t),u=F(this),d=t.layerStatesArray[t.layerIndex],f=d.opacity*(a?e.getAlpha(u,t.time):1),x=f!==l.globalAlpha;x&&(l.save(),l.globalAlpha=f),l.drawImage(c,s,s,c.width-2*s,c.height-2*s,i,n,o,r),x&&l.restore(),f!==d.opacity?t.animate=!0:a&&e.endTransition(u)}getImage(){let e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}updateUsedTiles(e,t,i){let n=F(t);n in e||(e[n]={}),e[n][i.getKey()]=!0}},Wt=Re;var Qt={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"};var Se=class extends Be{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:e.projection,state:e.state,wrapX:e.wrapX,interpolate:e.interpolate}),this.on,this.once,this.un,this.tilePixelRatio_=e.tilePixelRatio!==void 0?e.tilePixelRatio:1,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:null;let t=[256,256];this.tileGrid&&S(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),t),this.tmpSize=[0,0],this.key_=e.key||F(this),this.tileOptions={transition:e.transition,interpolate:e.interpolate},this.zDirection=e.zDirection?e.zDirection:0}getGutterForProjection(e){return 0}getKey(){return this.key_}setKey(e){this.key_!==e&&(this.key_=e,this.changed())}getResolutions(e){let t=e?this.getTileGridForProjection(e):this.tileGrid;return t?t.getResolutions():null}getTile(e,t,i,n,o,r){return Le()}getTileGrid(){return this.tileGrid}getTileGridForProjection(e){return this.tileGrid?this.tileGrid:Je(e)}getTilePixelRatio(e){return this.tilePixelRatio_}getTilePixelSize(e,t,i){let n=this.getTileGridForProjection(i),o=this.getTilePixelRatio(t),r=S(n.getTileSize(e),this.tmpSize);return o==1?r:We(r,o,this.tmpSize)}getTileCoordForTileUrlFunction(e,t){let i=t!==void 0?t:this.getProjection(),n=t!==void 0?this.getTileGridForProjection(i):this.tileGrid||this.getTileGridForProjection(i);return this.getWrapX()&&i.isGlobal()&&(e=$e(n,e,i)),He(e,n)?e:null}clear(){}refresh(){this.clear(),super.refresh()}},nt=class extends De{constructor(e,t){super(e),this.tile=t}},ni=Se;export{Wt as a,Qt as b,W as c,Et as d,Je as e,$e as f,At as g,tt as h,nt as i,ni as j};
