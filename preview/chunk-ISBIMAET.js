import{a as o,bb as E,k as _,q as g,s as a,u as m}from"./chunk-CQBO4I3Y.js";import{m as A,z as y}from"./chunk-7JDMKNL2.js";var T={ADD_FEATURES:"addfeatures"},u=class extends g{constructor(t,e,r,i){super(t),this.features=r,this.file=e,this.projection=i}},c=class extends E{constructor(t){t=t||{},super({handleEvent:_}),this.on,this.once,this.un,this.readAsBuffer_=!1,this.formats_=[];let e=t.formatConstructors?t.formatConstructors:[];for(let r=0,i=e.length;r<i;++r){let s=e[r];typeof s=="function"&&(s=new s),this.formats_.push(s),this.readAsBuffer_=this.readAsBuffer_||s.getType()==="arraybuffer"}this.projection_=t.projection?A(t.projection):null,this.dropListenKeys_=null,this.source_=t.source||null,this.target=t.target?t.target:null}handleResult_(t,e){let r=e.target.result,i=this.getMap(),s=this.projection_;s||(s=y(),s||(s=i.getView().getProjection()));let n,l=this.formats_;for(let f=0,L=l.length;f<L;++f){let d=l[f],p=r;this.readAsBuffer_&&d.getType()!=="arraybuffer"&&(n===void 0&&(n=new TextDecoder().decode(r)),p=n);let h=this.tryReadFeatures_(d,p,{featureProjection:s});if(h&&h.length>0){this.source_&&(this.source_.clear(),this.source_.addFeatures(h)),this.dispatchEvent(new u(T.ADD_FEATURES,t,h,s));break}}}registerListeners_(){let t=this.getMap();if(t){let e=this.target?this.target:t.getViewport();this.dropListenKeys_=[a(e,o.DROP,this.handleDrop,this),a(e,o.DRAGENTER,this.handleStop,this),a(e,o.DRAGOVER,this.handleStop,this),a(e,o.DROP,this.handleStop,this)]}}setActive(t){!this.getActive()&&t&&this.registerListeners_(),this.getActive()&&!t&&this.unregisterListeners_(),super.setActive(t)}setMap(t){this.unregisterListeners_(),super.setMap(t),this.getActive()&&this.registerListeners_()}tryReadFeatures_(t,e,r){try{return t.readFeatures(e,r)}catch(i){return null}}unregisterListeners_(){this.dropListenKeys_&&(this.dropListenKeys_.forEach(m),this.dropListenKeys_=null)}handleDrop(t){let e=t.dataTransfer.files;for(let r=0,i=e.length;r<i;++r){let s=e.item(r),n=new FileReader;n.addEventListener(o.LOAD,this.handleResult_.bind(this,s)),this.readAsBuffer_?n.readAsArrayBuffer(s):n.readAsText(s)}}handleStop(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"}},F=c;export{F as a};
