import{b as p}from"./chunk-A4IKBYL2.js";import{c as m}from"./chunk-IPMMTWYM.js";import{a as h}from"./chunk-XEW5TN3J.js";import{D as H,Ma as _,db as V,kc as x,nb as w,q as D,wa as P}from"./chunk-HGXUMOE5.js";import{D as I}from"./chunk-L76X3E7P.js";import{b as c,da as T,f as d,ka as f,la as C,ma as g,u as S}from"./chunk-WEL5MCWD.js";var U={EXTENTCHANGED:"extentchanged"},y=class extends D{constructor(e){super(U.EXTENTCHANGED),this.extent=e}},F=class extends w{constructor(e){e=e||{},super(e),this.on,this.once,this.un,this.condition_=e.condition?e.condition:V,this.createCondition_=e.createCondition||this.condition_,this.drag_=e.drag||!1,this.extent_=null,this.pointerHandler_=null,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.extentFeature_=null,this.vertexFeature_=null,e||(e={}),this.extentOverlay_=new p({source:new m({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.boxStyle?e.boxStyle:A(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.vertexOverlay_=new p({source:new m({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.pointerStyle?e.pointerStyle:G(),updateWhileAnimating:!0,updateWhileInteracting:!0}),e.extent&&this.setExtent(e.extent)}snapToVertex_(e,t){let a=t.getCoordinateFromPixelInternal(e),r=function(o,s){return g(a,o)-g(a,s)},i=this.getExtentInternal();if(i){let o=W(i);o.sort(r);let s=o[0],l=T(a,s),u=t.getPixelFromCoordinateInternal(l);if(C(e,u)<=this.pixelTolerance_){let q=t.getPixelFromCoordinateInternal(s[0]),X=t.getPixelFromCoordinateInternal(s[1]),E=f(u,q),v=f(u,X),b=Math.sqrt(Math.min(E,v));return this.snappedToVertex_=b<=this.pixelTolerance_,this.snappedToVertex_&&(l=E>v?s[1]:s[0]),l}}return null}handlePointerMove_(e){let t=e.pixel,a=e.map,r=this.drag_&&d(this.extent_,e.coordinate),i=this.snapToVertex_(t,a);return!i&&this.createCondition_(e)&&!r&&(i=a.getCoordinateFromPixelInternal(t)),r&&!i?this.getMap().getViewport().classList.add("ol-grab"):this.getMap().getViewport().classList.remove("ol-grab"),i?(this.updatePointerFeature_(i),!0):(this.noVertexFeature_(),!1)}createOrUpdateExtentFeature_(e){let t=this.extentFeature_;return t?e?t.setGeometry(_(e)):t.setGeometry(void 0):(e?t=new h(_(e)):t=new h({}),this.extentFeature_=t,this.extentOverlay_.getSource().addFeature(t)),t}updatePointerFeature_(e,t=!0){let a=this.vertexFeature_;return t&&!a&&(a=new h(new P(e)),this.vertexFeature_=a,this.vertexOverlay_.getSource().addFeature(a)),a&&a.getGeometry().setCoordinates(e),a}noVertexFeature_(){this.vertexFeature_&&(this.vertexOverlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}handleEvent(e){if(!e.originalEvent||!this.condition_(e))return this.noVertexFeature_(),!0;let t=this.handlingDownUpSequence;return e.type==H.POINTERMOVE&&!this.handlingDownUpSequence&&(t=this.handlePointerMove_(e)),super.handleEvent(e),!t}handleDownEvent(e){let t=e.pixel,a=e.map,r=this.getExtentInternal(),i=this.snapToVertex_(t,a),o=function(s){let l=null,u=null;return s[0]==r[0]?l=r[2]:s[0]==r[2]&&(l=r[0]),s[1]==r[1]?u=r[3]:s[1]==r[3]&&(u=r[1]),l!==null&&u!==null?[l,u]:null};if(i&&r){let s=i[0]==r[0]||i[0]==r[2]?i[0]:null,l=i[1]==r[1]||i[1]==r[3]?i[1]:null;s!==null&&l!==null?this.pointerHandler_=M(o(i)):s!==null?this.pointerHandler_=O(o([s,r[1]]),o([s,r[3]])):l!==null&&(this.pointerHandler_=O(o([r[0],l]),o([r[2],l])))}else{i=a.getCoordinateFromPixelInternal(t);let s=!1;this.drag_&&d(r,i)&&(this.pointerHandler_=N(r,i),s=!0),!s&&this.createCondition_(e)&&(this.setExtent([i[0],i[1],i[0],i[1]]),this.pointerHandler_=M(i))}return!!this.pointerHandler_}handleDragEvent(e){if(this.pointerHandler_){let t=e.coordinate;this.setExtent(this.pointerHandler_(t)),this.updatePointerFeature_(t,!1)}}handleUpEvent(e){this.pointerHandler_=null;let t=this.getExtentInternal();return(!t||S(t)===0)&&this.setExtent(null),!1}setMap(e){this.extentOverlay_.setMap(e),this.vertexOverlay_.setMap(e),super.setMap(e)}getExtent(){return I(this.getExtentInternal(),this.getMap().getView().getProjection())}getExtentInternal(){return this.extent_}setExtent(e){this.extent_=e||null,this.createOrUpdateExtentFeature_(e),this.dispatchEvent(new y(this.extent_))}};function A(){let n=x();return function(e,t){return n.Polygon}}function G(){let n=x();return function(e,t){return n.Point}}function M(n){return function(e){return c([n,e])}}function O(n,e){return n[0]==e[0]?function(t){return c([n,[t[0],e[1]]])}:n[1]==e[1]?function(t){return c([n,[e[0],t[1]]])}:null}function N(n,e){return function(t){let a=t[0]-e[0],r=t[1]-e[1];return[n[0]+a,n[1]+r,n[2]+a,n[3]+r]}}function W(n){return[[[n[0],n[1]],[n[0],n[3]]],[[n[0],n[3]],[n[2],n[3]]],[[n[2],n[3]],[n[2],n[1]]],[[n[2],n[1]],[n[0],n[1]]]]}var te=F;export{te as a};
