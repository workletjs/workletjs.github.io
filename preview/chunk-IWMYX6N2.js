import{a as ss,b as ns}from"./chunk-VC5RK7XT.js";import{$b as vt,A as ui,Aa as ji,Ca as Hi,Da as zi,Fa as Ji,Ha as qi,Ja as Re,K as gi,Ka as Vi,La as le,O as gt,R as bi,S as yt,Sb as St,Ta as Gt,Tb as Qi,Tc as is,Ub as K,Vb as he,W as xt,Wb as z,Xb as J,Y as Ct,Yb as ae,Z as ee,Zb as ce,_ as Di,_b as de,a as zt,ac as Wt,bc as rt,c as hi,ca as $,cc as fe,d as mt,da as wi,dc as $i,e as ai,ea as Pi,ec as Te,fa as Fi,fc as ts,g as ci,ga as Ai,gc as es,h as N,ha as Oi,i as Jt,ia as Gi,ja as vi,jc as be,ka as Wi,la as ie,ma as Yi,n as di,na as Xi,oa as ot,pa as At,qa as Ot,ra as se,s as qt,sa as ne,ta as Bi,u as Vt,ua as Ni,va as Ki,wa as oe,xa as Ui,ya as Zi,z as Le,za as re}from"./chunk-RU7HBO54.js";import{D as Ti,b as fi,m as ki,v as Mi,z as Ri}from"./chunk-S7COXUW4.js";import{A as $t,D as Ii,E as Ei,G as Li,K as te,O as Me,T as ct,a as ke,c as pi,h as B,n as mi,p as Qt,q as _i,r as Q,s as Pt,u as yi,v as xi,w as _t,x as Ft,y as Ci,z as Si}from"./chunk-QFWXP63S.js";var De=class a extends ui{constructor(t){if(super(),this.on,this.once,this.un,this.id_=void 0,this.geometryName_="geometry",this.style_=null,this.styleFunction_=void 0,this.geometryChangeKey_=null,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),t)if(typeof t.getSimplifiedGeometry=="function"){let e=t;this.setGeometry(e)}else{let e=t;this.setProperties(e)}}clone(){let t=new a(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());let e=this.getGeometry();e&&t.setGeometry(e.clone());let s=this.getStyle();return s&&t.setStyle(s),t}getGeometry(){return this.get(this.geometryName_)}getId(){return this.id_}getGeometryName(){return this.geometryName_}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}handleGeometryChange_(){this.changed()}handleGeometryChanged_(){this.geometryChangeKey_&&(Vt(this.geometryChangeKey_),this.geometryChangeKey_=null);let t=this.getGeometry();t&&(this.geometryChangeKey_=qt(t,zt.CHANGE,this.handleGeometryChange_,this)),this.changed()}setGeometry(t){this.set(this.geometryName_,t)}setStyle(t){this.style_=t,this.styleFunction_=t?Ts(t):void 0,this.changed()}setId(t){this.id_=t,this.changed()}setGeometryName(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}};function Ts(a){if(typeof a=="function")return a;let t;return Array.isArray(a)?t=a:(gi(typeof a.getZIndex=="function","Expected an `ol/style/Style` or an array of `ol/style/Style.js`"),t=[a]),function(){return t}}var Ks=De;var ue=class a extends ${constructor(t,e,s){super(),s!==void 0&&e===void 0?this.setFlatCoordinates(s,t):(e=e||0,this.setCenterAndRadius(t,e,s))}clone(){let t=new a(this.flatCoordinates.slice(),void 0,this.layout);return t.applyProperties(this),t}closestPointXY(t,e,s,i){let n=this.flatCoordinates,o=t-n[0],r=e-n[1],l=o*o+r*r;if(l<i){if(l===0)for(let c=0;c<this.stride;++c)s[c]=n[c];else{let c=this.getRadius()/Math.sqrt(l);s[0]=n[0]+c*o,s[1]=n[1]+c*r;for(let h=2;h<this.stride;++h)s[h]=n[h]}return s.length=this.stride,l}return i}containsXY(t,e){let s=this.flatCoordinates,i=t-s[0],n=e-s[1];return i*i+n*n<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(t){let e=this.flatCoordinates,s=e[this.stride]-e[0];return Ft(e[0]-s,e[1]-s,e[0]+s,e[1]+s,t)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){let t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e}getType(){return"Circle"}intersectsExtent(t){let e=this.getExtent();if(ct(t,e)){let s=this.getCenter();return t[0]<=s[0]&&t[2]>=s[0]||t[1]<=s[1]&&t[3]>=s[1]?!0:Li(t,this.intersectsCoordinate.bind(this))}return!1}setCenter(t){let e=this.stride,s=this.flatCoordinates[e]-this.flatCoordinates[0],i=t.slice();i[e]=i[0]+s;for(let n=1;n<e;++n)i[e+n]=t[n];this.setFlatCoordinates(this.layout,i),this.changed()}setCenterAndRadius(t,e,s){this.setLayout(s,t,0),this.flatCoordinates||(this.flatCoordinates=[]);let i=this.flatCoordinates,n=Wi(i,0,t,this.stride);i[n++]=i[0]+e;for(let o=1,r=this.stride;o<r;++o)i[n++]=i[o];i.length=n,this.changed()}getCoordinates(){return null}setCoordinates(t,e){}setRadius(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t,this.changed()}rotate(t,e){let s=this.getCenter(),i=this.getStride();this.setCenter(ee(s,0,s.length,i,t,e,s)),this.changed()}};ue.prototype.transform;var Js=ue;var Pe=class a extends Di{constructor(t){super(),this.geometries_=t,this.changeEventsKeys_=[],this.listenGeometriesChange_()}unlistenGeometriesChange_(){this.changeEventsKeys_.forEach(Vt),this.changeEventsKeys_.length=0}listenGeometriesChange_(){let t=this.geometries_;for(let e=0,s=t.length;e<s;++e)this.changeEventsKeys_.push(qt(t[e],zt.CHANGE,this.changed,this))}clone(){let t=new a(we(this.geometries_));return t.applyProperties(this),t}closestPointXY(t,e,s,i){if(i<Q(this.getExtent(),t,e))return i;let n=this.geometries_;for(let o=0,r=n.length;o<r;++o)i=n[o].closestPointXY(t,e,s,i);return i}containsXY(t,e){let s=this.geometries_;for(let i=0,n=s.length;i<n;++i)if(s[i].containsXY(t,e))return!0;return!1}computeExtent(t){Ci(t);let e=this.geometries_;for(let s=0,i=e.length;s<i;++s)Ii(t,e[s].getExtent());return t}getGeometries(){return we(this.geometries_)}getGeometriesArray(){return this.geometries_}getGeometriesArrayRecursive(){let t=[],e=this.geometries_;for(let s=0,i=e.length;s<i;++s)e[s].getType()===this.getType()?t=t.concat(e[s].getGeometriesArrayRecursive()):t.push(e[s]);return t}getSimplifiedGeometry(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||this.simplifiedGeometryMaxMinSquaredTolerance!==0&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;let e=[],s=this.geometries_,i=!1;for(let n=0,o=s.length;n<o;++n){let r=s[n],l=r.getSimplifiedGeometry(t);e.push(l),l!==r&&(i=!0)}return i?new a(e):(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}getType(){return"GeometryCollection"}intersectsExtent(t){let e=this.geometries_;for(let s=0,i=e.length;s<i;++s)if(e[s].intersectsExtent(t))return!0;return!1}isEmpty(){return this.geometries_.length===0}rotate(t,e){let s=this.geometries_;for(let i=0,n=s.length;i<n;++i)s[i].rotate(t,e);this.changed()}scale(t,e,s){s||(s=te(this.getExtent()));let i=this.geometries_;for(let n=0,o=i.length;n<o;++n)i[n].scale(t,e,s);this.changed()}setGeometries(t){this.setGeometriesArray(we(t))}setGeometriesArray(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}applyTransform(t){let e=this.geometries_;for(let s=0,i=e.length;s<i;++s)e[s].applyTransform(t);this.changed()}translate(t,e){let s=this.geometries_;for(let i=0,n=s.length;i<n;++i)s[i].translate(t,e);this.changed()}disposeInternal(){this.unlistenGeometriesChange_(),super.disposeInternal()}};function we(a){return a.map(t=>t.clone())}var bs=Pe;function pt(a,t,e,s,i,n,o){let r,l,c=(e-t)/s;if(c===1)r=t;else if(c===2)r=t,l=i;else if(c!==0){let h=a[t],d=a[t+1],f=0,u=[0];for(let g=t+s;g<e;g+=s){let _=a[g],C=a[g+1];f+=Math.sqrt((_-h)*(_-h)+(C-d)*(C-d)),u.push(f),h=_,d=C}let m=i*f,y=hi(u,m);y<0?(l=(m-u[-y-2])/(u[-y-1]-u[-y-2]),r=t+(-y-2)*s):r=t+y*s}o=o>1?o:2,n=n||new Array(o);for(let h=0;h<o;++h)n[h]=r===void 0?NaN:l===void 0?a[r+h]:B(a[r+h],a[r+s+h],l);return n}function ge(a,t,e,s,i,n){if(e==t)return null;let o;if(i<a[t+s-1])return n?(o=a.slice(t,t+s),o[s-1]=i,o):null;if(a[e-1]<i)return n?(o=a.slice(e-s,e),o[s-1]=i,o):null;if(i==a[t+s-1])return a.slice(t,t+s);let r=t/s,l=e/s;for(;r<l;){let f=r+l>>1;i<a[(f+1)*s-1]?l=f:r=f+1}let c=a[r*s-1];if(i==c)return a.slice((r-1)*s,(r-1)*s+s);let h=a[(r+1)*s-1],d=(i-c)/(h-c);o=[];for(let f=0;f<s-1;++f)o.push(B(a[(r-1)*s+f],a[r*s+f],d));return o.push(i),o}function os(a,t,e,s,i,n,o){if(o)return ge(a,t,e[e.length-1],s,i,n);let r;if(i<a[s-1])return n?(r=a.slice(0,s),r[s-1]=i,r):null;if(a[a.length-1]<i)return n?(r=a.slice(a.length-s),r[s-1]=i,r):null;for(let l=0,c=e.length;l<c;++l){let h=e[l];if(t!=h){if(i<a[t+s-1])return null;if(i<=a[h-1])return ge(a,t,h,s,i,!1);t=h}}return null}function It(a,t,e,s){let i=a[t],n=a[t+1],o=0;for(let r=t+s;r<e;r+=s){let l=a[r],c=a[r+1];o+=Math.sqrt((l-i)*(l-i)+(c-n)*(c-n)),i=l,n=c}return o}var Fe=class a extends ${constructor(t,e){super(),this.flatMidpoint_=null,this.flatMidpointRevision_=-1,this.maxDelta_=-1,this.maxDeltaRevision_=-1,e!==void 0&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendCoordinate(t){N(this.flatCoordinates,t),this.changed()}clone(){let t=new a(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,s,i){return i<Q(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Pi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Oi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,s,i))}forEachSegment(t){return ji(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}getCoordinateAtM(t,e){return this.layout!="XYM"&&this.layout!="XYZM"?null:(e=e!==void 0?e:!1,ge(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e))}getCoordinates(){return ot(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getCoordinateAt(t,e){return pt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}getLength(){return It(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getFlatMidpoint(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_??void 0),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}getSimplifiedGeometryInternal(t){let e=[];return e.length=se(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new a(e,"XY")}getType(){return"LineString"}intersectsExtent(t){return Hi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,this.getExtent())}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ie(this.flatCoordinates,0,t,this.stride),this.changed()}},pe=Fe;var Ae=class a extends ${constructor(t,e,s){if(super(),this.ends_=[],this.maxDelta_=-1,this.maxDeltaRevision_=-1,Array.isArray(t[0]))this.setCoordinates(t,e);else if(e!==void 0&&s)this.setFlatCoordinates(e,t),this.ends_=s;else{let i=t,n=[],o=[];for(let l=0,c=i.length;l<c;++l){let h=i[l];N(n,h.getFlatCoordinates()),o.push(n.length)}let r=i.length===0?this.getLayout():i[0].getLayout();this.setFlatCoordinates(r,n),this.ends_=o}}appendLineString(t){N(this.flatCoordinates,t.getFlatCoordinates().slice()),this.ends_.push(this.flatCoordinates.length),this.changed()}clone(){let t=new a(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}closestPointXY(t,e,s,i){return i<Q(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Fi(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Gi(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,s,i))}getCoordinateAtM(t,e,s){return this.layout!="XYM"&&this.layout!="XYZM"||this.flatCoordinates.length===0?null:(e=e!==void 0?e:!1,s=s!==void 0?s:!1,os(this.flatCoordinates,0,this.ends_,this.stride,t,e,s))}getCoordinates(){return At(this.flatCoordinates,0,this.ends_,this.stride)}getEnds(){return this.ends_}getLineString(t){return t<0||this.ends_.length<=t?null:new pe(this.flatCoordinates.slice(t===0?0:this.ends_[t-1],this.ends_[t]),this.layout)}getLineStrings(){let t=this.flatCoordinates,e=this.ends_,s=this.layout,i=[],n=0;for(let o=0,r=e.length;o<r;++o){let l=e[o],c=new pe(t.slice(n,l),s);i.push(c),n=l}return i}getLength(){let t=this.ends_,e=0,s=0;for(let i=0,n=t.length;i<n;++i)s+=It(this.flatCoordinates,e,t[i],this.stride),e=t[i];return s}getFlatMidpoints(){let t=[],e=this.flatCoordinates,s=0,i=this.ends_,n=this.stride;for(let o=0,r=i.length;o<r;++o){let l=i[o],c=pt(e,s,l,n,.5);N(t,c),s=l}return t}getSimplifiedGeometryInternal(t){let e=[],s=[];return e.length=ne(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,s),new a(e,"XY",s)}getType(){return"MultiLineString"}intersectsExtent(t){return zi(this.flatCoordinates,0,this.ends_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);let s=Yi(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=s.length===0?0:s[s.length-1],this.changed()}},Ds=Ae;var Oe=class a extends ${constructor(t,e){super(),e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}appendPoint(t){N(this.flatCoordinates,t.getFlatCoordinates()),this.changed()}clone(){let t=new a(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}closestPointXY(t,e,s,i){if(i<Q(this.getExtent(),t,e))return i;let n=this.flatCoordinates,o=this.stride;for(let r=0,l=n.length;r<l;r+=o){let c=pi(t,e,n[r],n[r+1]);if(c<i){i=c;for(let h=0;h<o;++h)s[h]=n[r+h];s.length=o}}return i}getCoordinates(){return ot(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}getPoint(t){let e=this.flatCoordinates.length/this.stride;return t<0||e<=t?null:new oe(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}getPoints(){let t=this.flatCoordinates,e=this.layout,s=this.stride,i=[];for(let n=0,o=t.length;n<o;n+=s){let r=new oe(t.slice(n,n+s),e);i.push(r)}return i}getType(){return"MultiPoint"}intersectsExtent(t){let e=this.flatCoordinates,s=this.stride;for(let i=0,n=e.length;i<n;i+=s){let o=e[i],r=e[i+1];if(yi(t,o,r))return!0}return!1}setCoordinates(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=ie(this.flatCoordinates,0,t,this.stride),this.changed()}},Ge=Oe;function me(a,t,e,s){let i=[],n=_t();for(let o=0,r=e.length;o<r;++o){let l=e[o];n=$t(a,t,l[0],s),i.push((n[0]+n[2])/2,(n[1]+n[3])/2),t=l[l.length-1]}return i}var ve=class a extends ${constructor(t,e,s){if(super(),this.endss_=[],this.flatInteriorPointsRevision_=-1,this.flatInteriorPoints_=null,this.maxDelta_=-1,this.maxDeltaRevision_=-1,this.orientedRevision_=-1,this.orientedFlatCoordinates_=null,!s&&!Array.isArray(t[0])){let i=t,n=[],o=[];for(let r=0,l=i.length;r<l;++r){let c=i[r],h=n.length,d=c.getEnds();for(let f=0,u=d.length;f<u;++f)d[f]+=h;N(n,c.getFlatCoordinates()),o.push(d)}e=i.length===0?this.getLayout():i[0].getLayout(),t=n,s=o}e!==void 0&&s?(this.setFlatCoordinates(e,t),this.endss_=s):this.setCoordinates(t,e)}appendPolygon(t){let e;if(!this.flatCoordinates)this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();else{let s=this.flatCoordinates.length;N(this.flatCoordinates,t.getFlatCoordinates()),e=t.getEnds().slice();for(let i=0,n=e.length;i<n;++i)e[i]+=s}this.endss_.push(e),this.changed()}clone(){let t=this.endss_.length,e=new Array(t);for(let i=0;i<t;++i)e[i]=this.endss_[i].slice();let s=new a(this.flatCoordinates.slice(),this.layout,e);return s.applyProperties(this),s}closestPointXY(t,e,s,i){return i<Q(this.getExtent(),t,e)?i:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Ai(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),vi(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,s,i))}containsXY(t,e){return Ui(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}getArea(){return wi(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}getCoordinates(t){let e;return t!==void 0?(e=this.getOrientedFlatCoordinates().slice(),Re(e,0,this.endss_,this.stride,t)):e=this.flatCoordinates,Ot(e,0,this.endss_,this.stride)}getEndss(){return this.endss_}getFlatInteriorPoints(){if(this.flatInteriorPointsRevision_!=this.getRevision()){let t=me(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=re(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}getInteriorPoints(){return new Ge(this.getFlatInteriorPoints().slice(),"XYM")}getOrientedFlatCoordinates(){if(this.orientedRevision_!=this.getRevision()){let t=this.flatCoordinates;qi(t,0,this.endss_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=Re(this.orientedFlatCoordinates_,0,this.endss_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}getSimplifiedGeometryInternal(t){let e=[],s=[];return e.length=Ki(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,s),new a(e,"XY",s)}getPolygon(t){if(t<0||this.endss_.length<=t)return null;let e;if(t===0)e=0;else{let n=this.endss_[t-1];e=n[n.length-1]}let s=this.endss_[t].slice(),i=s[s.length-1];if(e!==0)for(let n=0,o=s.length;n<o;++n)s[n]-=e;return new le(this.flatCoordinates.slice(e,i),this.layout,s)}getPolygons(){let t=this.layout,e=this.flatCoordinates,s=this.endss_,i=[],n=0;for(let o=0,r=s.length;o<r;++o){let l=s[o].slice(),c=l[l.length-1];if(n!==0)for(let d=0,f=l.length;d<f;++d)l[d]-=n;let h=new le(e.slice(n,c),t,l);i.push(h),n=c}return i}getType(){return"MultiPolygon"}intersectsExtent(t){return Ji(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}setCoordinates(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);let s=Xi(this.flatCoordinates,0,t,this.stride,this.endss_);if(s.length===0)this.flatCoordinates.length=0;else{let i=s[s.length-1];this.flatCoordinates.length=i.length===0?0:i[i.length-1]}this.changed()}},ws=ve;var rs=gt(),Yt=class a{constructor(t,e,s,i,n,o){this.styleFunction,this.extent_,this.id_=o,this.type_=t,this.flatCoordinates_=e,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=s||null,this.properties_=n,this.squaredTolerance_,this.stride_=i,this.simplifiedGeometry_}get(t){return this.properties_[t]}getExtent(){return this.extent_||(this.extent_=this.type_==="Point"?Si(this.flatCoordinates_):$t(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}getFlatInteriorPoint(){if(!this.flatInteriorPoints_){let t=te(this.getExtent());this.flatInteriorPoints_=Zi(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}getFlatInteriorPoints(){if(!this.flatInteriorPoints_){let t=Vi(this.flatCoordinates_,this.ends_),e=me(this.flatCoordinates_,0,t,2);this.flatInteriorPoints_=re(this.flatCoordinates_,0,t,2,e)}return this.flatInteriorPoints_}getFlatMidpoint(){return this.flatMidpoints_||(this.flatMidpoints_=pt(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}getFlatMidpoints(){if(!this.flatMidpoints_){this.flatMidpoints_=[];let t=this.flatCoordinates_,e=0,s=this.ends_;for(let i=0,n=s.length;i<n;++i){let o=s[i],r=pt(t,e,o,2,.5);N(this.flatMidpoints_,r),e=o}}return this.flatMidpoints_}getId(){return this.id_}getOrientedFlatCoordinates(){return this.flatCoordinates_}getGeometry(){return this}getSimplifiedGeometry(t){return this}simplifyTransformed(t,e){return this}getProperties(){return this.properties_}getPropertiesInternal(){return this.properties_}getStride(){return this.stride_}getStyleFunction(){return this.styleFunction}getType(){return this.type_}transform(t){t=ki(t);let e=t.getExtent(),s=t.getWorldExtent();if(e&&s){let i=Me(s)/Me(e);xt(rs,s[0],s[3],i,-i,0,0,0),Ct(this.flatCoordinates_,0,this.flatCoordinates_.length,2,rs,this.flatCoordinates_)}}applyTransform(t){t(this.flatCoordinates_,this.flatCoordinates_,this.stride_)}clone(){return new a(this.type_,this.flatCoordinates_.slice(),this.ends_?.slice(),this.stride_,Object.assign({},this.properties_),this.id_)}getEnds(){return this.ends_}enableSimplifyTransformed(){return this.simplifyTransformed=di((t,e)=>{if(t===this.squaredTolerance_)return this.simplifiedGeometry_;this.simplifiedGeometry_=this.clone(),e&&this.simplifiedGeometry_.applyTransform(e);let s=this.simplifiedGeometry_.getFlatCoordinates(),i;switch(this.type_){case"LineString":s.length=se(s,0,this.simplifiedGeometry_.flatCoordinates_.length,this.simplifiedGeometry_.stride_,t,s,0),i=[s.length];break;case"MultiLineString":i=[],s.length=ne(s,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,t,s,0,i);break;case"Polygon":i=[],s.length=Ni(s,0,this.simplifiedGeometry_.ends_,this.simplifiedGeometry_.stride_,Math.sqrt(t),s,0,i);break;default:}return i&&(this.simplifiedGeometry_=new a(this.type_,s,i,2,this.properties_,this.id_)),this.squaredTolerance_=t,this.simplifiedGeometry_}),this}};Yt.prototype.getFlatCoordinates=Yt.prototype.getOrientedFlatCoordinates;var Eo=Yt;var Ps=!1;function Fs(a,t,e,s,i,n,o){let r=new XMLHttpRequest;r.open("GET",typeof a=="function"?a(e,s,i):a,!0),t.getType()=="arraybuffer"&&(r.responseType="arraybuffer"),r.withCredentials=Ps,r.onload=function(l){if(!r.status||r.status>=200&&r.status<300){let c=t.getType();try{let h;c=="text"||c=="json"?h=r.responseText:c=="xml"?h=r.responseXML||r.responseText:c=="arraybuffer"&&(h=r.response),h?n(t.readFeatures(h,{extent:e,featureProjection:i}),t.readProjection(h)):o()}catch{o()}}else o()},r.onerror=o,r.send()}function ko(a,t){return function(e,s,i,n,o){Fs(a,t,e,s,i,(r,l)=>{this.addFeatures(r),n!==void 0&&n(r)},()=>{this.changed(),o!==void 0&&o()})}}var Xt={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Bt=[Xt.FILL],tt=[Xt.STROKE],lt=[Xt.BEGIN_PATH],We=[Xt.CLOSE_PATH],S=Xt;var Ye=class extends ss{constructor(t,e,s,i){super(),this.tolerance=t,this.maxExtent=e,this.pixelRatio=i,this.maxLineWidth=0,this.resolution=s,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(t){let e=this.pixelRatio;return e==1?t:t.map(function(s){return s*e})}appendFlatPointCoordinates(t,e){let s=this.getBufferedMaxExtent(),i=this.tmpCoordinate_,n=this.coordinates,o=n.length;for(let r=0,l=t.length;r<l;r+=e)i[0]=t[r],i[1]=t[r+1],Pt(s,i)&&(n[o++]=i[0],n[o++]=i[1]);return o}appendFlatLineCoordinates(t,e,s,i,n,o){let r=this.coordinates,l=r.length,c=this.getBufferedMaxExtent();o&&(e+=i);let h=t[e],d=t[e+1],f=this.tmpCoordinate_,u=!0,m,y,g;for(m=e+i;m<s;m+=i)f[0]=t[m],f[1]=t[m+1],g=xi(c,f),g!==y?(u&&(r[l++]=h,r[l++]=d,u=!1),r[l++]=f[0],r[l++]=f[1]):g===mi.INTERSECTING?(r[l++]=f[0],r[l++]=f[1],u=!1):u=!0,h=f[0],d=f[1],y=g;return(n&&u||m===e+i)&&(r[l++]=h,r[l++]=d),l}drawCustomCoordinates_(t,e,s,i,n){for(let o=0,r=s.length;o<r;++o){let l=s[o],c=this.appendFlatLineCoordinates(t,e,l,i,!1,!1);n.push(c),e=l}return e}drawCustom(t,e,s,i,n){this.beginGeometry(t,e,n);let o=t.getType(),r=t.getStride(),l=this.coordinates.length,c,h,d,f,u;switch(o){case"MultiPolygon":c=t.getOrientedFlatCoordinates(),f=[];let m=t.getEndss();u=0;for(let y=0,g=m.length;y<g;++y){let _=[];u=this.drawCustomCoordinates_(c,u,m[y],r,_),f.push(_)}this.instructions.push([S.CUSTOM,l,f,t,s,Ot,n]),this.hitDetectionInstructions.push([S.CUSTOM,l,f,t,i||s,Ot,n]);break;case"Polygon":case"MultiLineString":d=[],c=o=="Polygon"?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(c,0,t.getEnds(),r,d),this.instructions.push([S.CUSTOM,l,d,t,s,At,n]),this.hitDetectionInstructions.push([S.CUSTOM,l,d,t,i||s,At,n]);break;case"LineString":case"Circle":c=t.getFlatCoordinates(),h=this.appendFlatLineCoordinates(c,0,c.length,r,!1,!1),this.instructions.push([S.CUSTOM,l,h,t,s,ot,n]),this.hitDetectionInstructions.push([S.CUSTOM,l,h,t,i||s,ot,n]);break;case"MultiPoint":c=t.getFlatCoordinates(),h=this.appendFlatPointCoordinates(c,r),h>l&&(this.instructions.push([S.CUSTOM,l,h,t,s,ot,n]),this.hitDetectionInstructions.push([S.CUSTOM,l,h,t,i||s,ot,n]));break;case"Point":c=t.getFlatCoordinates(),this.coordinates.push(c[0],c[1]),h=this.coordinates.length,this.instructions.push([S.CUSTOM,l,h,t,s,void 0,n]),this.hitDetectionInstructions.push([S.CUSTOM,l,h,t,i||s,void 0,n]);break;default:}this.endGeometry(e)}beginGeometry(t,e,s){this.beginGeometryInstruction1_=[S.BEGIN_GEOMETRY,e,0,t,s],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[S.BEGIN_GEOMETRY,e,0,t,s],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){let t=this.hitDetectionInstructions;t.reverse();let e,s=t.length,i,n,o=-1;for(e=0;e<s;++e)i=t[e],n=i[0],n==S.END_GEOMETRY?o=e:n==S.BEGIN_GEOMETRY&&(i[2]=e,ci(this.hitDetectionInstructions,o,e),o=-1)}fillStyleToState(t,e={}){if(t){let s=t.getColor();e.fillPatternScale=s&&typeof s=="object"&&"src"in s?this.pixelRatio:1,e.fillStyle=St(s||K)}else e.fillStyle=void 0;return e}strokeStyleToState(t,e={}){if(t){let s=t.getColor();e.strokeStyle=St(s||de);let i=t.getLineCap();e.lineCap=i!==void 0?i:he;let n=t.getLineDash();e.lineDash=n?n.slice():z;let o=t.getLineDashOffset();e.lineDashOffset=o||J;let r=t.getLineJoin();e.lineJoin=r!==void 0?r:ae;let l=t.getWidth();e.lineWidth=l!==void 0?l:fe;let c=t.getMiterLimit();e.miterLimit=c!==void 0?c:ce,e.lineWidth>this.maxLineWidth&&(this.maxLineWidth=e.lineWidth,this.bufferedMaxExtent_=null)}else e.strokeStyle=void 0,e.lineCap=void 0,e.lineDash=null,e.lineDashOffset=void 0,e.lineJoin=void 0,e.lineWidth=void 0,e.miterLimit=void 0;return e}setFillStrokeStyle(t,e){let s=this.state;this.fillStyleToState(t,s),this.strokeStyleToState(e,s)}createFill(t){let e=t.fillStyle,s=[S.SET_FILL_STYLE,e];return typeof e!="string"&&s.push(t.fillPatternScale),s}applyStroke(t){this.instructions.push(this.createStroke(t))}createStroke(t){return[S.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,t.lineDash?this.applyPixelRatio(t.lineDash):null,t.lineDashOffset*this.pixelRatio]}updateFillStyle(t,e){let s=t.fillStyle;(typeof s!="string"||t.currentFillStyle!=s)&&(this.instructions.push(e.call(this,t)),t.currentFillStyle=s)}updateStrokeStyle(t,e){let s=t.strokeStyle,i=t.lineCap,n=t.lineDash,o=t.lineDashOffset,r=t.lineJoin,l=t.lineWidth,c=t.miterLimit;(t.currentStrokeStyle!=s||t.currentLineCap!=i||n!=t.currentLineDash&&!Jt(t.currentLineDash,n)||t.currentLineDashOffset!=o||t.currentLineJoin!=r||t.currentLineWidth!=l||t.currentMiterLimit!=c)&&(e.call(this,t),t.currentStrokeStyle=s,t.currentLineCap=i,t.currentLineDash=n,t.currentLineDashOffset=o,t.currentLineJoin=r,t.currentLineWidth=l,t.currentMiterLimit=c)}endGeometry(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;let e=[S.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=_i(this.maxExtent),this.maxLineWidth>0)){let t=this.resolution*(this.maxLineWidth+1)/2;Qt(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}},et=Ye;var Xe=class extends et{constructor(t,e,s,i){super(t,e,s,i),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(t,e,s){if(!this.image_||this.maxExtent&&!Pt(this.maxExtent,t.getFlatCoordinates()))return;this.beginGeometry(t,e,s);let i=t.getFlatCoordinates(),n=t.getStride(),o=this.coordinates.length,r=this.appendFlatPointCoordinates(i,n);this.instructions.push([S.DRAW_IMAGE,o,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([S.DRAW_IMAGE,o,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}drawMultiPoint(t,e,s){if(!this.image_)return;this.beginGeometry(t,e,s);let i=t.getFlatCoordinates(),n=[];for(let l=0,c=i.length;l<c;l+=t.getStride())(!this.maxExtent||Pt(this.maxExtent,i.slice(l,l+2)))&&n.push(i[l],i[l+1]);let o=this.coordinates.length,r=this.appendFlatPointCoordinates(n,2);this.instructions.push([S.DRAW_IMAGE,o,r,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([S.DRAW_IMAGE,o,r,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(t,e){let s=t.getAnchor(),i=t.getSize(),n=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=s[0],this.anchorY_=s[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=i[1],this.opacity_=t.getOpacity(),this.originX_=n[0],this.originY_=n[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=i[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},ls=Xe;var Be=class extends et{constructor(t,e,s,i){super(t,e,s,i)}drawFlatCoordinates_(t,e,s,i){let n=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,s,i,!1,!1),r=[S.MOVE_TO_LINE_TO,n,o];return this.instructions.push(r),this.hitDetectionInstructions.push(r),s}drawLineString(t,e,s){let i=this.state,n=i.strokeStyle,o=i.lineWidth;if(n===void 0||o===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e,s),this.hitDetectionInstructions.push([S.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,z,J],lt);let r=t.getFlatCoordinates(),l=t.getStride();this.drawFlatCoordinates_(r,0,r.length,l),this.hitDetectionInstructions.push(tt),this.endGeometry(e)}drawMultiLineString(t,e,s){let i=this.state,n=i.strokeStyle,o=i.lineWidth;if(n===void 0||o===void 0)return;this.updateStrokeStyle(i,this.applyStroke),this.beginGeometry(t,e,s),this.hitDetectionInstructions.push([S.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,z,J],lt);let r=t.getEnds(),l=t.getFlatCoordinates(),c=t.getStride(),h=0;for(let d=0,f=r.length;d<f;++d)h=this.drawFlatCoordinates_(l,h,r[d],c);this.hitDetectionInstructions.push(tt),this.endGeometry(e)}finish(){let t=this.state;return t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&this.instructions.push(tt),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(t){t.lastStroke!=null&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(tt),t.lastStroke=this.coordinates.length),t.lastStroke=0,super.applyStroke(t),this.instructions.push(lt)}},hs=Be;var Ne=class extends et{constructor(t,e,s,i){super(t,e,s,i)}drawFlatCoordinatess_(t,e,s,i){let n=this.state,o=n.fillStyle!==void 0,r=n.strokeStyle!==void 0,l=s.length;this.instructions.push(lt),this.hitDetectionInstructions.push(lt);for(let c=0;c<l;++c){let h=s[c],d=this.coordinates.length,f=this.appendFlatLineCoordinates(t,e,h,i,!0,!r),u=[S.MOVE_TO_LINE_TO,d,f];this.instructions.push(u),this.hitDetectionInstructions.push(u),r&&(this.instructions.push(We),this.hitDetectionInstructions.push(We)),e=h}return o&&(this.instructions.push(Bt),this.hitDetectionInstructions.push(Bt)),r&&(this.instructions.push(tt),this.hitDetectionInstructions.push(tt)),e}drawCircle(t,e,s){let i=this.state,n=i.fillStyle,o=i.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,s),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([S.SET_FILL_STYLE,K]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([S.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,z,J]);let r=t.getFlatCoordinates(),l=t.getStride(),c=this.coordinates.length;this.appendFlatLineCoordinates(r,0,r.length,l,!1,!1);let h=[S.CIRCLE,c];this.instructions.push(lt,h),this.hitDetectionInstructions.push(lt,h),i.fillStyle!==void 0&&(this.instructions.push(Bt),this.hitDetectionInstructions.push(Bt)),i.strokeStyle!==void 0&&(this.instructions.push(tt),this.hitDetectionInstructions.push(tt)),this.endGeometry(e)}drawPolygon(t,e,s){let i=this.state,n=i.fillStyle,o=i.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,s),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([S.SET_FILL_STYLE,K]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([S.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,z,J]);let r=t.getEnds(),l=t.getOrientedFlatCoordinates(),c=t.getStride();this.drawFlatCoordinatess_(l,0,r,c),this.endGeometry(e)}drawMultiPolygon(t,e,s){let i=this.state,n=i.fillStyle,o=i.strokeStyle;if(n===void 0&&o===void 0)return;this.setFillStrokeStyles_(),this.beginGeometry(t,e,s),i.fillStyle!==void 0&&this.hitDetectionInstructions.push([S.SET_FILL_STYLE,K]),i.strokeStyle!==void 0&&this.hitDetectionInstructions.push([S.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,z,J]);let r=t.getEndss(),l=t.getOrientedFlatCoordinates(),c=t.getStride(),h=0;for(let d=0,f=r.length;d<f;++d)h=this.drawFlatCoordinatess_(l,h,r[d],c);this.endGeometry(e)}finish(){this.reverseHitDetectionInstructions(),this.state=null;let t=this.tolerance;if(t!==0){let e=this.coordinates;for(let s=0,i=e.length;s<i;++s)e[s]=Bi(e[s],t)}return super.finish()}setFillStrokeStyles_(){let t=this.state;this.updateFillStyle(t,this.createFill),this.updateStrokeStyle(t,this.applyStroke)}},Ke=Ne;function as(a,t,e,s,i){let n=[],o=e,r=0,l=t.slice(e,2);for(;r<a&&o+i<s;){let[c,h]=l.slice(-2),d=t[o+i],f=t[o+i+1],u=Math.sqrt((d-c)*(d-c)+(f-h)*(f-h));if(r+=u,r>=a){let m=(a-r+u)/u,y=B(c,d,m),g=B(h,f,m);l.push(y,g),n.push(l),l=[y,g],r==a&&(o+=i),r=0}else if(r<a)l.push(t[o+i],t[o+i+1]),o+=i;else{let m=u-r,y=B(c,d,m/u),g=B(h,f,m/u);l.push(y,g),n.push(l),l=[y,g],r=0,o+=i}}return r>0&&n.push(l),n}function cs(a,t,e,s,i){let n=e,o=e,r=0,l=0,c=e,h,d,f,u,m,y,g,_,C,E;for(d=e;d<s;d+=i){let x=t[d],I=t[d+1];m!==void 0&&(C=x-m,E=I-y,u=Math.sqrt(C*C+E*E),g!==void 0&&(l+=f,h=Math.acos((g*C+_*E)/(f*u)),h>a&&(l>r&&(r=l,n=c,o=d),l=0,c=d-i)),f=u,g=C,_=E),m=x,y=I}return l+=u,l>r?[c,d]:[n,o]}var Nt={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Ue=class extends et{constructor(t,e,s,i){super(t,e,s,i),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textKeepUpright_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[K]={fillStyle:K},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterMode_=void 0,this.declutterImageWithText_=void 0}finish(){let t=super.finish();return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}drawText(t,e,s){let i=this.textFillState_,n=this.textStrokeState_,o=this.textState_;if(this.text_===""||!o||!i&&!n)return;let r=this.coordinates,l=r.length,c=t.getType(),h=null,d=t.getStride();if(o.placement==="line"&&(c=="LineString"||c=="MultiLineString"||c=="Polygon"||c=="MultiPolygon")){if(!ct(this.maxExtent,t.getExtent()))return;let f;if(h=t.getFlatCoordinates(),c=="LineString")f=[h.length];else if(c=="MultiLineString")f=t.getEnds();else if(c=="Polygon")f=t.getEnds().slice(0,1);else if(c=="MultiPolygon"){let g=t.getEndss();f=[];for(let _=0,C=g.length;_<C;++_)f.push(g[_][0])}this.beginGeometry(t,e,s);let u=o.repeat,m=u?void 0:o.textAlign,y=0;for(let g=0,_=f.length;g<_;++g){let C;u?C=as(u*this.resolution,h,y,f[g],d):C=[h.slice(y,f[g])];for(let E=0,x=C.length;E<x;++E){let I=C[E],L=0,k=I.length;if(m==null){let M=cs(o.maxAngle,I,0,I.length,2);L=M[0],k=M[1]}for(let M=L;M<k;M+=d)r.push(I[M],I[M+1]);let R=r.length;y=f[g],this.drawChars_(l,R),l=R}}this.endGeometry(e)}else{let f=o.overflow?null:[];switch(c){case"Point":case"MultiPoint":h=t.getFlatCoordinates();break;case"LineString":h=t.getFlatMidpoint();break;case"Circle":h=t.getCenter();break;case"MultiLineString":h=t.getFlatMidpoints(),d=2;break;case"Polygon":h=t.getFlatInteriorPoint(),o.overflow||f.push(h[2]/this.resolution),d=3;break;case"MultiPolygon":let x=t.getFlatInteriorPoints();h=[];for(let I=0,L=x.length;I<L;I+=3)o.overflow||f.push(x[I+2]/this.resolution),h.push(x[I],x[I+1]);if(h.length===0)return;d=2;break;default:}let u=this.appendFlatPointCoordinates(h,d);if(u===l)return;if(f&&(u-l)/2!==h.length/d){let x=l/2;f=f.filter((I,L)=>{let k=r[(x+L)*2]===h[L*d]&&r[(x+L)*2+1]===h[L*d+1];return k||--x,k})}this.saveTextStates_();let m=o.backgroundFill?this.createFill(this.fillStyleToState(o.backgroundFill)):null,y=o.backgroundStroke?this.createStroke(this.strokeStyleToState(o.backgroundStroke)):null;this.beginGeometry(t,e,s);let g=o.padding;if(g!=rt&&(o.scale[0]<0||o.scale[1]<0)){let x=o.padding[0],I=o.padding[1],L=o.padding[2],k=o.padding[3];o.scale[0]<0&&(I=-I,k=-k),o.scale[1]<0&&(x=-x,L=-L),g=[x,I,L,k]}let _=this.pixelRatio;this.instructions.push([S.DRAW_IMAGE,l,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,this.declutterMode_,this.declutterImageWithText_,g==rt?rt:g.map(function(x){return x*_}),m,y,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]);let C=1/_,E=m?m.slice(0):null;E&&(E[1]=K),this.hitDetectionInstructions.push([S.DRAW_IMAGE,l,u,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[C,C],NaN,this.declutterMode_,this.declutterImageWithText_,g,E,y,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?K:this.fillKey_,this.textOffsetX_,this.textOffsetY_,f]),this.endGeometry(e)}}saveTextStates_(){let t=this.textStrokeState_,e=this.textState_,s=this.textFillState_,i=this.strokeKey_;t&&(i in this.strokeStates||(this.strokeStates[i]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));let n=this.textKey_;n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||vt,justify:e.justify,textBaseline:e.textBaseline||Wt,scale:e.scale});let o=this.fillKey_;s&&(o in this.fillStates||(this.fillStates[o]={fillStyle:s.fillStyle}))}drawChars_(t,e){let s=this.textStrokeState_,i=this.textState_,n=this.strokeKey_,o=this.textKey_,r=this.fillKey_;this.saveTextStates_();let l=this.pixelRatio,c=Nt[i.textBaseline],h=this.textOffsetY_*l,d=this.text_,f=s?s.lineWidth*Math.abs(i.scale[0])/2:0;this.instructions.push([S.DRAW_CHARS,t,e,c,i.overflow,r,i.maxAngle,l,h,n,f*l,d,o,1,this.declutterMode_,this.textKeepUpright_]),this.hitDetectionInstructions.push([S.DRAW_CHARS,t,e,c,i.overflow,r&&K,i.maxAngle,l,h,n,f*l,d,o,1/l,this.declutterMode_,this.textKeepUpright_])}setTextStyle(t,e){let s,i,n;if(!t)this.text_="";else{let o=t.getFill();o?(i=this.textFillState_,i||(i={},this.textFillState_=i),i.fillStyle=St(o.getColor()||K)):(i=null,this.textFillState_=i);let r=t.getStroke();if(!r)n=null,this.textStrokeState_=n;else{n=this.textStrokeState_,n||(n={},this.textStrokeState_=n);let y=r.getLineDash(),g=r.getLineDashOffset(),_=r.getWidth(),C=r.getMiterLimit();n.lineCap=r.getLineCap()||he,n.lineDash=y?y.slice():z,n.lineDashOffset=g===void 0?J:g,n.lineJoin=r.getLineJoin()||ae,n.lineWidth=_===void 0?fe:_,n.miterLimit=C===void 0?ce:C,n.strokeStyle=St(r.getColor()||de)}s=this.textState_;let l=t.getFont()||Qi;$i(l);let c=t.getScaleArray();s.overflow=t.getOverflow(),s.font=l,s.maxAngle=t.getMaxAngle(),s.placement=t.getPlacement(),s.textAlign=t.getTextAlign(),s.repeat=t.getRepeat(),s.justify=t.getJustify(),s.textBaseline=t.getTextBaseline()||Wt,s.backgroundFill=t.getBackgroundFill(),s.backgroundStroke=t.getBackgroundStroke(),s.padding=t.getPadding()||rt,s.scale=c===void 0?[1,1]:c;let h=t.getOffsetX(),d=t.getOffsetY(),f=t.getRotateWithView(),u=t.getKeepUpright(),m=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=h===void 0?0:h,this.textOffsetY_=d===void 0?0:d,this.textRotateWithView_=f===void 0?!1:f,this.textKeepUpright_=u===void 0?!0:u,this.textRotation_=m===void 0?0:m,this.strokeKey_=n?(typeof n.strokeStyle=="string"?n.strokeStyle:Le(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"",this.textKey_=s.font+s.scale+(s.textAlign||"?")+(s.repeat||"?")+(s.justify||"?")+(s.textBaseline||"?"),this.fillKey_=i&&i.fillStyle?typeof i.fillStyle=="string"?i.fillStyle:"|"+Le(i.fillStyle):""}this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}},ds=Ue;var As={Circle:Ke,Default:et,Image:ls,LineString:hs,Polygon:Ke,Text:ds},Ze=class{constructor(t,e,s,i){this.tolerance_=t,this.maxExtent_=e,this.pixelRatio_=i,this.resolution_=s,this.buildersByZIndex_={}}finish(){let t={};for(let e in this.buildersByZIndex_){t[e]=t[e]||{};let s=this.buildersByZIndex_[e];for(let i in s){let n=s[i].finish();t[e][i]=n}}return t}getBuilder(t,e){let s=t!==void 0?t.toString():"0",i=this.buildersByZIndex_[s];i===void 0&&(i={},this.buildersByZIndex_[s]=i);let n=i[e];if(n===void 0){let o=As[e];n=new o(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),i[e]=n}return n}},ur=Ze;function fs(a,t,e,s,i,n,o,r,l,c,h,d,f=!0){let u=a[t],m=a[t+1],y=0,g=0,_=0,C=0;function E(){y=u,g=m,t+=s,u=a[t],m=a[t+1],C+=_,_=Math.sqrt((u-y)*(u-y)+(m-g)*(m-g))}do E();while(t<e-s&&C+_<n);let x=_===0?0:(n-C)/_,I=B(y,u,x),L=B(g,m,x),k=t-s,R=C,M=n+r*l(c,i,h);for(;t<e-s&&C+_<M;)E();x=_===0?0:(M-C)/_;let G=B(y,u,x),P=B(g,m,x),T=!1;if(f)if(d){let b=[I,L,G,P];ee(b,0,4,2,d,b,b),T=b[0]>b[2]}else T=I>G;let w=Math.PI,v=[],U=k+s===t;t=k,_=0,C=R,u=a[t],m=a[t+1];let F;if(U){E(),F=Math.atan2(m-g,u-y),T&&(F+=F>0?-w:w);let b=(G+I)/2,D=(P+L)/2;return v[0]=[b,D,(M-n)/2,F,i],v}i=i.replace(/\n/g," ");for(let b=0,D=i.length;b<D;){E();let Y=Math.atan2(m-g,u-y);if(T&&(Y+=Y>0?-w:w),F!==void 0){let q=Y-F;if(q+=q>w?-2*w:q<-w?2*w:0,Math.abs(q)>o)return null}F=Y;let A=b,W=0;for(;b<D;++b){let q=T?D-b-1:b,Ut=r*l(c,i[q],h);if(t+s<e&&C+_<n+W+Ut/2)break;W+=Ut}if(b===A)continue;let p=T?i.substring(D-A,D-b):i.substring(A,b);x=_===0?0:(n+W/2-C)/_;let kt=B(y,u,x),Mt=B(g,m,x);v.push([kt,Mt,W/2,Y,p]),n+=W}return v}var Et=_t(),dt=[],ht=[],at=[],ft=[];function us(a){return a[3].declutterBox}var gs=new RegExp("[\u0591-\u08FF\uFB1D-\uFDFF\uFE70-\uFEFC\u0800-\u0FFF\uE800-\uEFFF]");function je(a,t){return t==="start"?t=gs.test(a)?"right":"left":t==="end"&&(t=gs.test(a)?"left":"right"),Nt[t]}function Os(a,t,e){return e>0&&a.push(`
`,""),a.push(t,""),a}function Gs(a,t,e){return e%2===0&&(a+=t),a}var He=class{constructor(t,e,s,i,n){this.overlaps=s,this.pixelRatio=e,this.resolution=t,this.alignAndScaleFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=gt(),this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={},this.zIndexContext_=n?new is:null}getZIndexContext(){return this.zIndexContext_}createLabel(t,e,s,i){let n=t+e+s+i;if(this.labels_[n])return this.labels_[n];let o=i?this.strokeStates[i]:null,r=s?this.fillStates[s]:null,l=this.textStates[e],c=this.pixelRatio,h=[l.scale[0]*c,l.scale[1]*c],d=l.justify?Nt[l.justify]:je(Array.isArray(t)?t[0]:t,l.textAlign||vt),f=i&&o.lineWidth?o.lineWidth:0,u=Array.isArray(t)?t:String(t).split(`
`).reduce(Os,[]),{width:m,height:y,widths:g,heights:_,lineWidths:C}=ts(l,u),E=m+f,x=[],I=(E+2)*h[0],L=(y+f)*h[1],k={width:I<0?Math.floor(I):Math.ceil(I),height:L<0?Math.floor(L):Math.ceil(L),contextInstructions:x};(h[0]!=1||h[1]!=1)&&x.push("scale",h),i&&(x.push("strokeStyle",o.strokeStyle),x.push("lineWidth",f),x.push("lineCap",o.lineCap),x.push("lineJoin",o.lineJoin),x.push("miterLimit",o.miterLimit),x.push("setLineDash",[o.lineDash]),x.push("lineDashOffset",o.lineDashOffset)),s&&x.push("fillStyle",r.fillStyle),x.push("textBaseline","middle"),x.push("textAlign","center");let R=.5-d,M=d*E+R*f,G=[],P=[],T=0,w=0,v=0,U=0,F;for(let b=0,D=u.length;b<D;b+=2){let Y=u[b];if(Y===`
`){w+=T,T=0,M=d*E+R*f,++U;continue}let A=u[b+1]||l.font;A!==F&&(i&&G.push("font",A),s&&P.push("font",A),F=A),T=Math.max(T,_[v]);let W=[Y,M+R*g[v]+d*(g[v]-C[U]),.5*(f+T)+w];M+=g[v],i&&G.push("strokeText",W),s&&P.push("fillText",W),++v}return Array.prototype.push.apply(x,G),Array.prototype.push.apply(x,P),this.labels_[n]=k,k}replayTextBackground_(t,e,s,i,n,o,r){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,s),t.lineTo.apply(t,i),t.lineTo.apply(t,n),t.lineTo.apply(t,e),o&&(this.alignAndScaleFill_=o[2],t.fillStyle=o[1],this.fill_(t)),r&&(this.setStrokeStyle_(t,r),t.stroke())}calculateImageOrLabelDimensions_(t,e,s,i,n,o,r,l,c,h,d,f,u,m,y,g){r*=f[0],l*=f[1];let _=s-r,C=i-l,E=n+c>t?t-c:n,x=o+h>e?e-h:o,I=m[3]+E*f[0]+m[1],L=m[0]+x*f[1]+m[2],k=_-m[3],R=C-m[0];(y||d!==0)&&(dt[0]=k,ft[0]=k,dt[1]=R,ht[1]=R,ht[0]=k+I,at[0]=ht[0],at[1]=R+L,ft[1]=at[1]);let M;return d!==0?(M=xt(gt(),s,i,1,1,d,-s,-i),yt(M,dt),yt(M,ht),yt(M,at),yt(M,ft),Ft(Math.min(dt[0],ht[0],at[0],ft[0]),Math.min(dt[1],ht[1],at[1],ft[1]),Math.max(dt[0],ht[0],at[0],ft[0]),Math.max(dt[1],ht[1],at[1],ft[1]),Et)):Ft(Math.min(k,k+I),Math.min(R,R+L),Math.max(k,k+I),Math.max(R,R+L),Et),u&&(_=Math.round(_),C=Math.round(C)),{drawImageX:_,drawImageY:C,drawImageW:E,drawImageH:x,originX:c,originY:h,declutterBox:{minX:Et[0],minY:Et[1],maxX:Et[2],maxY:Et[3],value:g},canvasTransform:M,scale:f}}replayImageOrLabel_(t,e,s,i,n,o,r){let l=!!(o||r),c=i.declutterBox,h=r?r[2]*i.scale[0]/2:0;return c.minX-h<=e[0]&&c.maxX+h>=0&&c.minY-h<=e[1]&&c.maxY+h>=0&&(l&&this.replayTextBackground_(t,dt,ht,at,ft,o,r),es(t,i.canvasTransform,n,s,i.originX,i.originY,i.drawImageW,i.drawImageH,i.drawImageX,i.drawImageY,i.scale)),!0}fill_(t){let e=this.alignAndScaleFill_;if(e){let s=yt(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.save(),t.translate(s[0]%i,s[1]%i),e!==1&&t.scale(e,e),t.rotate(this.viewRotation_)}t.fill(),e&&t.restore()}setStrokeStyle_(t,e){t.strokeStyle=e[1],e[1]&&(t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.lineDashOffset=e[7],t.setLineDash(e[6]))}drawLabelWithPointPlacement_(t,e,s,i){let n=this.textStates[e],o=this.createLabel(t,e,i,s),r=this.strokeStates[s],l=this.pixelRatio,c=je(Array.isArray(t)?t[0]:t,n.textAlign||vt),h=Nt[n.textBaseline||Wt],d=r&&r.lineWidth?r.lineWidth:0,f=o.width/l-2*n.scale[0],u=c*f+2*(.5-c)*d,m=h*o.height/l+2*(.5-h)*d;return{label:o,anchorX:u,anchorY:m}}execute_(t,e,s,i,n,o,r,l){let c=this.zIndexContext_,h;this.pixelCoordinates_&&Jt(s,this.renderedTransform_)?h=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),h=Ct(this.coordinates,0,this.coordinates.length,2,s,this.pixelCoordinates_),bi(this.renderedTransform_,s));let d=0,f=i.length,u=0,m,y,g,_,C,E,x,I,L,k,R,M,G,P=0,T=0,w=this.coordinateCache_,v=this.viewRotation_,U=Math.round(Math.atan2(-s[1],s[0])*1e12)/1e12,F={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:v},b=this.instructions!=i||this.overlaps?0:200,D,Y,A,W;for(;d<f;){let p=i[d];switch(p[0]){case S.BEGIN_GEOMETRY:D=p[1],W=p[3],D.getGeometry()?r!==void 0&&!ct(r,W.getExtent())?d=p[2]+1:++d:d=p[2],c&&(c.zIndex=p[4]);break;case S.BEGIN_PATH:P>b&&(this.fill_(t),P=0),T>b&&(t.stroke(),T=0),!P&&!T&&(t.beginPath(),C=NaN,E=NaN),++d;break;case S.CIRCLE:u=p[1];let Mt=h[u],q=h[u+1],Ut=h[u+2],ms=h[u+3],qe=Ut-Mt,Ve=ms-q,Qe=Math.sqrt(qe*qe+Ve*Ve);t.moveTo(Mt+Qe,q),t.arc(Mt,q,Qe,0,2*Math.PI,!0),++d;break;case S.CLOSE_PATH:t.closePath(),++d;break;case S.CUSTOM:u=p[1],m=p[2];let _s=p[3],ys=p[4],$e=p[5];F.geometry=_s,F.feature=D,d in w||(w[d]=[]);let Rt=w[d];$e?$e(h,u,m,2,Rt):(Rt[0]=h[u],Rt[1]=h[u+1],Rt.length=2),c&&(c.zIndex=p[6]),ys(Rt,F),++d;break;case S.DRAW_IMAGE:u=p[1],m=p[2],L=p[3],y=p[4],g=p[5];let _e=p[6],xs=p[7],Cs=p[8],Ss=p[9],ti=p[10],ye=p[11],Is=p[12],Zt=p[13];_=p[14]||"declutter";let Tt=p[15];if(!L&&p.length>=20){k=p[19],R=p[20],M=p[21],G=p[22];let Z=this.drawLabelWithPointPlacement_(k,R,M,G);L=Z.label,p[3]=L;let ut=p[23];y=(Z.anchorX-ut)*this.pixelRatio,p[4]=y;let j=p[24];g=(Z.anchorY-j)*this.pixelRatio,p[5]=g,_e=L.height,p[6]=_e,Zt=L.width,p[13]=Zt}let xe;p.length>25&&(xe=p[25]);let Ce,jt,Ht;p.length>17?(Ce=p[16],jt=p[17],Ht=p[18]):(Ce=rt,jt=null,Ht=null),ti&&U?ye+=v:!ti&&!U&&(ye-=v);let Es=0;for(;u<m;u+=2){if(xe&&xe[Es++]<Zt/this.pixelRatio)continue;let Z=this.calculateImageOrLabelDimensions_(L.width,L.height,h[u],h[u+1],Zt,_e,y,g,Cs,Ss,ye,Is,n,Ce,!!jt||!!Ht,D),ut=[t,e,L,Z,xs,jt,Ht];if(l){let j,V,H;if(Tt){let O=m-u;if(!Tt[O]){Tt[O]={args:ut,declutterMode:_};continue}let X=Tt[O];j=X.args,V=X.declutterMode,delete Tt[O],H=us(j)}let it,st;if(j&&(V!=="declutter"||!l.collides(H))&&(it=!0),(_!=="declutter"||!l.collides(Z.declutterBox))&&(st=!0),V==="declutter"&&_==="declutter"){let O=it&&st;it=O,st=O}it&&(V!=="none"&&l.insert(H),this.replayImageOrLabel_.apply(this,j)),st&&(_!=="none"&&l.insert(Z.declutterBox),this.replayImageOrLabel_.apply(this,ut))}else this.replayImageOrLabel_.apply(this,ut)}++d;break;case S.DRAW_CHARS:let ei=p[1],ii=p[2],Se=p[3],Ls=p[4];G=p[5];let ks=p[6],si=p[7],ni=p[8];M=p[9];let Ie=p[10];k=p[11],Array.isArray(k)&&(k=k.reduce(Gs,"")),R=p[12];let oi=[p[13],p[13]];_=p[14]||"declutter";let Ms=p[15],Ee=this.textStates[R],bt=Ee.font,Dt=[Ee.scale[0]*si,Ee.scale[1]*si],wt;bt in this.widths_?wt=this.widths_[bt]:(wt={},this.widths_[bt]=wt);let ri=It(h,ei,ii,2),li=Math.abs(Dt[0])*Te(bt,k,wt);if(Ls||li<=ri){let Z=this.textStates[R].textAlign,ut=(ri-li)*je(k,Z),j=fs(h,ei,ii,2,k,ut,ks,Math.abs(Dt[0]),Te,bt,wt,U?0:this.viewRotation_,Ms);t:if(j){let V=[],H,it,st,O,X;if(M)for(H=0,it=j.length;H<it;++H){X=j[H],st=X[4],O=this.createLabel(st,R,"",M),y=X[2]+(Dt[0]<0?-Ie:Ie),g=Se*O.height+(.5-Se)*2*Ie*Dt[1]/Dt[0]-ni;let nt=this.calculateImageOrLabelDimensions_(O.width,O.height,X[0],X[1],O.width,O.height,y,g,0,0,X[3],oi,!1,rt,!1,D);if(l&&_==="declutter"&&l.collides(nt.declutterBox))break t;V.push([t,e,O,nt,1,null,null])}if(G)for(H=0,it=j.length;H<it;++H){X=j[H],st=X[4],O=this.createLabel(st,R,G,""),y=X[2],g=Se*O.height-ni;let nt=this.calculateImageOrLabelDimensions_(O.width,O.height,X[0],X[1],O.width,O.height,y,g,0,0,X[3],oi,!1,rt,!1,D);if(l&&_==="declutter"&&l.collides(nt.declutterBox))break t;V.push([t,e,O,nt,1,null,null])}l&&_!=="none"&&l.load(V.map(us));for(let nt=0,Rs=V.length;nt<Rs;++nt)this.replayImageOrLabel_.apply(this,V[nt])}}++d;break;case S.END_GEOMETRY:if(o!==void 0){D=p[1];let Z=o(D,W,_);if(Z)return Z}++d;break;case S.FILL:b?P++:this.fill_(t),++d;break;case S.MOVE_TO_LINE_TO:for(u=p[1],m=p[2],Y=h[u],A=h[u+1],t.moveTo(Y,A),C=Y+.5|0,E=A+.5|0,u+=2;u<m;u+=2)Y=h[u],A=h[u+1],x=Y+.5|0,I=A+.5|0,(u==m-2||x!==C||I!==E)&&(t.lineTo(Y,A),C=x,E=I);++d;break;case S.SET_FILL_STYLE:this.alignAndScaleFill_=p[2],P&&(this.fill_(t),P=0,T&&(t.stroke(),T=0)),t.fillStyle=p[1],++d;break;case S.SET_STROKE_STYLE:T&&(t.stroke(),T=0),this.setStrokeStyle_(t,p),++d;break;case S.STROKE:b?T++:t.stroke(),++d;break;default:++d;break}}P&&this.fill_(t),T&&t.stroke()}execute(t,e,s,i,n,o){this.viewRotation_=i,this.execute_(t,e,s,this.instructions,n,void 0,void 0,o)}executeHitDetection(t,e,s,i,n){return this.viewRotation_=s,this.execute_(t,[t.canvas.width,t.canvas.height],e,this.hitDetectionInstructions,!0,i,n)}},ps=He;var Lt=["Polygon","Circle","LineString","Image","Text","Default"],vs=["Image","Text"],Gr=Lt.filter(a=>!vs.includes(a)),Je=class{constructor(t,e,s,i,n,o,r){this.maxExtent_=t,this.overlaps_=i,this.pixelRatio_=s,this.resolution_=e,this.renderBuffer_=o,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=gt(),this.renderedContext_=null,this.deferredZIndexContexts_={},this.createExecutors_(n,r)}clip(t,e){let s=this.getClipCoords(e);t.beginPath(),t.moveTo(s[0],s[1]),t.lineTo(s[2],s[3]),t.lineTo(s[4],s[5]),t.lineTo(s[6],s[7]),t.clip()}createExecutors_(t,e){for(let s in t){let i=this.executorsByZIndex_[s];i===void 0&&(i={},this.executorsByZIndex_[s]=i);let n=t[s];for(let o in n){let r=n[o];i[o]=new ps(this.resolution_,this.pixelRatio_,this.overlaps_,r,e)}}}hasExecutors(t){for(let e in this.executorsByZIndex_){let s=this.executorsByZIndex_[e];for(let i=0,n=t.length;i<n;++i)if(t[i]in s)return!0}return!1}forEachFeatureAtCoordinate(t,e,s,i,n,o){i=Math.round(i);let r=i*2+1,l=xt(this.hitDetectionTransform_,i+.5,i+.5,1/e,-1/e,-s,-t[0],-t[1]),c=!this.hitDetectionContext_;c&&(this.hitDetectionContext_=Gt(r,r));let h=this.hitDetectionContext_;h.canvas.width!==r||h.canvas.height!==r?(h.canvas.width=r,h.canvas.height=r):c||h.clearRect(0,0,r,r);let d;this.renderBuffer_!==void 0&&(d=_t(),Ei(d,t),Qt(d,e*(this.renderBuffer_+i),d));let f=Ws(i),u;function m(I,L,k){let R=h.getImageData(0,0,r,r).data;for(let M=0,G=f.length;M<G;M++)if(R[f[M]]>0){if(!o||k==="none"||u!=="Image"&&u!=="Text"||o.includes(I)){let P=(f[M]-3)/4,T=i-P%r,w=i-(P/r|0),v=n(I,L,T*T+w*w);if(v)return v}h.clearRect(0,0,r,r);break}}let y=Object.keys(this.executorsByZIndex_).map(Number);y.sort(mt);let g,_,C,E,x;for(g=y.length-1;g>=0;--g){let I=y[g].toString();for(C=this.executorsByZIndex_[I],_=Lt.length-1;_>=0;--_)if(u=Lt[_],E=C[u],E!==void 0&&(x=E.executeHitDetection(h,l,s,m,d),x))return x}}getClipCoords(t){let e=this.maxExtent_;if(!e)return null;let s=e[0],i=e[1],n=e[2],o=e[3],r=[s,i,s,o,n,o,n,i];return Ct(r,0,8,2,t,r),r}isEmpty(){return fi(this.executorsByZIndex_)}execute(t,e,s,i,n,o,r){let l=Object.keys(this.executorsByZIndex_).map(Number);l.sort(r?ai:mt),o=o||Lt;let c=Lt.length;for(let h=0,d=l.length;h<d;++h){let f=l[h].toString(),u=this.executorsByZIndex_[f];for(let m=0,y=o.length;m<y;++m){let g=o[m],_=u[g];if(_!==void 0){let C=r===null?void 0:_.getZIndexContext(),E=C?C.getContext():t,x=this.maxExtent_&&g!=="Image"&&g!=="Text";if(x&&(E.save(),this.clip(E,s)),!C||g==="Text"||g==="Image"?_.execute(E,e,s,i,n,r):C.pushFunction(I=>_.execute(I,e,s,i,n,r)),x&&E.restore(),C){C.offset();let I=l[h]*c+Lt.indexOf(g);this.deferredZIndexContexts_[I]||(this.deferredZIndexContexts_[I]=[]),this.deferredZIndexContexts_[I].push(C)}}}}this.renderedContext_=t}getDeferredZIndexContexts(){return this.deferredZIndexContexts_}getRenderedContext(){return this.renderedContext_}renderDeferred(){let t=this.deferredZIndexContexts_,e=Object.keys(t).map(Number).sort(mt);for(let s=0,i=e.length;s<i;++s)t[e[s]].forEach(n=>{n.draw(this.renderedContext_),n.clear()}),t[e[s]].length=0}},ze={};function Ws(a){if(ze[a]!==void 0)return ze[a];let t=a*2+1,e=a*a,s=new Array(e+1);for(let n=0;n<=a;++n)for(let o=0;o<=a;++o){let r=n*n+o*o;if(r>e)break;let l=s[r];l||(l=[],s[r]=l),l.push(((a+n)*t+(a+o))*4+3),n>0&&l.push(((a-n)*t+(a+o))*4+3),o>0&&(l.push(((a+n)*t+(a-o))*4+3),n>0&&l.push(((a-n)*t+(a-o))*4+3))}let i=[];for(let n=0,o=s.length;n<o;++n)s[n]&&i.push(...s[n]);return ze[a]=i,i}var vr=Je;var Kt=.5;function zr(a,t,e,s,i,n,o,r,l){let c=l?Ti(i,l):i,h=a[0]*Kt,d=a[1]*Kt,f=Gt(h,d);f.imageSmoothingEnabled=!1;let u=f.canvas,m=new ns(f,Kt,i,null,o,r,l?Mi(Ri(),l):null),y=e.length,g=Math.floor((256*256*256-1)/y),_={};for(let E=1;E<=y;++E){let x=e[E-1],I=x.getStyleFunction()||s;if(!I)continue;let L=I(x,n);if(!L)continue;Array.isArray(L)||(L=[L]);let R=(E*g).toString(16).padStart(7,"#00000");for(let M=0,G=L.length;M<G;++M){let P=L[M],T=P.getGeometryFunction()(x);if(!T||!ct(c,T.getExtent()))continue;let w=P.clone(),v=w.getFill();v&&v.setColor(R);let U=w.getStroke();U&&(U.setColor(R),U.setLineDash(null)),w.setText(void 0);let F=P.getImage();if(F){let A=F.getImageSize();if(!A)continue;let W=Gt(A[0],A[1],void 0,{alpha:!1}),p=W.canvas;W.fillStyle=R,W.fillRect(0,0,p.width,p.height),w.setImage(new be({img:p,anchor:F.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:F.getOrigin(),opacity:1,size:F.getSize(),scale:F.getScale(),rotation:F.getRotation(),rotateWithView:F.getRotateWithView()}))}let b=w.getZIndex()||0,D=_[b];D||(D={},_[b]=D,D.Polygon=[],D.Circle=[],D.LineString=[],D.Point=[]);let Y=T.getType();if(Y==="GeometryCollection"){let A=T.getGeometriesArrayRecursive();for(let W=0,p=A.length;W<p;++W){let kt=A[W];D[kt.getType().replace("Multi","")].push(kt,w)}}else D[Y.replace("Multi","")].push(T,w)}}let C=Object.keys(_).map(Number).sort(mt);for(let E=0,x=C.length;E<x;++E){let I=_[C[E]];for(let L in I){let k=I[L];for(let R=0,M=k.length;R<M;R+=2){m.setStyle(k[R+1]);for(let G=0,P=t.length;G<P;++G)m.setTransform(t[G]),m.drawGeometry(k[R])}}}return f.getImageData(0,0,u.width,u.height)}function Jr(a,t,e){let s=[];if(e){let i=Math.floor(Math.round(a[0])*Kt),n=Math.floor(Math.round(a[1])*Kt),o=(ke(i,0,e.width-1)+ke(n,0,e.height-1)*e.width)*4,r=e.data[o],l=e.data[o+1],h=e.data[o+2]+256*(l+256*r),d=Math.floor((256*256*256-1)/t.length);h&&h%d===0&&s.push(t[h/d-1])}return s}export{Ks as a,Js as b,bs as c,pe as d,Ds as e,Ge as f,ws as g,ur as h,Lt as i,vs as j,Gr as k,vr as l,Kt as m,zr as n,Jr as o,Fs as p,ko as q,Eo as r};
