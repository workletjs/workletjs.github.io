import{c as b}from"./chunk-HGPPLZLH.js";import{a as F}from"./chunk-25A3ZCYP.js";import{K as y,a as c,wa as D,z as h}from"./chunk-SFR7ATWH.js";import{ba as p,c as l,j as f,ja as C,m,x as g}from"./chunk-GF377ULF.js";var u=class extends b{constructor(t){t=t||{},super({attributions:t.attributions,wrapX:t.wrapX}),this.resolution=void 0,this.distance=t.distance!==void 0?t.distance:20,this.minDistance=t.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=t.geometryFunction||function(i){let e=i.getGeometry();return y(!e||e.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),e},this.createCustomCluster_=t.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(t.source||null)}clear(t){this.features.length=0,super.clear(t)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(t,i,e){this.source?.loadFeatures(t,i,e),i!==this.resolution&&(this.resolution=i,this.refresh())}setDistance(t){this.updateDistance(t,this.minDistance)}setMinDistance(t){this.updateDistance(this.distance,t)}getMinDistance(){return this.minDistance}setSource(t){this.source&&this.source.removeEventListener(c.CHANGE,this.boundRefresh_),this.source=t,t&&t.addEventListener(c.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(t,i){let e=t===0?0:Math.min(i,t)/t,s=t!==this.distance||this.interpolationRatio!==e;this.distance=t,this.minDistance=i,this.interpolationRatio=e,s&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;let t=f(),i=this.distance*this.resolution,e=this.source.getFeatures(),s={};for(let r=0,a=e.length;r<a;r++){let n=e[r];if(!(h(n)in s)){let o=this.geometryFunction(n);if(o){let E=o.getCoordinates();m(E,t),l(t,i,t);let R=this.source.getFeaturesInExtent(t).filter(function(_){let d=h(_);return d in s?!1:(s[d]=!0,!0)});this.features.push(this.createCluster(R,t))}}}}createCluster(t,i){let e=[0,0];for(let n=t.length-1;n>=0;--n){let o=this.geometryFunction(t[n]);o?p(e,o.getCoordinates()):t.splice(n,1)}C(e,1/t.length);let s=g(i),r=this.interpolationRatio,a=new D([e[0]*(1-r)+s[0]*r,e[1]*(1-r)+s[1]*r]);return this.createCustomCluster_?this.createCustomCluster_(a,t):new F({geometry:a,features:t})}},H=u;export{H as a};
