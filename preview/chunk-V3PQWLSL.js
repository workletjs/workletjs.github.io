import{a as U}from"./chunk-DSYGDK3G.js";import{b as R}from"./chunk-CY3RY32P.js";import{f as w,g as F}from"./chunk-BB5FRUMW.js";import{jc as Z}from"./chunk-UQ7WN6WM.js";import{m as y,v}from"./chunk-X3B7ZQOC.js";import{G as j,L as P}from"./chunk-O23OEJHM.js";function M(l){let e=l[0],t=new Array(e),r=1<<e-1,i,a;for(i=0;i<e;++i)a=48,l[1]&r&&(a+=1),l[2]&r&&(a+=2),t[i]=String.fromCharCode(a),r>>=1;return t.join("")}var O='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>',S=class extends U{constructor(e){let t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:y("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;let r="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(r).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}let t=e.resourceSets[0].resources[0],r=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,i=this.getProjection(),a=F(i),u=this.hidpi_?2:1,A=t.imageWidth==t.imageHeight?t.imageWidth/u:[t.imageWidth/u,t.imageHeight/u],I=w({extent:a,minZoom:t.zoomMin,maxZoom:r,tileSize:A});this.tileGrid=I;let K=this.culture_,k=this.hidpi_,x=this.placeholderTiles_;if(this.tileUrlFunction=R(t.imageUrlSubdomains.map(function(h){let n=[0,0,0],c=t.imageUrl.replace("{subdomain}",h).replace("{culture}",K);return(function(o,d,T){if(!o)return;Z(o[0],o[1],o[2],n);let g=new URL(c.replace("{quadkey}",M(n))),s=g.searchParams;return k&&(s.set("dpi","d1"),s.set("device","mobile")),x===!0?s.delete("n"):x===!1&&s.set("n","z"),g.toString()})})),t.imageryProviders){let h=v(y("EPSG:4326"),this.getProjection());this.setAttributions(n=>{let c=[],o=n.viewState,d=this.getTileGrid(),T=d.getZForResolution(o.resolution,this.zDirection),s=d.getTileCoordForCoordAndZ(o.center,T)[0];return t.imageryProviders.map(function(_){let z=!1,b=_.coverageAreas;for(let f=0,C=b.length;f<C;++f){let p=b[f];if(s>=p.zoomMin&&s<=p.zoomMax){let m=p.bbox,E=[m[1],m[0],m[3],m[2]],G=P(E,h);if(j(G,n.extent)){z=!0;break}}}z&&c.push(_.attribution)}),c.push(O),c})}this.setState("ready")}},N=S;export{N as a};
