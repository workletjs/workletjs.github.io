import{k as j,l as F,m as L,o as R}from"./chunk-UAJFUYMQ.js";import{La as N}from"./chunk-7DTCWPUW.js";import{O as M,Q as y,W as v,la as G}from"./chunk-WEL5MCWD.js";function D(n,t){let s=n.length;return t<0?n[t+s]:t>=s?n[t-s]:n[t]}function p(n,t){let s=n.length,e=Math.floor(t),o=t-e;e>=s?e-=s:e<0&&(e+=s);let i=e+1;i>=s&&(i-=s);let a=n[e],f=a[0],r=a[1],c=n[i],g=c[0]-f,l=c[1]-r;return[f+g*o,r+l*o]}var T={index:-1,endIndex:NaN,closestTargetDistance:1/0};function A(n,t,s,e){let o=n[0],i=n[1],a=1/0,f=-1,r=NaN;for(let l=0;l<t.targets.length;++l){let d=t.targets[l],u=d.coordinates,x=1/0,h;for(let I=0;I<u.length-1;++I){let B=u[I],E=u[I+1],q=W(o,i,B,E);q.squaredDistance<x&&(x=q.squaredDistance,h=I+q.along)}x<a&&(a=x,d.ring&&t.targetIndex===l&&(d.endIndex>d.startIndex?h<d.startIndex&&(h+=u.length):d.endIndex<d.startIndex&&h>d.startIndex&&(h-=u.length)),r=h,f=l)}let c=t.targets[f],g=c.ring;if(t.targetIndex===f&&g){let l=p(c.coordinates,r),d=s.getPixelFromCoordinate(l),u=s.getPixelFromCoordinate(t.startCoord);G(d,u)>e&&(g=!1)}if(g){let l=c.coordinates,d=l.length,u=c.startIndex,x=r;if(u<x){let h=w(l,u,x);w(l,u,x-d)<h&&(r-=d)}else{let h=w(l,u,x);w(l,u,x+d)<h&&(r+=d)}}return T.index=f,T.endIndex=r,T.closestTargetDistance=a,T}function H(n,t){let s=[];for(let e=0;e<t.length;++e){let i=t[e].getGeometry();U(n,i,s)}return s}function U(n,t,s){if(t instanceof F){C(n,t.getCoordinates(),!1,s);return}if(t instanceof L){let e=t.getCoordinates();for(let o=0,i=e.length;o<i;++o)C(n,e[o],!1,s);return}if(t instanceof N){let e=t.getCoordinates();for(let o=0,i=e.length;o<i;++o)C(n,e[o],!0,s);return}if(t instanceof R){let e=t.getCoordinates();for(let o=0,i=e.length;o<i;++o){let a=e[o];for(let f=0,r=a.length;f<r;++f)C(n,a[f],!0,s)}return}if(t instanceof j){let e=t.getGeometries();for(let o=0;o<e.length;++o)U(n,e[o],s);return}}function C(n,t,s,e){let o=n[0],i=n[1];for(let a=0,f=t.length-1;a<f;++a){let r=t[a],c=t[a+1],g=W(o,i,r,c);if(g.squaredDistance===0){let l=a+g.along;e.push({coordinates:t,ring:s,startIndex:l,endIndex:l});return}}}function m(n,t){return y(n[0],n[1],t[0],t[1])}function w(n,t,s){let e,o;t<s?(e=t,o=s):(e=s,o=t);let i=Math.ceil(e),a=Math.floor(o);if(i>a){let r=p(n,e),c=p(n,o);return m(r,c)}let f=0;if(e<i){let r=p(n,e),c=D(n,i);f+=m(r,c)}if(a<o){let r=D(n,a),c=p(n,o);f+=m(r,c)}for(let r=i;r<a-1;++r){let c=D(n,r),g=D(n,r+1);f+=m(c,g)}return f}var P={along:0,squaredDistance:0};function W(n,t,s,e){let o=s[0],i=s[1],a=e[0],f=e[1],r=a-o,c=f-i,g=0,l=o,d=i;return(r!==0||c!==0)&&(g=M(((n-o)*r+(t-i)*c)/(r*r+c*c),0,1),l+=r*g,d+=c*g),P.along=g,P.squaredDistance=v(y(n,t,l,d),10),P}export{D as a,p as b,A as c,H as d};
