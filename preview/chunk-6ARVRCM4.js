import{a as w}from"./chunk-FWXMKCRU.js";import{Kb as p,Ob as A,Yb as E,k as c,q as C,vb as o}from"./chunk-IV3CZHWS.js";import{C as h,z as T}from"./chunk-L76X3E7P.js";var d={TRANSLATESTART:"translatestart",TRANSLATING:"translating",TRANSLATEEND:"translateend"},s=class extends C{constructor(t,e,r,a,n){super(t),this.features=e,this.coordinate=r,this.startCoordinate=a,this.mapBrowserEvent=n}},u=class extends E{constructor(t){t=t||{},super(t),this.on,this.once,this.un,this.lastCoordinate_=null,this.startCoordinate_=null,this.features_=t.features!==void 0?t.features:null;let e;if(t.layers&&!this.features_)if(typeof t.layers=="function")e=t.layers;else{let r=t.layers;e=function(a){return r.includes(a)}}else e=c;this.layerFilter_=e,this.filter_=t.filter&&!this.features_?t.filter:c,this.hitTolerance_=t.hitTolerance?t.hitTolerance:0,this.condition_=t.condition?t.condition:A,this.lastFeature_=null,this.addChangeListener(p.ACTIVE,this.handleActiveChanged_)}handleDownEvent(t){if(!t.originalEvent||!this.condition_(t))return!1;if(this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map),!this.lastCoordinate_&&this.lastFeature_){this.startCoordinate_=t.coordinate,this.lastCoordinate_=t.coordinate,this.handleMoveEvent(t);let e=this.features_||new o([this.lastFeature_]);return this.dispatchEvent(new s(d.TRANSLATESTART,e,t.coordinate,this.startCoordinate_,t)),!0}return!1}handleUpEvent(t){if(this.lastCoordinate_){this.lastCoordinate_=null,this.handleMoveEvent(t);let e=this.features_||new o([this.lastFeature_]);return this.dispatchEvent(new s(d.TRANSLATEEND,e,t.coordinate,this.startCoordinate_,t)),this.startCoordinate_=null,!0}return!1}handleDragEvent(t){if(this.lastCoordinate_){let e=t.coordinate,r=t.map.getView().getProjection(),a=h(e,r),n=h(this.lastCoordinate_,r),f=a[0]-n[0],_=a[1]-n[1],m=this.features_||new o([this.lastFeature_]),l=T();m.forEach(function(g){let i=g.getGeometry();l?(i.transform(l,r),i.translate(f,_),i.transform(r,l)):i.translate(f,_),g.setGeometry(i)}),this.lastCoordinate_=e,this.dispatchEvent(new s(d.TRANSLATING,m,e,this.startCoordinate_,t))}}handleMoveEvent(t){let e=t.map.getViewport();this.featuresAtPixel_(t.pixel,t.map)?(e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing"),e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")):e.classList.remove("ol-grab","ol-grabbing")}featuresAtPixel_(t,e){return e.forEachFeatureAtPixel(t,(r,a)=>{if(!(!(r instanceof w)||!this.filter_(r,a))&&!(this.features_&&!this.features_.getArray().includes(r)))return r},{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})}getHitTolerance(){return this.hitTolerance_}setHitTolerance(t){this.hitTolerance_=t}setMap(t){let e=this.getMap();super.setMap(t),this.updateState_(e)}handleActiveChanged_(){this.updateState_(null)}updateState_(t){let e=this.getMap(),r=this.getActive();(!e||!r)&&(e=e||t,e&&e.getViewport().classList.remove("ol-grab","ol-grabbing"))}},v=u;export{v as a};
