import{a as d,b as G,c as m}from"./chunk-VY76MBEC.js";import{a as F}from"./chunk-SGTWW3EY.js";import{a as S}from"./chunk-OHB4K6Y4.js";import{Fc as b,Oc as y}from"./chunk-7GOL55Z2.js";import{m as j,x as T}from"./chunk-XGVPHTK5.js";import{U as P,aa as R,c as g,j as E}from"./chunk-GF377ULF.js";var f=class extends F{constructor(e){e=e||{};let t=Object.assign({},e.params);super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.params_=t,this.v13_=!0,this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=E(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(e,t,s,r){let a=j(s),i=this.getProjection()||a,n=this.getTileGrid();n||(n=this.getTileGridForProjection(i));let o=T(e,a,i),O=b(i,a,e,t),_=n.getZForResolution(O,this.zDirection),h=n.getResolution(_),c=n.getTileCoordForCoordAndZ(o,_);if(n.getResolutions().length<=c[0])return;let u=n.getTileCoordExtent(c,this.tmpExtent_),p=this.gutter_;p!==0&&(u=g(u,h*p,u));let l={QUERY_LAYERS:this.params_.LAYERS};Object.assign(l,m(this.params_,"GetFeatureInfo"),r);let L=Math.floor((o[0]-u[0])/h),x=Math.floor((u[3]-o[1])/h);return l[this.v13_?"I":"X"]=L,l[this.v13_?"J":"Y"]=x,this.getRequestUrl_(c,u,1,i||a,l)}getLegendUrl(e,t){if(this.urls[0]===void 0)return;let s={SERVICE:"WMS",VERSION:d,REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(t===void 0||t.LAYER===void 0){let r=this.params_.LAYERS;if(!(!Array.isArray(r)||r.length===1))return;s.LAYER=r}if(e!==void 0){let r=this.getProjection()?this.getProjection().getMetersPerUnit():1,a=28e-5;s.SCALE=e*r/a}return Object.assign(s,t),S(this.urls[0],s)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(e,t,s,r,a){let i=this.urls;if(!i)return;let n;if(i.length==1)n=i[0];else{let o=P(y(e),i.length);n=i[o]}return G(t,(this.tileGrid||this.getTileGridForProjection(r)).getResolution(e[0]),s,r,n,a,this.serverType_)}getTilePixelRatio(e){return!this.hidpi_||this.serverType_===void 0?1:e}getKeyForParams_(){let e=0,t=[];for(let s in this.params_)t[e++]=s+"-"+this.params_[s];return t.join("/")}setParams_(e){this.params_=e,this.updateV13_(),this.setKey(this.getKeyForParams_())}setParams(e){this.setParams_(Object.assign({},e))}updateParams(e){this.setParams_(Object.assign(this.params_,e))}updateV13_(){let e=this.params_.VERSION||d;this.v13_=R(e,"1.3")>=0}tileUrlFunction(e,t,s){let r=this.getTileGrid();if(r||(r=this.getTileGridForProjection(s)),r.getResolutions().length<=e[0])return;t!=1&&(!this.hidpi_||this.serverType_===void 0)&&(t=1);let a=r.getResolution(e[0]),i=r.getTileCoordExtent(e,this.tmpExtent_),n=this.gutter_;n!==0&&(i=g(i,a*n,i));let o=Object.assign({},m(this.params_,"GetMap"));return this.getRequestUrl_(e,i,t,s,o)}},q=f;export{q as a};
