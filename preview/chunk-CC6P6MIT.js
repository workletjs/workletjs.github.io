import{a as ut,b as ht}from"./chunk-6PTLX6LV.js";import{a as tt,c as se,e as rt,f as J,g as it,h as ot,l as st,m as lt,n as at,o as dt,p as ae,q as ct}from"./chunk-QNA77T2Y.js";import{d as nt,f as le}from"./chunk-7QR5DJ7U.js";import{d as et}from"./chunk-45VHQ4GC.js";import{a as Ye,b as H,c as qe,e as $e,g as Je,h as Qe}from"./chunk-XSNNSIR3.js";import{Ab as q,K as R,L as Ge,La as Ae,Ma as je,N as B,P as ke,Q as ne,R as Ne,Sc as Xe,T as Be,Ua as ze,V as K,Va as Ke,W as Ue,a as oe,d as be,oc as He,v as Oe,wc as We,xa as Ze,xc as $,z as _}from"./chunk-H4U5SDNF.js";import{e as Ie,h as Ve,m as _e,u as L,w as Le,y as U}from"./chunk-L76X3E7P.js";import{C as Y,D as ve,G,b as Ce,c as N,g as Pe,o as Me,pa as De}from"./chunk-WEL5MCWD.js";import{Aa as Re,Ba as Fe,P as me,S as X,Sb as k,Tb as v,Wb as I,_ as pe,fa as ye,kb as Se,lb as Ee,ra as Te}from"./chunk-DTKK3HU7.js";var Et={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},gt={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]},de=class extends Ye{constructor(e,t){super(e,t),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.renderedOpacity_=1,this.tmpTransform_=ke(),this.tileClipContexts_=null}enqueueTilesForNextExtent(){return this.getLayer().getRenderMode()!=="vector"}drawTile(e,t,r,i,n,s,c,l){this.updateExecutorGroup_(e,t.pixelRatio,t.viewState.projection),this.tileImageNeedsRender_(e)&&this.renderTileImage_(e,t),super.drawTile(e,t,r,i,n,s,c,l)}getTile(e,t,r,i){let n=this.getOrCreateTile(e,t,r,i);if(!n)return null;let s=i.viewState,c=s.resolution,l=i.viewHints,a=this.getLayer().getSource(),d=a.getTileGridForProjection(s.projection),u=!(l[B.ANIMATING]||l[B.INTERACTING]),h=d.getZForResolution(c,a.zDirection)===e;return u&&h?n.wantedResolution=c:n.wantedResolution||(n.wantedResolution=d.getResolution(e)),n}prepareFrame(e){let t=this.getLayer().getRevision();return this.renderedLayerRevision_!==t&&(this.renderedLayerRevision_=t,this.renderedTiles.length=0),super.prepareFrame(e)}updateExecutorGroup_(e,t,r){let i=this.getLayer(),n=i.getRevision(),s=i.getRenderOrder()||null,c=e.wantedResolution,l=e.getReplayState(i);if(!l.dirty&&l.renderedResolution===c&&l.renderedRevision==n&&l.renderedRenderOrder==s)return;let a=i.getSource(),d=!!i.getDeclutter(),u=a.getTileGrid(),m=a.getTileGridForProjection(r).getTileCoordExtent(e.wrappedTileCoord),g=a.getSourceTiles(t,r,e),x=_(i);delete e.hitDetectionImageData[x],e.executorGroups[x]=[],l.dirty=!1;for(let f=0,T=g.length;f<T;++f){let p=g[f];if(p.getState()!=R.LOADED)continue;let w=a.getProjection(),F=p.tileCoord,y=u.getTileCoordExtent(F);r&&w&&!L(r,w)&&(y=U(y,w,r,32));let E=Y(m,y),S=N(E,i.getRenderBuffer()*c,this.tempExtent),V=Me(y,E)?null:S,b=new tt(0,E,c,t),A=nt(c,t),M=function(C,ie){let O,we=C.getStyleFunction()||i.getStyleFunction();if(we&&(O=we(C,c)),O){let St=this.renderFeature(C,A,O,b,d,ie);l.dirty=l.dirty||St}},P=p.getFeatures();s&&s!==l.renderedRenderOrder&&P.sort(s);for(let C=0,ie=P.length;C<ie;++C){let O=P[C];r&&p.projection&&!L(r,p.projection)&&(O=O.clone(),O.getGeometry().applyTransform(Le(p.projection,r))),(!V||G(V,O.getGeometry().getExtent()))&&M.call(this,O,C)}let j=b.finish(),D=i.getRenderMode()!=="vector"&&d&&g.length===1?null:E,z=new rt(D,c,t,a.getOverlaps(),j,i.getRenderBuffer(),!0);e.executorGroups[x].push(z)}l.renderedRevision=n,l.renderedRenderOrder=s,l.renderedResolution=c}forEachFeatureAtCoordinate(e,t,r,i,n){let s=t.viewState.resolution,c=t.viewState.rotation;r=r??0;let l=this.getLayer(),d=l.getSource().getTileGridForProjection(t.viewState.projection),u=Ce([e]);N(u,s*r,u);let h={},m=function(w,F,y){let E=w.getId();E===void 0&&(E=_(w));let S=h[E];if(S){if(S!==!0&&y<S.distanceSq){if(y===0)return h[E]=!0,n.splice(n.lastIndexOf(S),1),i(w,l,F);S.geometry=F,S.distanceSq=y}}else{if(y===0)return h[E]=!0,i(w,l,F);n.push(h[E]={feature:w,layer:l,geometry:F,distanceSq:y,callback:i})}},g=this.renderedTiles,x=_(l),f=l.getDeclutter(),T=f?t.declutter?.[f]?.all().map(w=>w.value):null,p;e:for(let w=0,F=g.length;w<F;++w){let y=g[w],E=d.getTileCoordExtent(y.wrappedTileCoord);if(!G(E,u))continue;let S=y.executorGroups[x];for(let V=0,b=S.length;V<b;++V)if(p=S[V].forEachFeatureAtCoordinate(e,s,c,r,m,T),p)break e}return p}getFeatures(e){return this.renderedTiles.length===0?Promise.resolve([]):new Promise((t,r)=>{let i=this.getLayer(),n=i.getSource(),s=this.renderedProjection,c=s.getExtent(),l=this.renderedResolution,a=n.getTileGridForProjection(s),d=Be(this.renderedPixelToCoordinateTransform_,e.slice()),u=a.getTileCoordForCoordAndResolution(d,l).toString(),h=this.renderedTiles.find(w=>w.tileCoord.toString()===u&&w.getState()===R.LOADED);if(!h||h.loadingSourceTiles>0){t([]);return}n.getWrapX()&&s.canWrapX()&&!Pe(c,a.getTileCoordExtent(h.tileCoord))&&De(d,s);let m=_(i),g=a.getTileCoordExtent(h.wrappedTileCoord),x=ve(g),f=[(d[0]-x[0])/l,(x[1]-d[1])/l],T=h.getSourceTiles().reduce((w,F)=>w.concat(F.getFeatures()),[]),p=h.hitDetectionImageData[m];if(!p){let w=q(a.getTileSize(a.getZForResolution(l,n.zDirection))),F=this.renderedRotation_,y=[this.getRenderTransform(a.getTileCoordCenter(h.wrappedTileCoord),l,0,J,w[0]*J,w[1]*J,0)];p=it(w,y,T,i.getStyleFunction(),a.getTileCoordExtent(h.wrappedTileCoord),h.getReplayState(i).renderedResolution,F),h.hitDetectionImageData[m]=p}t(ot(f,T,p))})}getFeaturesInExtent(e){let t=[],r=this.getTileCache();if(r.getCount()===0)return t;let n=this.getLayer().getSource().getTileGridForProjection(this.frameState.viewState.projection),s=n.getZForResolution(this.renderedResolution),c={};return r.forEach(l=>{if(l.tileCoord[0]!==s||l.getState()!==R.LOADED)return;let a=l.getSourceTiles();for(let d=0,u=a.length;d<u;++d){let h=a[d],m=h.getKey();if(m in c)continue;c[m]=!0;let g=h.tileCoord;if(G(e,n.getTileCoordExtent(g))){let x=h.getFeatures();if(x)for(let f=0,T=x.length;f<T;++f){let p=x[f],w=p.getGeometry();G(e,w.getExtent())&&t.push(p)}}}}),t}handleFontsChanged(){let e=this.getLayer();e.getVisible()&&this.renderedLayerRevision_!==void 0&&e.changed()}handleStyleImageChange_(e){this.renderIfReadyAndVisible()}renderDeclutter(e,t){let r=this.context,i=r.globalAlpha;r.globalAlpha=t.opacity;let n=e.viewHints,s=!(n[B.ANIMATING]||n[B.INTERACTING]),c=[this.context.canvas.width,this.context.canvas.height],l=this.getLayer().getDeclutter(),a=l?e.declutter?.[l]:void 0,d=_(this.getLayer()),u=this.renderedTiles;for(let h=0,m=u.length;h<m;++h){let g=u[h],x=g.executorGroups[d];if(x)for(let f=x.length-1;f>=0;--f)x[f].execute(this.context,c,this.getTileRenderTransform(g,e),e.viewState.rotation,s,se,a)}r.globalAlpha=i}renderDeferredInternal(e){let t=this.renderedTiles,r=_(this.getLayer()),i=t.reduce((l,a,d)=>(a.executorGroups[r].forEach(u=>l.push({executorGroup:u,index:d})),l),[]),n=i.map(({executorGroup:l})=>l.getDeferredZIndexContexts()),s={};for(let l=0,a=i.length;l<a;++l){let d=i[l].executorGroup.getDeferredZIndexContexts();for(let u in d)s[u]=!0}Object.keys(s).map(Number).sort(be).forEach(l=>{n.forEach((a,d)=>{a[l]&&(a[l].forEach(u=>{let{executorGroup:h,index:m}=i[d],g=h.getRenderedContext(),x=g.globalAlpha;g.globalAlpha=this.renderedOpacity_;let f=this.tileClipContexts_[m];f&&f.draw(g),u.draw(g),f&&g.restore(),g.globalAlpha=x,u.clear()}),a[l].length=0)})})}getTileRenderTransform(e,t){let r=t.pixelRatio,i=t.viewState,n=i.center,s=i.resolution,c=i.rotation,l=t.size,a=Math.round(l[0]*r),d=Math.round(l[1]*r),h=this.getLayer().getSource().getTileGridForProjection(t.viewState.projection),m=e.tileCoord,g=h.getTileCoordExtent(e.wrappedTileCoord),x=h.getTileCoordExtent(m,this.tempExtent)[0]-g[0];return Ne(K(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(n,s,c,r,a,d,x))}postRender(e,t){let r=t.viewHints,i=!(r[B.ANIMATING]||r[B.INTERACTING]);this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation,this.renderedOpacity_=t.layerStatesArray[t.layerIndex].opacity;let n=this.getLayer(),s=n.getRenderMode(),c=e.globalAlpha;e.globalAlpha=this.renderedOpacity_;let l=n.getDeclutter(),a=l?gt[s].filter(y=>!se.includes(y)):gt[s],d=t.viewState,u=d.rotation,h=n.getSource(),g=h.getTileGridForProjection(d.projection).getZForResolution(d.resolution,h.zDirection),x=this.renderedTiles,f=[],T=[],p=[],w=_(n),F=!0;for(let y=x.length-1;y>=0;--y){let E=x[y];F=F&&!E.getReplayState(n).dirty;let S=E.executorGroups[w].filter(D=>D.hasExecutors(a));if(S.length===0)continue;let V=this.getTileRenderTransform(E,t),b=E.tileCoord[0],A=!1,M=S[0].getClipCoords(V),P=e,j;if(M){j=new Xe,P=j.getContext();for(let D=0,z=f.length;D<z;++D)if(g!==b&&b<T[D]){let C=f[D];G([M[0],M[3],M[4],M[7]],[C[0],C[3],C[4],C[7]])&&(A||(P.save(),A=!0),P.beginPath(),P.moveTo(M[0],M[1]),P.lineTo(M[2],M[3]),P.lineTo(M[4],M[5]),P.lineTo(M[6],M[7]),P.moveTo(C[6],C[7]),P.lineTo(C[4],C[5]),P.lineTo(C[2],C[3]),P.lineTo(C[0],C[1]),P.clip())}f.push(M),T.push(b)}for(let D=0,z=S.length;D<z;++D)S[D].execute(e,[e.canvas.width,e.canvas.height],V,u,i,a,t.declutter?.[l]);A&&(P===e?P.restore():p[y]=j)}e.globalAlpha=c,this.ready=F,this.tileClipContexts_=p,t.declutter||this.renderDeferredInternal(t),super.postRender(e,t)}renderFeature(e,t,r,i,n,s){if(!r)return!1;let c=!1;if(Array.isArray(r))for(let l=0,a=r.length;l<a;++l)c=le(i,e,r[l],t,this.boundHandleStyleImageChange_,void 0,n,s)||c;else c=le(i,e,r,t,this.boundHandleStyleImageChange_,void 0,n,s);return c}tileImageNeedsRender_(e){let t=this.getLayer();if(t.getRenderMode()==="vector")return!1;let r=e.getReplayState(t),i=t.getRevision(),n=e.wantedResolution;return r.renderedTileResolution!==n||r.renderedTileRevision!==i}renderTileImage_(e,t){let r=this.getLayer(),i=e.getReplayState(r),n=r.getRevision(),s=e.executorGroups[_(r)];i.renderedTileRevision=n;let c=e.wrappedTileCoord,l=c[0],a=r.getSource(),d=t.pixelRatio,h=t.viewState.projection,m=a.getTileGridForProjection(h),g=m.getResolution(e.tileCoord[0]),x=t.pixelRatio/e.wantedResolution*g,f=m.getResolution(l),T=e.getContext();d=Math.round(Math.max(d,x/d));let p=a.getTilePixelSize(l,d,h);T.canvas.width=p[0],T.canvas.height=p[1];let w=d/x;if(w!==1){let S=ne(this.tmpTransform_);K(S,w,w),T.setTransform.apply(T,S)}let F=m.getTileCoordExtent(c,this.tempExtent),y=x/f,E=ne(this.tmpTransform_);K(E,y,-y),Ue(E,-F[0],-F[3]);for(let S=0,V=s.length;S<V;++S)s[S].execute(T,[T.canvas.width*w,T.canvas.height*w],E,0,!0,Et[r.getRenderMode()],null);i.renderedTileResolution=e.wantedResolution}},ft=de;var ce=class extends He{constructor(e){e=e||{};let t=Object.assign({},e);delete t.preload;let r=e.cacheSize===void 0?0:e.cacheSize;delete e.cacheSize,delete t.useInterimTilesOnError,super(t),this.on,this.once,this.un,this.cacheSize_=r;let i=e.renderMode||"hybrid";Ge(i=="hybrid"||i=="vector","`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=i,this.setPreload(e.preload?e.preload:0),this.setUseInterimTilesOnError(e.useInterimTilesOnError!==void 0?e.useInterimTilesOnError:!0),this.getBackground,this.setBackground}createRenderer(){return new ft(this,{cacheSize:this.cacheSize_})}getFeatures(e){return super.getFeatures(e)}getFeaturesInExtent(e){return this.getRenderer().getFeaturesInExtent(e)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(H.PRELOAD)}getUseInterimTilesOnError(){return this.get(H.USE_INTERIM_TILES_ON_ERROR)}setPreload(e){this.set(H.PRELOAD,e)}setUseInterimTilesOnError(e){this.set(H.USE_INTERIM_TILES_ON_ERROR,e)}},xt=ce;var Pt=["*"],Q=class o{wolClassName=v();wolOpacity=I();wolVisible=I();wolExtent=I();wolZIndex=I();wolMinResolution=I();wolMaxResolution=I();wolMinZoom=I();wolMaxZoom=I();wolRenderOrder=v();wolRenderBuffer=v();wolRenderMode=v();wolSource=I();wolMap=v();wolDeclutter=v();wolStyle=v();wolBackground=v();wolUpdateWhileAnimating=v();wolUpdateWhileInteracting=v();wolPreload=I();wolUseInterimTilesOnError=I();wolProperties=v();wolCacheSize=v();wolChange=k();wolError=k();wolPostRender=k();wolPreRender=k();wolPropertyChange=k();wolSourceReady=k();instance;constructor(){let e=X(pe),t=We("VectorTileLayer"),r={};Te(()=>{let i=new xt({className:this.wolClassName(),opacity:this.wolOpacity(),visible:this.wolVisible(),extent:this.wolExtent(),zIndex:this.wolZIndex(),minResolution:this.wolMinResolution(),maxResolution:this.wolMaxResolution(),minZoom:this.wolMinZoom(),maxZoom:this.wolMaxZoom(),renderOrder:this.wolRenderOrder(),renderBuffer:this.wolRenderBuffer(),renderMode:this.wolRenderMode(),source:this.wolSource(),map:this.wolMap(),declutter:this.wolDeclutter(),style:this.wolStyle(),background:this.wolBackground(),updateWhileAnimating:this.wolUpdateWhileAnimating(),updateWhileInteracting:this.wolUpdateWhileInteracting(),preload:this.wolPreload(),useInterimTilesOnError:this.wolUseInterimTilesOnError(),properties:this.wolProperties(),cacheSize:this.wolCacheSize()});r.change=i.on("change",n=>this.wolChange.emit(n)),r["change:extent"]=i.on("change:extent",()=>this.wolExtent.set(i.getExtent())),r["change:maxResolution"]=i.on("change:maxResolution",()=>this.wolMaxResolution.set(i.getMaxResolution())),r["change:maxZoom"]=i.on("change:maxZoom",()=>this.wolMaxZoom.set(i.getMaxZoom())),r["change:minResolution"]=i.on("change:minResolution",()=>this.wolMinResolution.set(i.getMinResolution())),r["change:minZoom"]=i.on("change:minZoom",()=>this.wolMinZoom.set(i.getMinZoom())),r["change:opacity"]=i.on("change:opacity",()=>this.wolOpacity.set(i.getOpacity())),r["change:preload"]=i.on("change:preload",()=>this.wolPreload.set(i.getPreload())),r["change:source"]=i.on("change:source",()=>this.wolSource.set(i.getSource()??void 0)),r["change:useInterimTilesOnError"]=i.on("change:useInterimTilesOnError",()=>this.wolUseInterimTilesOnError.set(i.getUseInterimTilesOnError())),r["change:visible"]=i.on("change:visible",()=>this.wolVisible.set(i.getVisible())),r["change:zIndex"]=i.on("change:zIndex",()=>this.wolZIndex.set(i.getZIndex())),r.error=i.on("error",n=>this.wolError.emit(n)),r.postrender=i.on("postrender",n=>this.wolPostRender.emit(n)),r.prerender=i.on("prerender",n=>this.wolPreRender.emit(n)),r.propertychange=i.on("propertychange",n=>this.wolPropertyChange.emit(n)),r.sourceready=i.on("sourceready",n=>this.wolSourceReady.emit(n)),Promise.resolve().then(()=>{t.addLayer(i)}),this.instance=i}),e.onDestroy(()=>{this.instance&&(Oe(Object.values(r)),t.removeLayer(this.instance),this.instance=void 0)})}ngOnChanges(e){if(this.instance)for(let[t,r]of Object.entries(e))switch(t){case"wolBackground":this.instance.setBackground(r.currentValue);break;case"wolDeclutter":this.instance.setDeclutter(r.currentValue);break;case"wolExtent":this.instance.setExtent(r.currentValue);break;case"wolMap":this.instance.setMap(r.currentValue??null);break;case"wolMaxResolution":this.instance.setMaxResolution(r.currentValue);break;case"wolMaxZoom":this.instance.setMaxZoom(r.currentValue);break;case"wolMinResolution":this.instance.setMinResolution(r.currentValue);break;case"wolMinZoom":this.instance.setMinZoom(r.currentValue);break;case"wolOpacity":this.instance.setOpacity(r.currentValue);break;case"wolPreload":this.instance.setPreload(r.currentValue);break;case"wolProperties":this.instance.setProperties(r.currentValue);break;case"wolSource":this.instance.setSource(r.currentValue??null);break;case"wolStyle":this.instance.setStyle(r.currentValue);break;case"wolUseInterimTilesOnError":this.instance.setUseInterimTilesOnError(r.currentValue);break;case"wolVisible":this.instance.setVisible(r.currentValue);break;case"wolZIndex":this.instance.setZIndex(r.currentValue);break}}getInstance(){return this.instance}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=Re({type:o,selectors:[["wol-vector-tile-layer"]],inputs:{wolClassName:[1,"wolClassName"],wolOpacity:[1,"wolOpacity"],wolVisible:[1,"wolVisible"],wolExtent:[1,"wolExtent"],wolZIndex:[1,"wolZIndex"],wolMinResolution:[1,"wolMinResolution"],wolMaxResolution:[1,"wolMaxResolution"],wolMinZoom:[1,"wolMinZoom"],wolMaxZoom:[1,"wolMaxZoom"],wolRenderOrder:[1,"wolRenderOrder"],wolRenderBuffer:[1,"wolRenderBuffer"],wolRenderMode:[1,"wolRenderMode"],wolSource:[1,"wolSource"],wolMap:[1,"wolMap"],wolDeclutter:[1,"wolDeclutter"],wolStyle:[1,"wolStyle"],wolBackground:[1,"wolBackground"],wolUpdateWhileAnimating:[1,"wolUpdateWhileAnimating"],wolUpdateWhileInteracting:[1,"wolUpdateWhileInteracting"],wolPreload:[1,"wolPreload"],wolUseInterimTilesOnError:[1,"wolUseInterimTilesOnError"],wolProperties:[1,"wolProperties"],wolCacheSize:[1,"wolCacheSize"]},outputs:{wolOpacity:"wolOpacityChange",wolVisible:"wolVisibleChange",wolExtent:"wolExtentChange",wolZIndex:"wolZIndexChange",wolMinResolution:"wolMinResolutionChange",wolMaxResolution:"wolMaxResolutionChange",wolMinZoom:"wolMinZoomChange",wolMaxZoom:"wolMaxZoomChange",wolSource:"wolSourceChange",wolPreload:"wolPreloadChange",wolUseInterimTilesOnError:"wolUseInterimTilesOnErrorChange",wolChange:"wolChange",wolError:"wolError",wolPostRender:"wolPostRender",wolPreRender:"wolPreRender",wolPropertyChange:"wolPropertyChange",wolSourceReady:"wolSourceReady"},exportAs:["wolVectorTileLayer"],features:[ye],ngContentSelectors:Pt,decls:1,vars:0,template:function(t,r){t&1&&(Se(),Ee(0))},encapsulation:2,changeDetection:0})};var wt=class o{static \u0275fac=function(t){return new(t||o)};static \u0275mod=Fe({type:o});static \u0275inj=me({})};var mt=23283064365386963e-26,Mt=12,pt=typeof TextDecoder>"u"?null:new TextDecoder("utf-8"),ue=0,ee=1,W=2,te=5,re=class{constructor(e=new Uint8Array(16)){this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t,r=this.length){for(;this.pos<r;){let i=this.readVarint(),n=i>>3,s=this.pos;this.type=i&7,e(n,t,this),this.pos===s&&this.skip(i)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){let e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){let e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readSFixed64(){let e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*4294967296;return this.pos+=8,e}readFloat(){let e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){let e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){let t=this.buf,r,i;return i=t[this.pos++],r=i&127,i<128||(i=t[this.pos++],r|=(i&127)<<7,i<128)||(i=t[this.pos++],r|=(i&127)<<14,i<128)||(i=t[this.pos++],r|=(i&127)<<21,i<128)?r:(i=t[this.pos],r|=(i&15)<<28,vt(r,e,this))}readVarint64(){return this.readVarint(!0)}readSVarint(){let e=this.readVarint();return e%2===1?(e+1)/-2:e/2}readBoolean(){return!!this.readVarint()}readString(){let e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=Mt&&pt?pt.decode(this.buf.subarray(t,e)):Zt(this.buf,t,e)}readBytes(){let e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(e=[],t){let r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readVarint(t));return e}readPackedSVarint(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(e=[]){let t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return this.type===W?this.readVarint()+this.pos:this.pos+1}skip(e){let t=e&7;if(t===ue)for(;this.buf[this.pos++]>127;);else if(t===W)this.pos=this.readVarint()+this.pos;else if(t===te)this.pos+=4;else if(t===ee)this.pos+=8;else throw new Error(`Unimplemented type: ${t}`)}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){let r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.dataView=new DataView(r.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*mt),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,e&-1,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*mt),!0),this.pos+=8}writeVarint(e){if(e=+e||0,e>268435455||e<0){Dt(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))}writeSVarint(e){this.writeVarint(e<0?-e*2-1:e*2)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(e.length*4),this.pos++;let t=this.pos;this.pos=At(this.buf,e,this.pos);let r=this.pos-t;r>=128&&yt(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){let t=e.length;this.writeVarint(t),this.realloc(t);for(let r=0;r<t;r++)this.buf[this.pos++]=e[r]}writeRawMessage(e,t){this.pos++;let r=this.pos;e(t,this);let i=this.pos-r;i>=128&&yt(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i}writeMessage(e,t,r){this.writeTag(e,W),this.writeRawMessage(t,r)}writePackedVarint(e,t){t.length&&this.writeMessage(e,_t,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,Lt,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,Gt,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,bt,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,Ot,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,kt,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,Nt,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,Bt,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,Ut,t)}writeBytesField(e,t){this.writeTag(e,W),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,te),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,te),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,ee),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,ee),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,ue),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,ue),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,W),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,te),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,ee),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function vt(o,e,t){let r=t.buf,i,n;if(n=r[t.pos++],i=(n&112)>>4,n<128||(n=r[t.pos++],i|=(n&127)<<3,n<128)||(n=r[t.pos++],i|=(n&127)<<10,n<128)||(n=r[t.pos++],i|=(n&127)<<17,n<128)||(n=r[t.pos++],i|=(n&127)<<24,n<128)||(n=r[t.pos++],i|=(n&1)<<31,n<128))return Z(o,i,e);throw new Error("Expected varint not more than 10 bytes")}function Z(o,e,t){return t?e*4294967296+(o>>>0):(e>>>0)*4294967296+(o>>>0)}function Dt(o,e){let t,r;if(o>=0?(t=o%4294967296|0,r=o/4294967296|0):(t=~(-o%4294967296),r=~(-o/4294967296),t^4294967295?t=t+1|0:(t=0,r=r+1|0)),o>=18446744073709552e3||o<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),It(t,r,e),Vt(r,e)}function It(o,e,t){t.buf[t.pos++]=o&127|128,o>>>=7,t.buf[t.pos++]=o&127|128,o>>>=7,t.buf[t.pos++]=o&127|128,o>>>=7,t.buf[t.pos++]=o&127|128,o>>>=7,t.buf[t.pos]=o&127}function Vt(o,e){let t=(o&7)<<4;e.buf[e.pos++]|=t|((o>>>=3)?128:0),o&&(e.buf[e.pos++]=o&127|((o>>>=7)?128:0),o&&(e.buf[e.pos++]=o&127|((o>>>=7)?128:0),o&&(e.buf[e.pos++]=o&127|((o>>>=7)?128:0),o&&(e.buf[e.pos++]=o&127|((o>>>=7)?128:0),o&&(e.buf[e.pos++]=o&127)))))}function yt(o,e,t){let r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));t.realloc(r);for(let i=t.pos-1;i>=o;i--)t.buf[i+r]=t.buf[i]}function _t(o,e){for(let t=0;t<o.length;t++)e.writeVarint(o[t])}function Lt(o,e){for(let t=0;t<o.length;t++)e.writeSVarint(o[t])}function bt(o,e){for(let t=0;t<o.length;t++)e.writeFloat(o[t])}function Ot(o,e){for(let t=0;t<o.length;t++)e.writeDouble(o[t])}function Gt(o,e){for(let t=0;t<o.length;t++)e.writeBoolean(o[t])}function kt(o,e){for(let t=0;t<o.length;t++)e.writeFixed32(o[t])}function Nt(o,e){for(let t=0;t<o.length;t++)e.writeSFixed32(o[t])}function Bt(o,e){for(let t=0;t<o.length;t++)e.writeFixed64(o[t])}function Ut(o,e){for(let t=0;t<o.length;t++)e.writeSFixed64(o[t])}function Zt(o,e,t){let r="",i=e;for(;i<t;){let n=o[i],s=null,c=n>239?4:n>223?3:n>191?2:1;if(i+c>t)break;let l,a,d;c===1?n<128&&(s=n):c===2?(l=o[i+1],(l&192)===128&&(s=(n&31)<<6|l&63,s<=127&&(s=null))):c===3?(l=o[i+1],a=o[i+2],(l&192)===128&&(a&192)===128&&(s=(n&15)<<12|(l&63)<<6|a&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):c===4&&(l=o[i+1],a=o[i+2],d=o[i+3],(l&192)===128&&(a&192)===128&&(d&192)===128&&(s=(n&15)<<18|(l&63)<<12|(a&63)<<6|d&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,c=1):s>65535&&(s-=65536,r+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),r+=String.fromCharCode(s),i+=c}return r}function At(o,e,t){for(let r=0,i,n;r<e.length;r++){if(i=e.charCodeAt(r),i>55295&&i<57344)if(n)if(i<56320){o[t++]=239,o[t++]=191,o[t++]=189,n=i;continue}else i=n-55296<<10|i-56320|65536,n=null;else{i>56319||r+1===e.length?(o[t++]=239,o[t++]=191,o[t++]=189):n=i;continue}else n&&(o[t++]=239,o[t++]=191,o[t++]=189,n=null);i<128?o[t++]=i:(i<2048?o[t++]=i>>6|192:(i<65536?o[t++]=i>>12|224:(o[t++]=i>>18|240,o[t++]=i>>12&63|128),o[t++]=i>>6&63|128),o[t++]=i&63|128)}return t}var he=class extends ut{constructor(e){super(),e=e||{},this.dataProjection=new Ie({code:"",units:"tile-pixels"}),this.featureClass=e.featureClass?e.featureClass:ae,this.geometryName_=e.geometryName,this.layerName_=e.layerName?e.layerName:"layer",this.layers_=e.layers?e.layers:null,this.idProperty_=e.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(e,t,r,i){e.pos=t.geometry;let n=e.readVarint()+e.pos,s=1,c=0,l=0,a=0,d=0,u=0;for(;e.pos<n;){if(!c){let h=e.readVarint();s=h&7,c=h>>3}if(c--,s===1||s===2)l+=e.readSVarint(),a+=e.readSVarint(),s===1&&d>u&&(i.push(d),u=d),r.push(l,a),d+=2;else if(s===7)d>u&&(r.push(r[u],r[u+1]),d+=2);else throw new Error("Invalid command found in the PBF")}d>u&&(i.push(d),u=d)}createFeature_(e,t,r){let i=t.type;if(i===0)return null;let n,s=t.properties,c;this.idProperty_?(c=s[this.idProperty_],delete s[this.idProperty_]):c=t.id,s[this.layerName_]=t.layer.name;let l=[],a=[];this.readRawGeometry_(e,t,l,a);let d=Wt(i,a.length);if(this.featureClass===ae)n=new this.featureClass(d,l,a,2,s,c),n.transform(r.dataProjection);else{let u;if(d=="Polygon"){let g=Ae(l,a);u=g.length>1?new dt(l,"XY",g):new je(l,"XY",a)}else u=d==="Point"?new Ze(l,"XY"):d==="LineString"?new st(l,"XY"):d==="MultiPoint"?new at(l,"XY"):d==="MultiLineString"?new lt(l,"XY",a):null;let h=this.featureClass;n=new h,this.geometryName_&&n.setGeometryName(this.geometryName_);let m=ht(u,!1,r);n.setGeometry(m),c!==void 0&&n.setId(c),n.setProperties(s,!0)}return n}getType(){return"arraybuffer"}readFeatures(e,t){let r=this.layers_;t=this.adaptOptions(t);let i=_e(t.dataProjection);i.setWorldExtent(t.extent),t.dataProjection=i;let n=new re(e),s=n.readFields(jt,{}),c=[];for(let l in s){if(r&&!r.includes(l))continue;let a=s[l],d=a?[0,0,a.extent,a.extent]:null;i.setExtent(d);for(let u=0,h=a.length;u<h;++u){let m=Ht(n,a,u),g=this.createFeature_(n,m,t);g!==null&&c.push(g)}}return c}readProjection(e){return this.dataProjection}setLayers(e){this.layers_=e}};function jt(o,e,t){if(o===3){let r={keys:[],values:[],features:[]},i=t.readVarint()+t.pos;t.readFields(zt,r,i),r.length=r.features.length,r.length&&(e[r.name]=r)}}function zt(o,e,t){if(o===15)e.version=t.readVarint();else if(o===1)e.name=t.readString();else if(o===5)e.extent=t.readVarint();else if(o===2)e.features.push(t.pos);else if(o===3)e.keys.push(t.readString());else if(o===4){let r=null,i=t.readVarint()+t.pos;for(;t.pos<i;)o=t.readVarint()>>3,r=o===1?t.readString():o===2?t.readFloat():o===3?t.readDouble():o===4?t.readVarint64():o===5?t.readVarint():o===6?t.readSVarint():o===7?t.readBoolean():null;e.values.push(r)}}function Kt(o,e,t){if(o==1)e.id=t.readVarint();else if(o==2){let r=t.readVarint()+t.pos;for(;t.pos<r;){let i=e.layer.keys[t.readVarint()],n=e.layer.values[t.readVarint()];e.properties[i]=n}}else o==3?e.type=t.readVarint():o==4&&(e.geometry=t.pos)}function Ht(o,e,t){o.pos=e.features[t];let r=o.readVarint()+o.pos,i={layer:e,type:0,properties:{}};return o.readFields(Kt,i,r),i}function Wt(o,e){let t;return o===1?t=e===1?"Point":"MultiPoint":o===2?t=e===1?"LineString":"MultiLineString":o===3&&(t="Polygon"),t}var Ar=he;function Wr(o){let t=X(Q,{host:!0,optional:!0});if(t)return{setSource:r=>(t.getInstance()?.setSource(r),()=>{t.getInstance()?.setSource(null)}),getInstance:()=>t.getInstance()};throw new Error(`No VectorTileSource host found. Please wrap the ${o} component in a VectorTileLayer component.`)}var Tt=[],ge=class extends ${constructor(e,t,r,i,n){super(e,t,{transition:0}),this.context_=null,this.executorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=i.bind(void 0,this),this.removeSourceTiles_=n,this.wrappedTileCoord=r}getContext(){return this.context_||(this.context_=ze(1,1,Tt)),this.context_}hasContext(){return!!this.context_}getImage(){return this.hasContext()?this.getContext().canvas:null}getReplayState(e){let t=_(e);return t in this.replayState_||(this.replayState_[t]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[t]}load(){this.getSourceTiles()}release(){this.context_&&(Ke(this.context_),Tt.push(this.context_.canvas),this.context_=null),this.removeSourceTiles_(this),this.sourceTiles.length=0,super.release()}},Rt=ge;var fe=class extends ${constructor(e,t,r,i,n,s){super(e,t,s),this.extent=null,this.format_=i,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=n,this.url_=r,this.key=r}getTileUrl(){return this.url_}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==R.IDLE&&(this.setState(R.LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(e,t){this.setFeatures(e)}onError(){this.setState(R.ERROR)}setFeatures(e){this.features_=e,this.setState(R.LOADED)}setLoader(e){this.loader_=e}},Ft=fe;var xe=class extends et{constructor(e){let t=e.projection||"EPSG:3857",r=e.extent||Qe(t),i=e.tileGrid||Je({extent:r,maxResolution:e.maxResolution,maxZoom:e.maxZoom!==void 0?e.maxZoom:22,minZoom:e.minZoom,tileSize:e.tileSize||512});super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,interpolate:!0,projection:t,state:e.state,tileGrid:i,tileLoadFunction:e.tileLoadFunction?e.tileLoadFunction:Xt,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:e.wrapX===void 0?!0:e.wrapX,transition:e.transition,zDirection:e.zDirection===void 0?1:e.zDirection}),this.format_=e.format?e.format:null,this.tileKeysBySourceTileUrl_={},this.sourceTiles_={},this.overlaps_=e.overlaps==null?!0:e.overlaps,this.tileClass=e.tileClass?e.tileClass:Ft,this.tileGrids_={}}getOverlaps(){return this.overlaps_}getSourceTiles(e,t,r){if(r.getState()===R.IDLE){r.setState(R.LOADING);let i=r.wrappedTileCoord,n=this.getTileGridForProjection(t),s=n.getTileCoordExtent(i),c=i[0],l=n.getResolution(c);N(s,-l,s);let a=this.projection;t&&this.projection&&!L(t,a)&&(s=U(s,t,a));let d=this.tileGrid,u=d.getExtent();u&&Y(s,u,s);let h=l;t&&a&&!L(t,a)&&(h=l/a.getMetersPerUnit()/t.getMetersPerUnit());let m=d.getZForResolution(h,this.zDirection);d.forEachTileCoord(s,m,g=>{let x=this.tileUrlFunction(g,e,t);this.sourceTiles_[x]||(this.sourceTiles_[x]=new this.tileClass(g,x?R.IDLE:R.EMPTY,x,this.format_,this.tileLoadFunction));let f=this.sourceTiles_[x];r.sourceTiles.push(f),this.tileKeysBySourceTileUrl_[x]||(this.tileKeysBySourceTileUrl_[x]=[]),this.tileKeysBySourceTileUrl_[x].push(r.getKey());let T=f.getState();if(T<R.LOADED){let p=w=>{this.handleTileChange(w);let F=f.getState();if(F===R.LOADED||F===R.ERROR){let y=f.getKey();y in r.errorTileKeys?f.getState()===R.LOADED&&delete r.errorTileKeys[y]:r.loadingSourceTiles--,F===R.ERROR?r.errorTileKeys[y]=!0:f.removeEventListener(oe.CHANGE,p),r.loadingSourceTiles===0&&r.setState(Ve(r.errorTileKeys)?R.LOADED:R.ERROR)}};f.addEventListener(oe.CHANGE,p),r.loadingSourceTiles++}T===R.IDLE&&(f.extent=d.getTileCoordExtent(g),f.projection=this.projection,f.resolution=d.getResolution(g[0]),f.load())}),r.loadingSourceTiles||r.setState(r.sourceTiles.some(g=>g.getState()===R.ERROR)?R.ERROR:R.LOADED)}return r.sourceTiles}removeSourceTiles(e){let t=e.getKey(),r=e.sourceTiles;for(let i=0,n=r.length;i<n;++i){let s=r[i].getTileUrl();if(!this.tileKeysBySourceTileUrl_[s])return;let c=this.tileKeysBySourceTileUrl_[s].indexOf(t);c!==-1&&(this.tileKeysBySourceTileUrl_[s].splice(c,1),this.tileKeysBySourceTileUrl_[s].length===0&&(delete this.tileKeysBySourceTileUrl_[s],delete this.sourceTiles_[s]))}}getTile(e,t,r,i,n){let s=[e,t,r],c=this.getTileCoordForTileUrlFunction(s,n),l=this.getTileGrid().getExtent(),a=this.projection,d=this.getTileGridForProjection(n);if(c&&l){let m=d.getTileCoordExtent(c);N(m,-d.getResolution(e),m),G(l,!n||!a||L(n,a)?m:U(m,n,a))||(c=null)}let u=!0;if(c!==null){let m=this.tileGrid,g=d.getResolution(e),x=g;n&&a&&!L(n,a)&&(x=g/a.getMetersPerUnit()/n.getMetersPerUnit());let f=m.getZForResolution(x,1),T=d.getTileCoordExtent(c);N(T,-g,T),m.forEachTileCoord(!n||!a||L(n,a)?T:U(T,n,a),f,p=>{u=u&&!this.tileUrlFunction(p,i,a)})}let h=new Rt(s,u?R.EMPTY:R.IDLE,c,this.getSourceTiles.bind(this,i,n),this.removeSourceTiles.bind(this));return h.key=this.getKey(),h}getTileGridForProjection(e){let t=e.getCode(),r=this.tileGrids_[t];if(!r){let i=this.projection;if(i!==null&&!L(i,e))return $e(e);let n=this.tileGrid,s=n.getResolutions().slice(),c=s.map(function(d,u){return n.getOrigin(u)}),l=s.map(function(d,u){return n.getTileSize(u)}),a=43;for(let d=s.length;d<a;++d)s.push(s[d-1]/2),c.push(c[d-1]),l.push(l[d-1]);r=new qe({extent:n.getExtent(),origins:c,resolutions:s,tileSizes:l}),this.tileGrids_[t]=r}return r}getTilePixelRatio(e){return e}getTilePixelSize(e,t,r){let i=this.getTileGridForProjection(r),n=q(i.getTileSize(e),this.tmpSize);return[Math.round(n[0]*t),Math.round(n[1]*t)]}setOverlaps(e){this.overlaps_=e,this.changed()}},xi=xe;function Xt(o,e){o.setLoader(function(t,r,i){ct(e,o.getFormat(),t,r,i,o.onLoad.bind(o),o.onError.bind(o))})}export{Q as a,wt as b,Wr as c,xi as d,Ar as e};
